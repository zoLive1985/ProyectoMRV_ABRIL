var DraggedItem=null,ShortcodeNextSave=0,ShortcodeTimeOut=null,ShortcodeString="",Autosave=!1,PageObsolete=!1,PageUpdating=!1,CheckObsolescenceTimeOut=5e3,wfu_transfers_observer_interval=100,wfu_allops_freeze_events=!1,wfu_PD_bank={};function wfu_admin_activate_tab(e){for(var t,n,o=document.getElementById("wfu_tab_container"),a=0;a<o.childNodes.length;a++)1===(t=o.childNodes[a]).nodeType&&(n=t.id.substr(8),t.className.indexOf("nav-tab-active")>-1&&(t.className="nav-tab",document.getElementById("wfu_container_"+n).style.display="none"));document.getElementById("wfu_tab_"+e).className="nav-tab nav-tab-active",document.getElementById("wfu_container_"+e).style.display="block"}function wfu_admin_onoff_clicked(e){var t=document.getElementById("wfu_attribute_"+e),n=document.querySelectorAll("#wfu_wrapper div.wfu_shadow_"+e),o=document.querySelectorAll("#wfu_wrapper div.wfu_shadow_"+e+"_inv"),a="on"==t.className.substr(t.className.length-2);if(a=!a){document.getElementById("wfu_attribute_value_"+e).value="true",t.className="wfu_onoff_container_on";for(var l=0;l<n.length;l++)n[l].style.display="none";for(l=0;l<o.length;l++)o[l].style.display="block"}else{for(document.getElementById("wfu_attribute_value_"+e).value="false",t.className="wfu_onoff_container_off",l=0;l<n.length;l++)n[l].style.display="block";for(l=0;l<o.length;l++)o[l].style.display="none"}wfu_generate_shortcode(),"userdata"!=e&&"formdata"!=e||wfu_update_formfield_variables()}function wfu_admin_radio_clicked(e){var t=document.getElementsByName("wfu_radioattribute_"+e),n=document.querySelectorAll("#wfu_wrapper div.wfu_shadow_"+e),o=document.querySelectorAll("#wfu_wrapper div.wfu_shadow_"+e+"_inv"),a="";for(l=0;l<t.length;l++)t[l].checked&&(a=t[l].value);if("*"==a.substr(0,1)){a=a.substr(1);for(var l=0;l<n.length;l++)n[l].style.display="none";for(l=0;l<o.length;l++)o[l].style.display="block"}else{for(l=0;l<n.length;l++)n[l].style.display="block";for(l=0;l<o.length;l++)o[l].style.display="none"}document.getElementById("wfu_attribute_value_"+e).value=a,wfu_generate_shortcode()}function wfu_set_checkbox_status(e,t){0==t?(e.checked=!1,e.indeterminate=!0,e.classList.add("indeterminate")):(e.indeterminate=!1,e.classList.remove("indeterminate"),e.checked=1==t)}function wfu_addEventHandler(e,t,n){e.addEventListener?e.addEventListener(t,n,!1):e.attachEvent?e.attachEvent("on"+t,n):e["on"+t]=n}function wfu_attach_separator_dragdrop_events(){for(var e,t=document.getElementById("wfu_placements_container"),n=0;n<t.childNodes.length;n++)"wfu_component_separator_hor"!=(e=t.childNodes[n]).className&&"wfu_component_separator_ver"!=e.className||(wfu_addEventHandler(e,"dragenter",wfu_separator_dragenter),wfu_addEventHandler(e,"dragover",wfu_default_dragover),wfu_addEventHandler(e,"dragleave",wfu_separator_dragleave),wfu_addEventHandler(e,"drop",wfu_separator_drop))}function wfu_Attach_Admin_DragDrop_Events(){if(window.FileReader){var e=document.getElementById("wfu_placements_container");if(e){for(var t,n=document.getElementById("wfu_componentlist_container"),o=0;o<e.childNodes.length;o++)"wfu_component_box"==(t=e.childNodes[o]).className&&(wfu_addEventHandler(t,"dragstart",wfu_component_dragstart),wfu_addEventHandler(t,"dragend",wfu_component_dragend));for(o=0;o<n.childNodes.length;o++)if("wfu_component_box_container"==(t=n.childNodes[o]).className)for(var a=0;a<t.childNodes.length;a++)"wfu_component_box wfu_inbase"==t.childNodes[a].className&&(wfu_addEventHandler(t.childNodes[a],"dragstart",wfu_component_dragstart),wfu_addEventHandler(t.childNodes[a],"dragend",wfu_component_dragend));wfu_addEventHandler(t=document.getElementById("wfu_componentlist_dragdrop"),"dragenter",wfu_componentlist_dragenter),wfu_addEventHandler(t,"dragover",wfu_default_dragover),wfu_addEventHandler(t,"dragleave",wfu_componentlist_dragleave),wfu_addEventHandler(t,"drop",wfu_componentlist_drop),wfu_attach_separator_dragdrop_events()}}}function wfu_componentlist_dragenter(e){if((e=e||window.event).preventDefault&&e.preventDefault(),!DraggedItem)return!1;var t=document.getElementById("wfu_componentlist_dragdrop");return-1==t.className.indexOf("wfu_componentlist_dragdrop_dragover")&&(t.className+=" wfu_componentlist_dragdrop_dragover"),!1}function wfu_componentlist_dragleave(e){if((e=e||window.event).preventDefault&&e.preventDefault(),!DraggedItem)return!1;var t=document.getElementById("wfu_componentlist_dragdrop");return t.className=t.className.replace(" wfu_componentlist_dragdrop_dragover",""),!1}function wfu_componentlist_drop(e){(e=e||window.event).preventDefault&&e.preventDefault();var t=e.dataTransfer.getData("Component");if(!t)return!1;var n=t.split("_"),o=n[0],a=parseInt(n[1]),l=document.getElementById("wfu_component_box_"+o+"_"+a);0==a?(l.className="wfu_component_box wfu_inbase",l.style.display="block",document.getElementById("wfu_component_box_container_"+o).appendChild(l)):l.parentNode.removeChild(l);var r=wfu_admin_recreate_placements_text(null,"");return wfu_admin_recreate_placements_panel(r),document.getElementById("wfu_attribute_value_placements").value=r,wfu_update_multiplacement_attributes(),wfu_generate_shortcode(),!1}function wfu_separator_dragenter(e){if((e=e||window.event).preventDefault&&e.preventDefault(),!DraggedItem)return!1;if("wfu_component_separator_hor"==e.target.className)(t=document.getElementById("wfu_component_bar_hor")).style.top=e.target.offsetTop+"px",t.style.display="block";else if("wfu_component_separator_ver"==e.target.className){var t;(t=document.getElementById("wfu_component_bar_ver")).style.top=e.target.offsetTop+"px",t.style.left=e.target.offsetLeft+"px",t.style.display="block"}return!1}function wfu_default_dragover(e){return(e=e||window.event).preventDefault&&e.preventDefault(),!1}function wfu_separator_dragleave(e){return(e=e||window.event).preventDefault&&e.preventDefault(),!!DraggedItem&&("wfu_component_separator_hor"==e.target.className?document.getElementById("wfu_component_bar_hor").style.display="none":"wfu_component_separator_ver"==e.target.className&&(document.getElementById("wfu_component_bar_ver").style.display="none"),!1)}function wfu_separator_drop(e){(e=e||window.event).preventDefault&&e.preventDefault();var t=e.dataTransfer.getData("Component");if(!t)return!1;var n=t.split("_"),o=n[0],a=parseInt(n[1]),l=document.getElementById("wfu_component_box_"+o+"_"+a);l.style.display="none",l.className="wfu_component_box wfu_inbase",document.getElementById("wfu_component_box_container_"+o).appendChild(l);var r=wfu_admin_recreate_placements_text(e.target,o);return wfu_admin_recreate_placements_panel(r),document.getElementById("wfu_attribute_value_placements").value=r,wfu_update_multiplacement_attributes(),wfu_generate_shortcode(),!1}function wfu_component_dragstart(e){(e=e||window.event).dataTransfer.setData("Component",e.target.id.replace("wfu_component_box_","")),-1==e.target.className.indexOf("wfu_component_box_dragged")&&(e.target.className+=" wfu_component_box_dragged",DraggedItem=e.target),e.target.style.zIndex=3;var t=document.getElementById("wfu_componentlist_dragdrop");return t.className="wfu_componentlist_dragdrop wfu_componentlist_dragdrop_dragover",t.style.display="block",!1}function wfu_component_dragend(e){e=e||window.event,DraggedItem=null,e.target.style.zIndex=1;var t=document.getElementById("wfu_componentlist_dragdrop");return t.style.display="none",t.className="wfu_componentlist_dragdrop",e.target.className=e.target.className.replace(" wfu_component_box_dragged",""),document.getElementById("wfu_component_bar_ver").style.display="none",document.getElementById("wfu_component_bar_hor").style.display="none",!1}function wfu_admin_recreate_placements_text(e,t){function n(e){""!=l&&(l+=a),l+=e,a=""}for(var o=document.getElementById("wfu_placements_container"),a="",l="",r=0;r<o.childNodes.length;r++)item=o.childNodes[r],"wfu_component_separator_ver"==item.className?(""==a&&(a="+"),item==e&&(n(t),a="+")):"wfu_component_separator_hor"==item.className?(a="/",item==e&&(n(t),a="/")):"wfu_component_box"==item.className&&n(item.id.replace("wfu_component_box_","").replace(/_.*$/,""));return l}function wfu_admin_recreate_placements_panel(e){for(var t,n,o,a,l,r=document.getElementById("wfu_placements_container"),s="",u=0;u<r.childNodes.length;u++)"wfu_component_box"==(t=r.childNodes[u]).className&&(s=(a=t.id.replace("wfu_component_box_","").split("_"))[0],0==parseInt(a[1])?(t.style.display="inline-block",t.className="wfu_component_box wfu_inbase",document.getElementById("wfu_component_box_container_"+s).appendChild(t)):t.parentNode.removeChild(t));var d=document.querySelectorAll("div.wfu_component_box_container"),_={};for(u=0;u<d.length;u++)_[s=d[u].id.replace("wfu_component_box_container_","")]=0,(l=document.querySelector("div#"+d[u].id+" div.wfu_component_box_index"))&&(l.innerHTML="1");for(r.innerHTML="",n=e.split("/"),u=0;u<n.length;u++){(t=document.createElement("DIV")).className="wfu_component_separator_hor",t.setAttribute("draggable",!0),r.appendChild(t),(t=document.createElement("DIV")).className="wfu_component_separator_ver",t.setAttribute("draggable",!0),r.appendChild(t),o=n[u].split("+");for(var i=0;i<o.length;i++)(t=document.querySelector("div#wfu_component_box_container_"+o[i]+" div.wfu_component_box.wfu_inbase"))&&(s=(a=t.id.replace("wfu_component_box_","").split("_"))[0],0==parseInt(a[1])?r.appendChild(t):(_[s]++,t.id="wfu_component_box_"+s+"_"+(_[s]+1).toString(),t.style.display="block",(l=document.querySelector("div#"+t.id+" div.wfu_component_box_index")).innerHTML=(_[s]+1).toString(),t=t.cloneNode(!0),r.appendChild(t),t.id="wfu_component_box_"+s+"_"+_[s].toString(),(l=document.querySelector("div#"+t.id+" div.wfu_component_box_index")).innerHTML=_[s].toString(),wfu_addEventHandler(t,"dragstart",wfu_component_dragstart),wfu_addEventHandler(t,"dragend",wfu_component_dragend)),t.className="wfu_component_box",t.style.display="inline-block",(t=document.createElement("DIV")).className="wfu_component_separator_ver",t.setAttribute("draggable",!0),r.appendChild(t))}(t=document.createElement("DIV")).className="wfu_component_separator_hor",t.setAttribute("draggable",!0),r.appendChild(t),(t=document.createElement("DIV")).id="wfu_component_bar_hor",t.className="wfu_component_bar_hor",r.appendChild(t),(t=document.createElement("DIV")).id="wfu_component_bar_ver",t.className="wfu_component_bar_ver",r.appendChild(t),wfu_attach_separator_dragdrop_events()}function wfu_update_multiplacement_attributes(){for(var e=document.querySelectorAll("div.wfu_component_box_container"),t=0;t<e.length;t++){itemname=e[t].id.replace("wfu_component_box_container_","");var n=document.querySelector("div#"+e[t].id+" div.wfu_component_box_index");if(n)for(var o=Math.max(1,parseInt(n.innerHTML)-1),a=document.getElementsByName("wfu_attribute_governor_"+itemname),l=0;l<a.length;l++)wfu_update_multiplacement_attribute(a[l].value,o)}}function wfu_update_multiplacement_attribute(e,t){if("userdatalabel"==e){var n=document.querySelectorAll("div.wfu_formdata_container"),o=n.length;if(o<1)return;for(var a,l,r=n[0],s=2;s<=Math.max(o,t);){if(s>o){var u=e+s.toString();for(a=r.parentNode;null!=a&&"TR"!=a.tagName;)a=a.parentNode;if(null==a||"TR"!=a.tagName)return;(l=a.cloneNode(!0)).id="tr_"+wfu_randomString(4),a.parentNode.appendChild(l);var d=document.querySelector("tr#"+l.id+' label[for="wfu_attribute_'+e+'"]');d.setAttribute("for","wfu_attribute_"+u),d.innerHTML+=" ("+s.toString()+")",(d=document.querySelector("tr#"+l.id+" input.wfu_attribute_governor")).setAttribute("name","wfu_attribute_governor_independent"),d.value=u,(d=document.querySelector("tr#"+l.id+" div.wfu_formdata_container")).id+=s.toString();var _=document.getElementById("wfu_attribute_default_"+u);_||((_=document.createElement("INPUT")).id="wfu_attribute_default_"+u,_.type="hidden",_.value=document.getElementById("wfu_attribute_default_"+e).value,document.getElementById("wfu_attribute_defaults").appendChild(_));var i=document.getElementById("wfu_attribute_value_"+u);i||((i=document.createElement("INPUT")).id="wfu_attribute_value_"+u,i.type="hidden",i.value=_.value,document.getElementById("wfu_attribute_values").appendChild(i)),window["wfu_attribute_"+u+"_formtemplate"]=window["wfu_attribute_"+e+"_formtemplate"],window["wfu_attribute_"+u+"_typeprops"]=window["wfu_attribute_"+e+"_typeprops"],wfu_apply_value(u,"formfields",i.value)}else if(s>t){for(l=n[s-1].parentNode;null!=l&&"TR"!=l.tagName;)l=l.parentNode;if(null==l||"TR"!=l.tagName)return;l.parentNode.removeChild(l),wfu_update_formfield_variables()}s++}n=document.querySelectorAll("div.wfu_formdata_container");var c=[];for(s=0;s<n.length;s++)c.push(n[s].id.replace(/^wfu_attribute_/,""));var f=document.querySelectorAll(".wfu_formdata_all_attributes");for(s=0;s<f.length;s++)f[s].value=c.join(",");wfu_formdata_update_all_updown_buttons(e)}}function wfu_subfolders_input_changed(e){var t=(e=e||window.event).target,n=t.id.replace("wfu_subfolders_path_","");n=n.replace("wfu_subfolders_label_","");var o=document.getElementById("wfu_attribute_"+n);if(!(o.selectedIndex<0)){var a,l,r=document.getElementById("wfu_subfolders_path_"+n),s=document.getElementById("wfu_subfolders_label_"+n),u=document.getElementById("wfu_subfolders_ok_"+n),d="1"==document.getElementById("wfu_subfolders_isnewitem_"+n).value;if(d?(a="",l=""):(a=(t=o.data[o.selectedIndex]).path,l=t.label),r.value==a&&s.value==l)u.disabled=!0,d||wfu_subfolders_update_nav(n);else{u.disabled=!1;for(var _=document.getElementsByName("wfu_subfolder_nav_"+n),i=0;i<_.length;i++)_[i].disabled=!0}}}function wfu_subfolders_auto_changed(e){var t=document.getElementById("wfu_attribute_"+e),n=document.getElementById("wfu_subfolders_auto_"+e),o=document.getElementById("wfu_subfolders_editable_"+e),a=document.getElementById("wfu_subfolders_manualtext_"+e);if(n.checked){var l=document.getElementById("wfu_attribute_value_"+e).value;"auto"!=l.substr(0,4)&&(a.value=l),o.parentNode.style.display="inline",wfu_apply_value(e,"folderlist","auto"+(o.checked?"+":"")),t.disabled=!0}else t.disabled=!1,o.parentNode.style.display="none",wfu_apply_value(e,"folderlist",a.value)}function wfu_subfolders_up_clicked(e){var t=document.getElementById("wfu_attribute_"+e);if(!(t.selectedIndex<0)){var n=t.data;item=n[t.selectedIndex];var o=item.index-1;if(!(o<0)){for(var a=-1,l=t.selectedIndex-1;l>=0;){if(n[l].level==item.level&&n[l].index==o){a=l;break}l--}if(-1!=a){var r=0;for(l=t.selectedIndex+1;l<n.length&&n[l].level>item.level;)r++,l++;n[a].index=item.index,item.index=o,t.data=n.slice(0,a).concat(n.slice(t.selectedIndex,t.selectedIndex+1+r)).concat(n.slice(a,t.selectedIndex)).concat(n.slice(t.selectedIndex+1+r));var s=wfu_update_subfolder_list(e);t.selectedIndex=a,wfu_subfolders_update_toolnav(e),item=t,s!==item.oldVal&&(item.oldVal=s,document.getElementById("wfu_attribute_value_"+e).value=s,wfu_generate_shortcode())}}}}function wfu_subfolders_down_clicked(e){var t=document.getElementById("wfu_attribute_"+e);if(!(t.selectedIndex<0)){var n=t.data;item=n[t.selectedIndex];var o=item.index+1,a=-1;for(curind=t.selectedIndex+1;curind<n.length;){if(n[curind].level==item.level){a=curind;break}if(n[curind].level<item.level)break;curind++}if(-1!=a){var l=0;for(curind=a+1;curind<n.length&&n[curind].level>item.level;)l++,curind++;n[a].index=item.index,item.index=o,t.data=n.slice(0,t.selectedIndex).concat(n.slice(a,a+1+l)).concat(n.slice(t.selectedIndex,a)).concat(n.slice(a+1+l));var r=wfu_update_subfolder_list(e);t.selectedIndex=t.selectedIndex+l+1,wfu_subfolders_update_toolnav(e),item=t,r!==item.oldVal&&(item.oldVal=r,document.getElementById("wfu_attribute_value_"+e).value=r,wfu_generate_shortcode())}}}function wfu_subfolders_left_clicked(e){var t=document.getElementById("wfu_attribute_"+e);if(!(t.selectedIndex<0)){var n=t.data;for(item=n[t.selectedIndex],curind=t.selectedIndex+1;curind<n.length&&n[curind].level>item.level;)n[curind].level--,curind++;item.level--;var o=wfu_update_subfolder_list(e);t.data=wfu_decode_subfolder_list(e),wfu_subfolders_update_toolnav(e),item=t,o!==item.oldVal&&(item.oldVal=o,document.getElementById("wfu_attribute_value_"+e).value=o,wfu_generate_shortcode())}}function wfu_subfolders_right_clicked(e){var t=document.getElementById("wfu_attribute_"+e);if(!(t.selectedIndex<0)){var n=t.data;for(item=n[t.selectedIndex],curind=t.selectedIndex+1;curind<n.length&&n[curind].level>item.level;)n[curind].level++,curind++;item.level++;var o=wfu_update_subfolder_list(e);t.data=wfu_decode_subfolder_list(e),wfu_subfolders_update_toolnav(e),item=t,o!==item.oldVal&&(item.oldVal=o,document.getElementById("wfu_attribute_value_"+e).value=o,wfu_generate_shortcode())}}function wfu_subfolders_def_clicked(e){var t=document.getElementById("wfu_attribute_"+e);if(!(t.selectedIndex<0)){var n=t.data;if(item=n[t.selectedIndex],item.default)item.default=!1;else{for(var o=0;o<n.length;o++)n[o].default=!1;item.default=!0}var a=wfu_update_subfolder_list(e);wfu_subfolders_update_toolnav(e),item=t,a!==item.oldVal&&(item.oldVal=a,document.getElementById("wfu_attribute_value_"+e).value=a,wfu_generate_shortcode())}}function wfu_subfolders_ok_clicked(e){var t=document.getElementById("wfu_attribute_"+e);if(!(t.selectedIndex<0)){var n=document.getElementById("wfu_subfolders_path_"+e),o=document.getElementById("wfu_subfolders_label_"+e);if(""!=n.value&&""!=o.value){var a=t.data;if("1"==document.getElementById("wfu_subfolders_isnewitem_"+e).value){var l=parseInt(document.getElementById("wfu_subfolders_newitemlevel_"+e).value),r={label:o.value,path:n.value,level:l,default:!1},s=parseInt(document.getElementById("wfu_subfolders_newitemindex_"+e).value);s>=a.length?a.push(r):a.splice(s,0,r)}else item=a[t.selectedIndex],item.path=n.value,item.label=o.value;var u=wfu_update_subfolder_list(e);t.data=wfu_decode_subfolder_list(e),wfu_subfolders_update_toolnav(e),item=t,u!==item.oldVal&&(item.oldVal=u,document.getElementById("wfu_attribute_value_"+e).value=u,wfu_generate_shortcode())}else alert("Path or label cannot be empty!")}}function wfu_subfolders_del_clicked(e){var t=document.getElementById("wfu_attribute_"+e);if(!(t.selectedIndex<0)){var n=t.data;item=n[t.selectedIndex];var o=0;for(curind=t.selectedIndex+1;curind<n.length&&n[curind].level>item.level;)o++,curind++;if(!(o>0)||confirm("Children items will be deleted as well. Proceed?")){n.splice(t.selectedIndex,1+o);var a=wfu_update_subfolder_list(e);t.data=wfu_decode_subfolder_list(e),wfu_subfolders_update_toolnav(e),item=t,a!==item.oldVal&&(item.oldVal=a,document.getElementById("wfu_attribute_value_"+e).value=a,wfu_generate_shortcode())}}}function wfu_subfolders_add_clicked(e){var t=document.getElementById("wfu_attribute_"+e);if(!(t.selectedIndex<0)){var n=t.data,o=t.selectedIndex;item=n[o];var a=t.options,l=document.createElement("option");l.value="",l.innerHTML="",a.add(l,o),t.selectedIndex=o;var r=document.getElementById("wfu_subfolder_tools_"+e),s=document.getElementById("wfu_subfolders_path_"+e),u=document.getElementById("wfu_subfolders_label_"+e),d=document.getElementById("wfu_subfolders_ok_"+e),_=document.getElementById("wfu_subfolders_browse_"+e);r.className="wfu_subfolder_tools_container",u.disabled=!1,d.disabled=!0,document.getElementById("wfu_subfolders_isnewitem_"+e).value="1",document.getElementById("wfu_subfolders_newitemindex_"+e).value=o,document.getElementById("wfu_subfolders_newitemlevel_"+e).value=item.level,document.getElementById("wfu_subfolders_newitemlevel2_"+e).value="",s.disabled=0==item.level,_.disabled=0==item.level,0==item.level?(s.value="{root}",u.value="{upload folder}"):(s.value="",u.value="");for(var i=document.getElementsByName("wfu_subfolder_nav_"+e),c=0;c<i.length;c++)i[c].disabled=!0}}function wfu_subfolders_browse_clicked(e){var t=wfu_GetHttpRequestObject();if(null!=t){var n=null;try{n=new FormData}catch(e){}if(null!=n){for(var o=document.getElementById("wfu_global_dialog_container"),a=document.getElementById("wfu_subfolders_browser_"+e),l=document.getElementById("wfu_subfolders_browse_"+e),r=document.getElementById("wfu_subfolders_inner_shadow_"+e),s=document.getElementById("wfu_subfolders_browser_msgcont_"+e),u=document.getElementById("wfu_subfolders_browser_msg_"+e),d=document.getElementById("wfu_subfolders_browser_img_"+e),_=document.getElementById("wfu_subfolders_browser_ok_"+e),i=document.getElementById("wfu_subfolders_browser_list_"+e);i.options.length>0;)i.options.remove(0);_.disabled=!0,_.onclick=function(){wfu_folder_browser_cancel_clicked(e)},u.innerHTML="loading folder contents...",d.style.display="inline",s.style.display="block",o.style.display="block",a.style.display="block",a.style.left=l.offsetLeft+l.offsetWidth-a.offsetWidth+"px",a.style.top=l.offsetTop+l.offsetHeight-a.offsetHeight+"px",r.style.display="block",o.onclick=function(){wfu_folder_browser_cancel_clicked(e)};var c=document.getElementById("wfu_attribute_uploadpath").value;"/"==c.substr(c.length-1)&&(c=c.substr(0,c.length-1));var f=wfu_get_relative_path(e).split(","),m=c+f[0];"/"!=m.substr(0)&&(m="/"+m);var p="";2==f.length&&(p=f[1]),n.append("action","wfu_ajax_action_read_subfolders"),n.append("folder1",wfu_plugin_encode_string(m)),n.append("folder2",wfu_plugin_encode_string(p)),t.key=e,t.addEventListener("load",wfu_readfolderComplete,!1),t.addEventListener("error",wfu_readfolderFailed,!1),t.addEventListener("abort",wfu_readfolderCanceled,!1),t.open("POST",AdminParams.wfu_ajax_url),t.send(n)}}}function wfu_readfolderComplete(e){var t=e.target.key,n=document.getElementById("wfu_subfolders_browser_msgcont_"+t),o=document.getElementById("wfu_subfolders_browser_msg_"+t),a=document.getElementById("wfu_subfolders_browser_img_"+t),l=document.getElementById("wfu_subfolders_browser_list_"+t),r=document.getElementById("wfu_subfolders_browser_ok_"+t),s=document.getElementById("wfu_subfolders_path_"+t),u=document.getElementById("wfu_subfolders_label_"+t);if(-1!=e.target.responseText){var d=e.target.responseText.indexOf("wfu_read_subfolders:");-1==d&&(d=e.target.responseText.length),e.target.responseText.substr(0,d);var _=e.target.responseText.substr(d+20,e.target.responseText.length-d-20);d=_.indexOf(":");var i=_.substr(0,d);if(txt_value=_.substr(d+1,_.length-d-1),"success"==i){for(var c,f=wfu_plugin_decode_string(txt_value).split(","),m=0,p=0;p<f.length;p++)""!=f[p]&&((c=document.createElement("option")).value=f[p],c.innerHTML=f[p].replace("*","&nbsp;&nbsp;&nbsp;"),l.add(c),m++);0==m&&((c=document.createElement("option")).value="",c.innerHTML="{empty}",c.disabled=!0,l.add(c)),l.selectedIndex=-1,r.onclick=function(){var e=l.options[l.selectedIndex].value,n=parseInt(document.getElementById("wfu_subfolders_newitemlevel_"+t).value);"*"!=e.substr(0,1)&&0!=n||(document.getElementById("wfu_subfolders_newitemlevel_"+t).value=n+1,n>0&&(e=e.substr(1))),s.value=e,u.value=e,wfu_folder_browser_cancel_clicked(t),wfu_subfolders_ok_clicked(t)},n.style.display="none"}else"error"==i?(o.innerHTML=txt_value,a.style.display="none",r.disabled=!1):(o.innerHTML="Unknown error",a.style.display="none",r.disabled=!1)}}function wfu_readfolderFailed(e){var t=e.target.key,n=document.getElementById("wfu_subfolders_browser_msg_"+t),o=document.getElementById("wfu_subfolders_browser_img_"+t),a=document.getElementById("wfu_subfolders_browser_ok_"+t);n.innerHTML="Unknown error",o.style.display="none",a.disabled=!1}function wfu_readfolderCanceled(e){var t=e.target.key,n=document.getElementById("wfu_subfolders_browser_msg_"+t),o=document.getElementById("wfu_subfolders_browser_img_"+t),a=document.getElementById("wfu_subfolders_browser_ok_"+t);n.innerHTML="Unknown error",o.style.display="none",a.disabled=!1}function wfu_subfolders_browser_list_changed(e){var t=document.getElementById("wfu_subfolders_browser_list_"+e);document.getElementById("wfu_subfolders_browser_ok_"+e).disabled=t.selectedIndex<0}function wfu_folder_browser_cancel_clicked(e){var t=document.getElementById("wfu_global_dialog_container"),n=document.getElementById("wfu_subfolders_browser_"+e),o=(document.getElementById("wfu_subfolders_browse_"+e),document.getElementById("wfu_subfolders_inner_shadow_"+e));t.onclick=null,o.style.display="none",n.style.display="none",t.style.display="none"}function wfu_get_relative_path(e){var t=document.getElementById("wfu_attribute_"+e);if(!(t.selectedIndex<0)){var n,o=t.data,a="1"==document.getElementById("wfu_subfolders_isnewitem_"+e).value;n=a?parseInt(document.getElementById("wfu_subfolders_newitemlevel_"+e).value):o[t.selectedIndex].level;for(var l="/",r=t.selectedIndex-1,s=n;r>=0&&s>1;)o[r].level<s&&(l="/"+o[r].path+l,s=o[r].level),r--;return a&&"1"==document.getElementById("wfu_subfolders_newitemlevel2_"+e).value&&n>0&&t.selectedIndex>0&&(l+=","+o[t.selectedIndex-1].path),l}}function wfu_subfolders_changed(e){wfu_update_subfolder_list(e),wfu_subfolders_update_toolnav(e)}function wfu_subfolders_update_toolnav(e){var t,n,o=document.getElementById("wfu_attribute_"+e),a=document.getElementById("wfu_subfolder_tools_"+e),l=document.getElementById("wfu_subfolders_path_"+e),r=document.getElementById("wfu_subfolders_label_"+e),s=document.getElementById("wfu_subfolders_ok_"+e),u=document.getElementById("wfu_subfolders_browse_"+e),d=document.getElementById("wfu_subfolders_auto_"+e);if(document.getElementById("wfu_subfolders_isnewitem_"+e).value="",document.getElementById("wfu_subfolders_newitemindex_"+e).value="",document.getElementById("wfu_subfolders_newitemlevel_"+e).value="",document.getElementById("wfu_subfolders_newitemlevel2_"+e).value="",null==o.data?(t=wfu_decode_subfolder_list(e),o.data=t):t=o.data,0===o.data.length?(o.className="wfu_select_folders wfu_select_folders_empty",o.options[0].innerHTML=d.checked?"":"press here"):o.className="wfu_select_folders",o.selectedIndex<0)a.className="wfu_subfolder_tools_container wfu_subfolder_tools_disabled",l.disabled=!0,r.disabled=!0,s.disabled=!0,u.disabled=!0,r.value="",l.value="";else if(o.selectedIndex>=o.options.length-1){var _;a.className="wfu_subfolder_tools_container",r.disabled=!1,s.disabled=!0,document.getElementById("wfu_subfolders_isnewitem_"+e).value="1",document.getElementById("wfu_subfolders_newitemindex_"+e).value=t.length,_=0==t.length?0:0==t[t.length-1].level?1:t[t.length-1].level,document.getElementById("wfu_subfolders_newitemlevel_"+e).value=_,document.getElementById("wfu_subfolders_newitemlevel2_"+e).value="1",l.disabled=0==_,u.disabled=!1,0==_?(l.value="{root}",r.value="{upload folder}"):(l.value="",r.value="")}else a.className="wfu_subfolder_tools_container",r.disabled=!1,s.disabled=!0,n=t[o.selectedIndex],l.disabled=0==n.level,u.disabled=0==n.level,r.value=n.label,l.value=n.path;var i=document.getElementsByName("wfu_subfolder_nav_"+e);if(o.selectedIndex<0||o.selectedIndex>=o.options.length-1)for(var c=0;c<i.length;c++)i[c].disabled=!0;else wfu_subfolders_update_nav(e)}function wfu_subfolders_update_nav(e){var t=document.getElementById("wfu_attribute_"+e),n=document.getElementById("wfu_subfolders_up_"+e),o=document.getElementById("wfu_subfolders_down_"+e),a=document.getElementById("wfu_subfolders_left_"+e),l=document.getElementById("wfu_subfolders_right_"+e),r=document.getElementById("wfu_subfolders_add_"+e),s=document.getElementById("wfu_subfolders_def_"+e),u=document.getElementById("wfu_subfolders_del_"+e),d=t.data,_=d[t.selectedIndex];for(n.disabled=_.index<=0,ind=t.selectedIndex+1,nextind=0;ind<d.length;){if(d[ind].level==_.level){nextind=d[ind].index;break}if(d[ind].level<_.level)break;ind++}o.disabled=0==_.level||0==nextind,a.disabled=0==t.selectedIndex&&_.level<1||t.selectedIndex>0&&_.level<=1,t.selectedIndex>=1?prevlevel=d[t.selectedIndex-1].level:prevlevel=0,l.disabled=_.level-prevlevel>0,r.disabled=0==_.level,s.disabled=!1,s.className="button"+(_.default?" wfu_subfolder_nav_pressed":""),u.disabled=!1}function wfu_decode_subfolder(e){var t={label:"",path:"",level:0,default:!1};e=e.trim();for(var n=0,o=!1;n<e.length&&"*"==e.substr(n,1);)n++;"&"==(e=e.substr(n,e.length-n)).substr(0,1)&&(e=e.substr(1),o=!0),t.level=n,t.default=o;var a=e.split("/");return 1==a.length?(t.path=a[0],t.label=a[0]):a.length>1&&(t.path=a[0],t.label=a[1]),0==n&&(t.path="{root}",""==t.label&&(t.label="{upload folder}")),t}function wfu_decode_subfolder_list(e){for(var t,n=document.getElementById("wfu_attribute_"+e).options,o=Array(),a=["root"],l=[0],r=-1,s=0;s<n.length-1;s++){for(o.push(wfu_decode_subfolder(wfu_plugin_decode_string(n[s].value))),a.length>o[s].level?a[o[s].level]=o[s].path:a.push(o[s].path),t="",j=1;j<=o[s].level;j++)t+=a[j]+"/";o[s].fullpath=t,l.length<=o[s].level&&l.push(0),o[s].level>r?o[s].index=0:o[s].index=l[o[s].level]+1,l[o[s].level]=o[s].index,r=o[s].level}return o}function wfu_update_subfolder_list(e){var t=document.getElementById("wfu_attribute_"+e).options,n=document.getElementById("wfu_attribute_"+e).data;if(null!=n){var o,a,l="";t.length=n.length+1;for(var r=0;r<n.length;r++){for(o="",a="",j=0;j<n[r].level;j++)o+="*",a+="&nbsp;&nbsp;&nbsp;";n[r].default?(o+="&",t[r].className="wfu_select_folders_option_default"):t[r].className="",o+=n[r].path+"/"+n[r].label,a+=n[r].label,t[r].value=wfu_plugin_encode_string(o),t[r].innerHTML=a,""!=l&&(l+=","),l+=o}return t[n.length].value="",t[n.length].innerHTML="",l}}function wfu_userdata_edit_field(e,t,n){for(var o,a=0;a<e.childNodes.length;a++)"INPUT"==(o=e.childNodes[a]).tagName?"text"==o.type?(o.value=t,wfu_attach_element_handlers(o,wfu_update_userfield_value)):"checkbox"==o.type&&(o.checked=n):"DIV"==o.tagName&&(o.className="wfu_userdata_action")}function wfu_formdata_edit_field(e,t,n){}function wfu_formdata_get_field_props(e){var t=e.split("_")[0],n="wfu_formfield_"+e,o=window["wfu_attribute_"+t+"_typeprops"][document.getElementById(n+"_type").value];return{type:document.getElementById(n+"_type").value,label:""==o.label?document.getElementById(n+"_label").value:o.label,labelposition:"show"==o.labelposition.substr(0,4)&&document.getElementById(n+"_labelposition")?document.getElementById(n+"_labelposition").value:o.labelposition.substr(5),required:"show"==o.required.substr(0,4)&&document.getElementById(n+"_required")?document.getElementById(n+"_required").checked:"true"==o.required.substr(5),donotautocomplete:"show"==o.donotautocomplete.substr(0,4)&&document.getElementById(n+"_donotautocomplete")?document.getElementById(n+"_donotautocomplete").checked:"true"==o.donotautocomplete.substr(5),validate:"show"==o.validate.substr(0,4)&&document.getElementById(n+"_validate")?document.getElementById(n+"_validate").checked:"true"==o.validate.substr(5),typehook:"show"==o.typehook.substr(0,4)&&document.getElementById(n+"_typehook")?document.getElementById(n+"_typehook").checked:"true"==o.typehook.substr(5),hintposition:"show"==o.hintposition.substr(0,4)&&document.getElementById(n+"_hintposition")?document.getElementById(n+"_hintposition").value:o.hintposition.substr(5),default:"show"==o.default.substr(0,4)&&document.getElementById(n+"_default")?document.getElementById(n+"_default").value:o.default.substr(5),data:"show"==o.data.substr(0,4)&&document.getElementById(n+"_data")?document.getElementById(n+"_data").value:o.data.substr(5),group:"show"==o.group.substr(0,4)&&document.getElementById(n+"_group")?document.getElementById(n+"_group").value:o.group.substr(5),format:"show"==o.format.substr(0,4)&&document.getElementById(n+"_format")?document.getElementById(n+"_format").value:o.format.substr(5)}}function wfu_formdata_type_changed(e){var t=e.split("_")[0],n="wfu_formfield_"+e,o=document.getElementById(n+"_container"),a=wfu_formdata_prepare_template(t,wfu_formdata_get_field_props(e),e);o.innerHTML=a;for(var l=document.querySelectorAll("div#"+n+'_container input[name="wfu_formfield_elements"]'),r=0;r<l.length;r++)wfu_attach_element_handlers(l[r],wfu_update_formfield_value);wfu_formdata_update_buttons(e),wfu_update_formfield_value({target:o})}function wfu_userdata_add_field(e){var t=e.parentNode,n=t.cloneNode(!0);wfu_userdata_edit_field(n,"",!1),t.parentNode.insertBefore(n,t.nextSibling)}function wfu_formdata_add_field(e){var t=e.split("_"),n=t[0],o=(t[1],document.getElementById("wfu_attribute_"+n)),a=document.getElementById("wfu_formfield_"+e+"_container"),l=document.createElement("DIV"),r=n+"_"+wfu_randomString(4);l.id="wfu_formfield_"+r+"_container",l.className="wfu_formdata_line_container",o.insertBefore(l,a.nextSibling);var s=wfu_formdata_prepare_template(n,{type:"text",label:"",labelposition:"left",required:!1,donotautocomplete:!1,validate:!1,default:"",data:"",group:"",format:"",hintposition:"right",typehook:!1},r);l.innerHTML=s;for(var u=document.querySelectorAll("div#wfu_formfield_"+r+'_container input[name="wfu_formfield_elements"]'),d=0;d<u.length;d++)wfu_attach_element_handlers(u[d],wfu_update_formfield_value);wfu_formdata_update_buttons(e),wfu_formdata_update_buttons(r),wfu_update_formfield_value({target:l})}function wfu_formdata_prepare_template(e,t,n){var o=wfu_plugin_decode_string(window["wfu_attribute_"+e+"_formtemplate"]),a=window["wfu_attribute_"+e+"_typeprops"][t.type],l=window["wfu_attribute_"+e+"_typeprops"][0].split(","),r=["label","required","donotautocomplete","validate","typehook","labelposition","hintposition","default","data","group","format"],s=["none","top","right","bottom","left","placeholder"],u=["none","inline","top","right","bottom","left"];o=o.replace(/\[\[key\]\]/g,n).replace(/\[\[t\]\]/g,t.type).replace(/\[\[label\]\]/g,t.label).replace(/\[\[s\]\]/g,t.labelposition).replace(/\[\[d\]\]/g,t.default).replace(/\[\[l\]\]/g,t.data).replace(/\[\[label_label\]\]/g,a.label_label).replace(/\[\[data_label\]\]/g,a.data_label).replace(/\[\[g\]\]/g,t.group).replace(/\[\[f\]\]/g,t.format).replace(/\[\[p\]\]/g,t.hintposition);for(var d=0;d<r.length;d++)o=o.replace(new RegExp("\\[\\["+r[d]+"_hint\\]\\]","g"),a[r[d]+"_hint"]);for(d=0;d<l.length;d++)o=o.replace("[[type_"+l[d]+"_selected]]",l[d]==t.type?' selected="selected"':"");for(d=0;d<s.length;d++)o=o.replace("[[labelposition_"+s[d]+"_selected]]",s[d]==t.labelposition?' selected="selected"':"");for(d=0;d<u.length;d++)o=o.replace("[[hintposition_"+u[d]+"_selected]]",u[d]==t.hintposition?' selected="selected"':"");return o=(o=(o=o.replace("[[remove_disabled]]","")).replace("[[up_disabled]]","")).replace("[[down_disabled]]",""),o=t.required?o.replace(/\[\[r\-\>\]\]|\[\[\<\-r\]\]/g,""):o.replace(/\[\[r\-\>\]\].*\[\[\<\-r\]\]/g,""),o=t.donotautocomplete?o.replace(/\[\[a\-\>\]\]|\[\[\<\-a\]\]/g,""):o.replace(/\[\[a\-\>\]\].*\[\[\<\-a\]\]/g,""),o=t.validate?o.replace(/\[\[v\-\>\]\]|\[\[\<\-v\]\]/g,""):o.replace(/\[\[v\-\>\]\].*\[\[\<\-v\]\]/g,""),o=t.typehook?o.replace(/\[\[h\-\>\]\]|\[\[\<\-h\]\]/g,""):o.replace(/\[\[h\-\>\]\].*\[\[\<\-h\]\]/g,""),o="show"==a.labelposition.substr(0,4)?o.replace(/\[\[S\-\>\]\]|\[\[\<\-S\]\]/g,""):o.replace(/\[\[S\-\>\]\][^]*\[\[\<\-S\]\]/g,""),o="show"==a.required.substr(0,4)?o.replace(/\[\[R\-\>\]\]|\[\[\<\-R\]\]/g,""):o.replace(/\[\[R\-\>\]\][^]*\[\[\<\-R\]\]/g,""),o="show"==a.donotautocomplete.substr(0,4)?o.replace(/\[\[A\-\>\]\]|\[\[\<\-A\]\]/g,""):o.replace(/\[\[A\-\>\]\][^]*\[\[\<\-A\]\]/g,""),o="show"==a.validate.substr(0,4)?o.replace(/\[\[V\-\>\]\]|\[\[\<\-V\]\]/g,""):o.replace(/\[\[V\-\>\]\][^]*\[\[\<\-V\]\]/g,""),o="show"==a.hintposition.substr(0,4)?o.replace(/\[\[P\-\>\]\]|\[\[\<\-P\]\]/g,""):o.replace(/\[\[P\-\>\]\][^]*\[\[\<\-P\]\]/g,""),o="show"==a.typehook.substr(0,4)?o.replace(/\[\[H\-\>\]\]|\[\[\<\-H\]\]/g,""):o.replace(/\[\[H\-\>\]\][^]*\[\[\<\-H\]\]/g,""),o="show"==a.default.substr(0,4)?o.replace(/\[\[D\-\>\]\]|\[\[\<\-D\]\]/g,""):o.replace(/\[\[D\-\>\]\][^]*\[\[\<\-D\]\]/g,""),o="show"==a.data.substr(0,4)?o.replace(/\[\[L\-\>\]\]|\[\[\<\-L\]\]/g,""):o.replace(/\[\[L\-\>\]\][^]*\[\[\<\-L\]\]/g,""),o="show"==a.group.substr(0,4)?o.replace(/\[\[G\-\>\]\]|\[\[\<\-G\]\]/g,""):o.replace(/\[\[G\-\>\]\][^]*\[\[\<\-G\]\]/g,""),"show"==a.format.substr(0,4)?o.replace(/\[\[F\-\>\]\]|\[\[\<\-F\]\]/g,""):o.replace(/\[\[F\-\>\]\][^]*\[\[\<\-F\]\]/g,"")}function wfu_userdata_remove_field(e){for(var t=e.parentNode,n=t.parentNode,o=null,a=0;a<n.childNodes.length;a++)if(1===n.childNodes[a].nodeType){o=n.childNodes[a];break}if(t!=o)for(t.parentNode.removeChild(t),a=0;a<o.childNodes.length;a++)if(1===o.childNodes[a].nodeType){wfu_update_userfield_value({target:o.childNodes[a]});break}}function wfu_formdata_remove_field(e){var t=e.split("_")[0],n=document.querySelectorAll("div#wfu_attribute_"+t+" .wfu_formdata_line_container");if(!(n.length<2)){for(var o=document.getElementById("wfu_attribute_"+t),a=document.getElementById("wfu_formfield_"+e+"_container"),l=0,r=0;r<n.length;r++)if(n[r]==a){l=r+1;break}o.removeChild(a),l>(n=document.querySelectorAll("div#wfu_attribute_"+t+" .wfu_formdata_line_container")).length&&(l=n.length),wfu_formdata_update_buttons((a=n[l-1]).id.replace(/^wfu_formfield_/,"").replace(/_container$/,"")),wfu_update_formfield_value({target:a})}}function wfu_formdata_move_field(e,t){for(var n=e.split("_")[0],o=document.querySelector("div#wfu_attribute_"+n+" .wfu_formdata_all_attributes").value.split(","),a=o.indexOf(n)+1,l=document.querySelectorAll("div#wfu_attribute_"+n+" .wfu_formdata_line_container"),r=document.getElementById("wfu_attribute_"+n),s=document.getElementById("wfu_formfield_"+e+"_container"),u=0,d=0;d<l.length;d++)if(l[d]==s){u=d+1;break}if(!("up"==t&&1==a&&1==u||"down"==t&&a==o.length&&u==l.length)){var _,i=wfu_formdata_get_field_props(e),c=n,f=s;"up"==t?u>1?f=l[u-2]:(c=o[a-2],f=(_=document.querySelectorAll("div#wfu_attribute_"+c+" .wfu_formdata_line_container"))[_.length-1]):u<l.length?f=l[u]:(c=o[a],f=(_=document.querySelectorAll("div#wfu_attribute_"+c+" .wfu_formdata_line_container"))[0]);var m=f.id.replace(/^wfu_formfield_/,"").replace(/_container$/,"");if(c==n)"up"==t?r.insertBefore(s,f):r.insertBefore(f,s);else{var p=wfu_formdata_get_field_props(m),w=wfu_formdata_prepare_template(c,i,m);f.innerHTML=w;var v=document.querySelectorAll("div#wfu_formfield_"+m+'_container input[name="wfu_formfield_elements"]');for(d=0;d<v.length;d++)wfu_attach_element_handlers(v[d],wfu_update_formfield_value);for(w=wfu_formdata_prepare_template(n,p,e),s.innerHTML=w,v=document.querySelectorAll("div#wfu_formfield_"+e+'_container input[name="wfu_formfield_elements"]'),d=0;d<v.length;d++)wfu_attach_element_handlers(v[d],wfu_update_formfield_value)}wfu_formdata_update_buttons(e),wfu_formdata_update_buttons(m),wfu_update_formfield_value({target:s}),c!=n&&wfu_update_formfield_value({target:f})}}function wfu_formdata_update_buttons(e){for(var t=e.split("_")[0],n=document.querySelector("div#wfu_attribute_"+t+" .wfu_formdata_all_attributes").value.split(","),o=n.indexOf(t)+1,a=document.querySelectorAll("div#wfu_attribute_"+t+" .wfu_formdata_line_container"),l=document.getElementById("wfu_formfield_"+e+"_container"),r=0,s=0;s<a.length;s++)if(a[s]==l){r=s+1;break}var u=document.querySelector("div#wfu_formfield_"+e+"_container .wfu_formdata_action.wfu_formdata_action_up"),d=document.querySelector("div#wfu_formfield_"+e+"_container .wfu_formdata_action.wfu_formdata_action_down"),_=document.querySelectorAll("div#wfu_attribute_"+t+" .wfu_formdata_action_remove");for(u.className="wfu_formdata_action wfu_formdata_action_up"+(1==o&&1==r?" wfu_formdata_action_disabled":""),d.className="wfu_formdata_action wfu_formdata_action_down"+(o==n.length&&r==a.length?" wfu_formdata_action_disabled":""),s=0;s<_.length;s++)_[s].className="wfu_formdata_action wfu_formdata_action_remove"+(_.length>1?"":" wfu_formdata_action_disabled")}function wfu_formdata_update_all_updown_buttons(e){for(var t=document.querySelector("div#wfu_attribute_"+e+" .wfu_formdata_all_attributes").value.split(","),n=0;n<t.length;n++)for(var o=n+1,a=document.querySelectorAll("div#wfu_attribute_"+t[n]+" .wfu_formdata_line_container"),l=0;l<a.length;l++){var r=l+1,s=a[l].id.replace(/^wfu_formfield_/,"").replace(/_container$/,""),u=document.querySelector("div#wfu_formfield_"+s+"_container .wfu_formdata_action.wfu_formdata_action_up"),d=document.querySelector("div#wfu_formfield_"+s+"_container .wfu_formdata_action.wfu_formdata_action_down");u.className="wfu_formdata_action wfu_formdata_action_up"+(1==o&&1==r?" wfu_formdata_action_disabled":""),d.className="wfu_formdata_action wfu_formdata_action_down"+(o==t.length&&r==a.length?" wfu_formdata_action_disabled":"")}}function wfu_generate_shortcode(){for(var e,t=document.getElementById("wfu_shortcode_tag").value,n=document.getElementById("wfu_attribute_defaults"),o=(document.getElementById("wfu_attribute_values"),""),a="",l="["+t,r="",s=0;s<n.childNodes.length;s++)1===(e=n.childNodes[s]).nodeType&&(o=e.id.replace("wfu_attribute_default_",""),a=document.getElementById("wfu_attribute_value_"+o).value,e.value!=a&&(r+=" "+o+'="'+a+'"'));l+=r+"]",document.getElementById("wfu_shortcode").value=l,ShortcodeString=r.substr(1),document.getElementById("wfu_update_shortcode")&&(document.getElementById("wfu_update_shortcode").disabled=wfu_plugin_encode_string(l)==document.getElementById("wfu_shortcode_original_enc").value),Autosave&&wfu_schedule_save_shortcode()}function wfu_update_text_value(e){var t=(e=e||window.event).target,n=t.id.replace("wfu_attribute_",""),o=t.value;(o=(o=(o=(o=o.replace(/(\r\n|\n|\r)/gm,"%n%")).replace(/\"/gm,"%dq%")).replace(/\[/gm,"%brl%")).replace(/\]/gm,"%brr%"))!==t.oldVal&&(t.oldVal=o,document.getElementById("wfu_attribute_value_"+n).value=o,wfu_generate_shortcode())}function wfu_update_date_value(e){var t=(e=e||window.event).target,n=t.id.replace("wfu_attribute_",""),o=t.value;o!==t.oldVal&&(t.oldVal=o,document.getElementById("wfu_attribute_value_"+n).value=o,wfu_generate_shortcode())}function wfu_update_stringmatch_textvalue(e){var t=(e=e||window.event).target.id.replace("wfu_attribute_","");wfu_update_stringmatch_value(t=t.replace("_matchfield","").replace("_matchvalue",""))}function wfu_update_triplecolor_value(e){var t=(e=e||window.event).target,n=t.id.replace("wfu_attribute_","");n=(n=(n=n.replace("_color","")).replace("_bgcolor","")).replace("_borcolor","");var o=(t=document.getElementById("wfu_attribute_"+n+"_color")).value+","+document.getElementById("wfu_attribute_"+n+"_bgcolor").value+","+document.getElementById("wfu_attribute_"+n+"_borcolor").value;o!==t.oldVal&&(t.oldVal=o,document.getElementById("wfu_attribute_value_"+n).value=o,wfu_generate_shortcode())}function wfu_update_dimension_value(e){var t=(e=e||window.event).target,n=t.name.replace("wfu_dimension_elements_",""),o=document.getElementsByName(t.name);t=o[0];for(var a="",l="",r=0;r<o.length;r++)l=o[r].id.replace("wfu_attribute_"+n+"_",""),""!=a&&""!=o[r].value&&(a+=", "),""!=o[r].value&&(a+=l+":"+o[r].value);a!==t.oldVal&&(t.oldVal=a,document.getElementById("wfu_attribute_value_"+n).value=a,wfu_generate_shortcode())}function wfu_update_ptext_value(e){var t=(e=e||window.event).target,n=t.id.replace("wfu_attribute_","");n=n.substr(2);var o=document.getElementById("wfu_attribute_s_"+n).value+"/"+document.getElementById("wfu_attribute_p_"+n).value;o!==t.oldVal&&(t.oldVal=o,document.getElementById("wfu_attribute_value_"+n).value=o),wfu_generate_shortcode()}function wfu_update_mchecklist_value(e){var t="";document.getElementById("wfu_attribute_"+e),document.getElementById("wfu_attribute_"+e+"_all").checked?(jQuery("#wfu_attribute_"+e+" input").prop("disabled",!0),jQuery("#wfu_attribute_"+e+" input").prop("checked",!0),t="all"):(jQuery("#wfu_attribute_"+e+" input").prop("disabled",!1),jQuery("#wfu_attribute_"+e+" input").each((function(){jQuery(this).prop("checked")&&(t+=","+jQuery(this).next().html())})),t=t.substr(1)),document.getElementById("wfu_attribute_value_"+e).value=t,wfu_generate_shortcode()}function wfu_update_rolelist_value(e){var t="",n=document.getElementById("wfu_attribute_"+e),o=document.getElementById("wfu_attribute_"+e+"_guests");if(document.getElementById("wfu_attribute_"+e+"_all").checked)n.disabled=!0,t="all";else{n.disabled=!1;for(var a=n.options,l=0;l<a.length;l++)a[l].selected&&(""!=t&&(t+=","),t+=a[l].value)}o.checked&&(""!=t&&(t+=","),t+="guests"),document.getElementById("wfu_attribute_value_"+e).value=t,wfu_generate_shortcode()}function wfu_update_userlist_value(e){var t="",n=document.getElementById("wfu_attribute_"+e),o=document.getElementById("wfu_attribute_"+e+"_current"),a=document.getElementById("wfu_attribute_"+e+"_guests"),l=document.getElementById("wfu_attribute_"+e+"_all");if(o&&o.checked)n.disabled=!0,l.disabled=!0,a.disabled=!0,t="current";else{if(l.disabled=!1,a.disabled=!1,l.checked)n.disabled=!0,t="all";else{n.disabled=!1;for(var r=n.options,s=0;s<r.length;s++)r[s].selected&&(""!=t&&(t+=","),t+=r[s].value)}a.checked&&(""!=t&&(t+=","),t+="guests")}document.getElementById("wfu_attribute_value_"+e).value=t,wfu_generate_shortcode()}function wfu_update_postlist_value(e){for(var t="",n=Array(),o=Array(),a=document.getElementById("wfu_attribute_"+e+"_postlist").value.split(","),l=0;l<a.length;l++)n.push(document.getElementById("wfu_attribute_"+e+"_"+a[l])),o.push(document.getElementById("wfu_attribute_"+e+"_all_"+a[l]));var r=document.getElementById("wfu_attribute_"+e+"_current");if(r&&r.checked){for(l=0;l<a.length;l++)n[l].disabled=!0,o[l].disabled=!0;t="current"}else{var s=!0;for(t="",l=0;l<a.length;l++)if(o[l].disabled=!1,o[l].checked)n[l].disabled=!0,""!=t&&(t+=","),t+="all"+a[l];else{n[l].disabled=!1,s=!1;for(var u=n[l].options,d=0;d<u.length;d++)u[d].selected&&(""!=t&&(t+=","),t+=u[d].value)}s&&(t="all")}document.getElementById("wfu_attribute_value_"+e).value=t,wfu_generate_shortcode()}function wfu_update_bloglist_value(e){var t="",n=document.getElementById("wfu_attribute_"+e),o=document.getElementById("wfu_attribute_"+e+"_current"),a=document.getElementById("wfu_attribute_"+e+"_all");if(o&&o.checked)n.disabled=!0,a.disabled=!0,t="current";else if(a.disabled=!1,a.checked)n.disabled=!0,t="all";else{n.disabled=!1;for(var l=n.options,r=0;r<l.length;r++)l[r].selected&&(""!=t&&(t+=","),t+=l[r].value)}document.getElementById("wfu_attribute_value_"+e).value=t,wfu_generate_shortcode()}function wfu_update_stringmatch_value(e){var t=document.getElementById("wfu_attribute_"+e+"_matchfield").value,n=document.getElementById("wfu_attribute_"+e+"_matchcriterion").value,o=document.getElementById("wfu_attribute_"+e+"_matchvalue").value;""==(t=t.replace(";","")).trim()?document.getElementById("wfu_attribute_value_"+e).value="":document.getElementById("wfu_attribute_value_"+e).value="field:"+t+";criterion:"+n+";value:"+o,wfu_generate_shortcode()}function wfu_update_userfield_value(e){for(var t=(e=e||window.event).target,n=t.parentNode,o=n.parentNode,a="",l=!1,r="",s=0;s<o.childNodes.length;s++)if("DIV"===(n=o.childNodes[s]).tagName){for(var u=0;u<n.childNodes.length;u++)"INPUT"==n.childNodes[u].tagName&&("text"==n.childNodes[u].type?(a=n.childNodes[u].value,0==s&&(t=n.childNodes[u])):"checkbox"==n.childNodes[u].type&&(l=n.childNodes[u].checked));""!=r&&""!=a&&(r+="/"),""!=a&&l&&(r+="*"),""!=a&&(r+=a)}r!==t.oldVal&&(t.oldVal=r,document.getElementById("wfu_attribute_value_userdatalabel").value=r,wfu_generate_shortcode(),wfu_update_formfield_variables())}function wfu_update_ftpinfobase_value(e){var t=(e=e||window.event).target,n=t.id.replace("wfu_attribute_",""),o=t.value;t.freezetool=!0;var a=wfu_decode_ftpinfo(o),l=document.getElementById("ftpinfo_username"),r=document.getElementById("ftpinfo_password"),s=document.getElementById("ftpinfo_domain"),u=document.getElementById("ftpinfo_port"),d=document.getElementById("ftpinfo_sftp");a.error?(t.classList.add("ftpinfo_error"),l.classList.add("ftpinfo_error"),r.classList.add("ftpinfo_error"),s.classList.add("ftpinfo_error"),u.classList.add("ftpinfo_error"),d.classList.add("ftpinfo_error")):(t.classList.remove("ftpinfo_error"),l.classList.remove("ftpinfo_error"),r.classList.remove("ftpinfo_error"),s.classList.remove("ftpinfo_error"),u.classList.remove("ftpinfo_error"),d.classList.remove("ftpinfo_error")),l.value=a.data.username,r.value=a.data.password,s.value=a.data.ftpdomain,u.value=a.data.port,d.checked=a.data.sftp,t.freezetool=!1,o!==t.oldVal&&(t.oldVal=o,document.getElementById("wfu_attribute_value_"+n).value=o,wfu_generate_shortcode())}function wfu_update_ftpinfotool_value(e){var t=document.querySelector(".ftpinfo_btn").previousElementSibling;if(!t.freezetool){t.id.replace("wfu_attribute_","");var n=document.getElementById("ftpinfo_username").value,o=document.getElementById("ftpinfo_password").value,a=document.getElementById("ftpinfo_domain").value,l=document.getElementById("ftpinfo_port").value;document.getElementById("ftpinfo_sftp").checked&&(l="s"+l);var r=n.replace(/:/g,"\\\\:").replace(/@/g,"\\\\@");""!=o&&(r+=":"+o.replace(/:/g,"\\\\:").replace(/@/g,"\\\\@")),r+="@"+a,""!=l&&(r+=":"+l),t.value=r,wfu_update_ftpinfobase_value({target:t})}}function wfu_update_formfield_value(e){for(var t=(e=e||window.event).target,n=t.id.match(/^wfu_formfield_(.*?)_/)[1],o=document.querySelectorAll("div#wfu_attribute_"+n+" .wfu_formdata_line_container"),a="",l=0;l<o.length;l++){var r="",s=n+"_"+o[l].id.match(/^wfu_formfield_.*?_(.*?)_/)[1],u=document.getElementById("wfu_formfield_"+s+"_label").value;if(""!=u.trim()){r=u.trim();var d=document.getElementById("wfu_formfield_"+s+"_type").value,_=window["wfu_attribute_"+n+"_typeprops"];r+="|t:"+d,"show"==_[d].labelposition.substr(0,4)&&(r+="|s:"+document.getElementById("wfu_formfield_"+s+"_labelposition").value),"show"==_[d].required.substr(0,4)&&(r+="|r:"+(document.getElementById("wfu_formfield_"+s+"_required").checked?"1":"0")),"show"==_[d].donotautocomplete.substr(0,4)&&(r+="|a:"+(document.getElementById("wfu_formfield_"+s+"_donotautocomplete").checked?"1":"0")),"show"==_[d].validate.substr(0,4)&&(r+="|v:"+(document.getElementById("wfu_formfield_"+s+"_validate").checked?"1":"0")),"show"==_[d].typehook.substr(0,4)&&(r+="|h:"+(document.getElementById("wfu_formfield_"+s+"_typehook").checked?"1":"0")),"show"==_[d].hintposition.substr(0,4)&&(r+="|p:"+document.getElementById("wfu_formfield_"+s+"_hintposition").value),"show"==_[d].default.substr(0,4)&&(r+="|d:"+document.getElementById("wfu_formfield_"+s+"_default").value),"show"==_[d].data.substr(0,4)&&(r+="|l:"+document.getElementById("wfu_formfield_"+s+"_data").value),"show"==_[d].group.substr(0,4)&&(r+="|g:"+document.getElementById("wfu_formfield_"+s+"_group").value),"show"==_[d].format.substr(0,4)&&(r+="|f:"+document.getElementById("wfu_formfield_"+s+"_format").value)}""!=r&&(""!=a&&(a+="/"),a+=r)}a!==t.oldVal&&(t.oldVal=a,document.getElementById("wfu_attribute_value_"+n).value=a,wfu_generate_shortcode(),wfu_update_formfield_variables())}function wfu_update_formfield_variables(){var e=document.getElementById("wfu_attribute_value_userdatalabel");if(e){for(var t=document.querySelectorAll("#wfu_wrapper div.wfu_shadow_userdata"),n=document.getElementsByName("wfu_formfield_select"),o=0;o<n.length;o++)n[o].style.display="none";if(0!=t.length&&"block"!=t[0].style.display){for(var a='<option style="display:none;">%userdataXXX%</option>',l=e.value.replace(/\//g,"[/]").replace(/\(.*?\)/g,(function(e){return e.replace(/\[\/\]/g,"/")})).split("[/]"),r=2;document.getElementById("wfu_attribute_userdatalabel"+r);){var s=document.getElementById("wfu_attribute_value_userdatalabel"+r).value.replace(/\//g,"[/]").replace(/\(.*?\)/g,(function(e){return e.replace(/\[\/\]/g,"/")})).split("[/]");l=l.concat(s),r++}var u="",d=0;for(r=1,o=0;o<l.length;o++)"*"==(u=l[o])[0]&&(u=u.substr(1)),(d=u.indexOf("|"))>-1&&(u=u.substr(0,d)),""!=u.trim()&&(a+='<option value="%userdata'+r+'%">'+r+": "+u.trim()+"</option>",r++);for(o=0;o<n.length;o++)n[o].innerHTML=a,n[o].style.display="inline-block"}}}function wfu_attach_element_handlers(e,t){for(var n=["DOMAttrModified","textInput","input","change","keypress","paste","focus","propertychange"],o=0;o<n.length;o++)wfu_addEventHandler(e,n[o],t)}function wfu_Attach_Admin_Events(e){Autosave=e,wfu_generate_shortcode(),wfu_update_formfield_variables(),wfu_Attach_Admin_DragDrop_Events();for(var t=document.getElementsByName("wfu_text_elements"),n=0;n<t.length;n++)wfu_attach_element_handlers(t[n],wfu_update_text_value);var o=document.getElementsByName("wfu_ptext_elements");for(n=0;n<o.length;n++)wfu_attach_element_handlers(o[n],wfu_update_ptext_value);var a=document.getElementsByName("wfu_stringmatch_elements");for(n=0;n<a.length;n++)wfu_attach_element_handlers(a[n],wfu_update_stringmatch_textvalue);var l=document.getElementsByName("wfu_triplecolor_elements");for(n=0;n<l.length;n++)wfu_attach_element_handlers(l[n],wfu_update_triplecolor_value);var r=document.getElementsByName("wfu_dimension_elements_widths");for(n=0;n<r.length;n++)wfu_attach_element_handlers(r[n],wfu_update_dimension_value);for(r=document.getElementsByName("wfu_dimension_elements_heights"),n=0;n<r.length;n++)wfu_attach_element_handlers(r[n],wfu_update_dimension_value);var s=document.getElementsByName("wfu_userfield_elements");for(n=0;n<s.length;n++)wfu_attach_element_handlers(s[n],wfu_update_userfield_value);var u=document.getElementsByName("wfu_formfield_elements");for(n=0;n<u.length;n++)wfu_attach_element_handlers(u[n],wfu_update_formfield_value);var d=document.getElementsByName("wfu_ftpinfobase_elements");for(n=0;n<d.length;n++)wfu_attach_element_handlers(d[n],wfu_update_ftpinfobase_value);var _=document.getElementsByName("wfu_ftpinfotool_elements");for(n=0;n<_.length;n++)wfu_attach_element_handlers(_[n],wfu_update_ftpinfotool_value);var i=document.getElementsByName("wfu_subfolder_tools_input");for(n=0;n<i.length;n++)wfu_attach_element_handlers(i[n],wfu_subfolders_input_changed);var c=document.getElementsByName("wfu_columnprops_elements");for(n=0;n<c.length;n++)wfu_attach_element_handlers(c[n],wfu_columnprops_element_changed);""!=document.getElementById("wfu_shortcode_postid").value&&setTimeout((function(){wfu_check_page_obsolescence()}),CheckObsolescenceTimeOut),wfu_install_unload_hook()}function wfu_install_unload_hook(){window.onbeforeunload=wfu_unload_hook}function wfu_unload_hook(){if(!wfu_changes_saved())return 1}function wfu_changes_saved(){return wfu_plugin_encode_string(document.getElementById("wfu_shortcode").value)==document.getElementById("wfu_shortcode_original_enc").value}function wfu_force_save_changes(){document.getElementById("wfu_shortcode").value=wfu_plugin_decode_string(document.getElementById("wfu_shortcode_original_enc").value)}function wfu_insert_variable(e){var t=e.className.replace("wfu_variable wfu_variable_",""),n=document.getElementById("wfu_attribute_"+t),o=n.selectionStart,a=n.value;n.value=a.substr(0,o)+e.innerHTML+a.substr(o),wfu_update_text_value({target:n})}function wfu_runcustomaction(e){}function wfu_insert_userfield_variable(e){var t=e.className.replace("wfu_variable wfu_variable_",""),n=document.getElementById("wfu_attribute_"+t),o=n.selectionStart,a=n.value;n.value=a.substr(0,o)+e.value+a.substr(o),e.value="%userdataXXX%",wfu_update_text_value({target:n})}function wfu_columns_itemclicked(e,t){var n=e.parentNode;if("SELECT"==n.tagName){for(var o=0;o<n.options.length;o++)n.options[o].selected=n.options[o]==e;wfu_update_column_props(t)}}function wfu_columns_buttonaction(e,t){var n=document.getElementById("wfu_attribute_"+e+"_sourcelist"),o=document.getElementById("wfu_attribute_"+e);if("add"==t){for(var a=0;a<n.options.length;a++)if(n.options[a].selected||"wfu_columns_item_required"==n.options[a].className){for(var l=!1,r=n.options[a].value.replace(/:.*/,""),s=0;s<o.options.length;s++)if(o.options[s].value.replace(/:.*/,"")==r){l=!0;break}if(!l){var u=n.options[a].value.match(/(.*?):(.*?)\/(.*)/),d=u[1],_="custom"==d?"+-"+(""==u[2]?"s":u[2]):""!=u[2]?"-+"+u[2]:"",i=u[3];"custom"==d&&(d="custom1");var c=document.createElement("OPTION");c.value=d+":"+_+"/"+n.options[a].innerHTML+"/"+i,c.innerHTML=n.options[a].innerHTML+(""!=i&&i!=n.options[a].innerHTML?" ("+i+")":""),c.className=n.options[a].className,c.onclick=n.options[a].onclick,o.appendChild(c),o.selectedIndex=o.options.length-1}}}else if("del"==t)for(a=0;a<o.options.length;)o.options[a].selected&&"wfu_columns_item_required"!=o.options[a].className?o.options.remove(a):a++;else if("up"==t||"down"==t){var f=-1;for(a=0;a<o.options.length;a++)o.options[a].selected&&-1==f?f=a:o.options[a].selected&&f>-1&&(o.options[a].selected=!1);"up"==t&&f>0?o.insertBefore(o.options[f],o.options[f-1]):"down"==t&&f<o.options.length-1&&o.insertBefore(o.options[f+1],o.options[f])}wfu_update_column_props(e),wfu_update_columns(e)}function wfu_update_column_props(e){var t=document.getElementById("wfu_attribute_"+e),n=document.getElementById("wfu_attribute_"+e+"_columnprops_container"),o=document.getElementById("wfu_attribute_"+e+"_columnprops_title"),a=(document.getElementById("wfu_attribute_"+e+"_columnprops_title_label"),document.getElementById("wfu_attribute_"+e+"_columnprops_id")),l=document.getElementById("wfu_attribute_"+e+"_columnprops_id_label"),r=document.getElementById("wfu_attribute_"+e+"_columnprops_sort"),s=document.getElementById("wfu_attribute_"+e+"_columnprops_sort_label"),u=document.getElementById("wfu_attribute_"+e+"_columnprops_sorttype"),d=document.getElementById("wfu_attribute_"+e+"_columnprops_sorttype_label"),_=document.getElementById("wfu_attribute_"+e+"_columnprops_defaultsort"),i=document.getElementById("wfu_attribute_"+e+"_columnprops_defaultsort_label"),c=t.selectedIndex;if(""==u.options[0].value&&u.options.remove(0),-1==c)n.className="wfu_columnprops_container wfu_columnprops_container_disabled",o.value="",o.disabled=!0,a.value="",a.disabled=!0,r.checked=!1,r.disabled=!0,u.selectedIndex=-1,u.disabled=!0,_.selectedIndex=-1,_.disabled=!0;else{var f=t.options[c].value.match(/(.*?):(.*?)\/(.*?)\/(.*)/),m=f[1],p="custom"==m.substr(0,6),w=p?m.substr(6):"",v=""!=f[2],g=v&&"+"==f[2].substr(1,1),h=g&&"+"==f[2].substr(0,1),b=g?f[2].substr(2,1):"",y=g?f[2].substr(3,1):"",I=f[4];n.className="wfu_columnprops_container",o.value=I,o.disabled=!1,l.className=p?"":"wfu_columnprops_label_disabled",a.value=w,a.disabled=!p,s.className=v?"":"wfu_columnprops_label_disabled",r.checked=g,r.disabled=!v,d.className=h?"":"wfu_columnprops_label_disabled",u.value=b,u.disabled=!h,i.className=g?"":"wfu_columnprops_label_disabled",_.value=y,_.disabled=!g}}function wfu_columnprops_element_changed(e){var t=(e=e||window.event).target.id.match(/^wfu_attribute_(.*?)_columnprops_/)[1],n=document.getElementById("wfu_attribute_"+t),o=document.getElementById("wfu_attribute_"+t+"_columnprops_title"),a=document.getElementById("wfu_attribute_"+t+"_columnprops_id"),l=document.getElementById("wfu_attribute_"+t+"_columnprops_sort"),r=document.getElementById("wfu_attribute_"+t+"_columnprops_sorttype"),s=document.getElementById("wfu_attribute_"+t+"_columnprops_defaultsort"),u=n.selectedIndex;if(-1!=u){var d=n.options[u].value.match(/(.*?):(.*?)\/(.*?)\/(.*)/),_=d[1],i="custom"==_.substr(0,6)?"custom":_,c="custom"==i?parseInt(a.value)>=1?a.value:"1":"",f=l.checked?""!=s.value?s.value.trim():d[2].substr(3,1):"",m=""!=d[2]?d[2].substr(0,1)+(l.checked?"+":"-")+(""!=r.value?r.value:""!=d[2].substr(2,1)?d[2].substr(2,1):"s")+f:"";if(""!=f){n.options[u].classList.add("wfu_columns_item_defaultsort");for(var p=0;p<n.options.length;p++)p!=u&&(n.options[p].value=n.options[p].value.replace(/(.?:[+-][+-][^\/])([+-])\//,"$1/"),n.options[p].classList.remove("wfu_columns_item_defaultsort"))}else n.options[u].classList.remove("wfu_columns_item_defaultsort");var w=d[3],v=""!=o.value?o.value:w;n.options[u].value=i+c+":"+m+"/"+w+"/"+v,n.options[u].innerHTML=w+(v!=w?" ("+v+")":""),wfu_update_column_props(t),wfu_update_columns(t)}}function wfu_update_columns(e){for(var t=document.getElementById("wfu_attribute_"+e),n="",o=0;o<t.options.length;o++){var a=t.options[o].value.match(/(.*?):(.*?)\/(.*?)\/(.*)/);""!=n&&(n+=","),n+=a[1]+":"+("+"==a[2].substr(1,1)?a[2].substr(2):"")+"/"+a[4]}document.getElementById("wfu_attribute_value_"+e).value=n,wfu_generate_shortcode()}function wfu_GetHttpRequestObject(){var e=null;try{e=new XMLHttpRequest}catch(t){try{e=new ActiveXObject("Msxml2.XMLHTTP")}catch(t){try{e=new ActiveXObject("Microsoft.XMLHTTP")}catch(e){}}}if(null==e&&window.createRequest)try{xmlhttp=window.createRequest()}catch(e){}return e}function wfu_plugin_encode_string(e){var t,n=0,o="",a="";for(n=0;n<e.length;n++)(t=e.charCodeAt(n))>=2048?t=((16773120&t|917504)<<4)+((4032&t|8192)<<2)+(63&t|128):t>=128&&(t=((65472&t|12288)<<2)+(63&t|128)),1!=(a=t.toString(16)).length&&3!=a.length&&5!=a.length||(a="0"+a),o+=a;return o}function wfu_plugin_decode_string(e){for(var t,n,o=0,a="";o<e.length;)n=(t=parseInt(e.substr(o,2),16))<128?t:t<224?((31&t)<<6)+(63&parseInt(e.substr(o+=2,2),16)):((15&t)<<12)+((63&parseInt(e.substr(o+=2,2),16))<<6)+(63&parseInt(e.substr(o+=2,2),16)),a+=String.fromCharCode(n),o+=2;return a}function wfu_decode_array_from_string(e){var t=wfu_plugin_decode_string(e),n=null;try{n=JSON.parse(t)}catch(e){}return n}function wfu_randomString(e){for(var t=e,n="",o=0;o<t;o++){var a=Math.floor(61*Math.random());n+="0123456789ABCDEFGHIJKLMNOPQRSTUVWXTZabcdefghiklmnopqrstuvwxyz".substring(a,a+1)}return n}function wfu_schedule_save_shortcode(){var e=new Date,t=ShortcodeNextSave-e.getTime();null!=ShortcodeTimeOut&&(clearTimeout(ShortcodeTimeOut),ShortcodeTimeOut=null),t<=0?wfu_save_shortcode():ShortcodeTimeOut=setTimeout((function(){wfu_save_shortcode()}),t)}function wfu_check_page_obsolescence(){!PageObsolete&&!PageUpdating&&document.getElementById("wfu_shortcode_postid").value}function wfu_save_shortcode(){if(void 0!==window.fromGutenberg)return document.getElementById("wfu_shortcode").value=wfu_plugin_decode_string(document.getElementById("wfu_shortcode_original_enc").value),void window.plugin_window.wfu_save_from_editor(window.blockId);if(!PageObsolete){var e=wfu_GetHttpRequestObject();if(null!=e){PageUpdating=!0,document.getElementById("wfu_update_failed_message").style.display="none";var t=AdminParams.wfu_ajax_url;params=new Array(9),params[0]=new Array(2),params[0][0]="action",params[0][1]="wfu_ajax_action_save_shortcode",params[1]=new Array(2),params[1][0]="shortcode",params[1][1]=wfu_plugin_encode_string(ShortcodeString),params[2]=new Array(2),params[2][0]="shortcode_original",params[2][1]=document.getElementById("wfu_shortcode_original_enc").value,params[3]=new Array(2),params[3][0]="post_id",params[3][1]=document.getElementById("wfu_shortcode_postid").value,params[4]=new Array(2),params[4][0]="post_hash",params[4][1]=document.getElementById("wfu_shortcode_posthash").value,params[5]=new Array(2),params[5][0]="shortcode_position",params[5][1]=document.getElementById("wfu_shortcode_position").value,params[6]=new Array(2),params[6][0]="shortcode_tag",params[6][1]=document.getElementById("wfu_shortcode_tag").value,params[7]=new Array(2),params[7][0]="widget_id",params[7][1]=document.getElementById("wfu_shortcode_widgetid").value,params[8]=new Array(2),params[8][0]="nonce",params[8][1]=document.getElementById("wfu_wpnonce").value;for(var n="",o=0;o<params.length;o++)n+=(o>0?"&":"")+params[o][0]+"="+encodeURI(params[o][1]);var a=new Date;Autosave?ShortcodeNextSave=a.getTime()+5e3:document.getElementById("wfu_update_shortcode")&&(document.getElementById("wfu_update_shortcode_wait").style.display="inline"),e.open("POST",t,!0),e.setRequestHeader("Content-type","application/x-www-form-urlencoded"),e.onreadystatechange=function(){if(4==e.readyState&&200==e.status){PageUpdating=!1;var t=e.responseText.indexOf("wfu_save_shortcode:");-1==t&&(t=e.responseText.length),e.responseText.substr(0,t);var n=e.responseText.substr(t+19,e.responseText.length-t-19);t=n.indexOf(":");var o=n.substr(0,t);if(txt_value=n.substr(t+1,n.length-t-1),"success"==o){if(Autosave?(document.getElementById("wfu_save_label").innerHTML="saved",document.getElementById("wfu_save_label").className="wfu_save_label",document.getElementById("wfu_save_label").style.opacity=1,wfu_fadeout_element(300),ShortcodeNextSave=a.getTime()+1e3,null!=ShortcodeTimeOut&&wfu_schedule_save_shortcode()):document.getElementById("wfu_update_shortcode")&&(document.getElementById("wfu_update_shortcode_wait").style.display="none",document.getElementById("wfu_update_shortcode").disabled=!0,window.plugin_window&&window.plugin_window.location.reload(!0)),""!=document.getElementById("wfu_shortcode_postid").value){var l=document.getElementById("wfu_shortcode_tag").value;document.getElementById("wfu_shortcode_original_enc").value=wfu_plugin_encode_string("["+l+" "+ShortcodeString+"]"),document.getElementById("wfu_shortcode_posthash").value=txt_value,setTimeout((function(){wfu_check_page_obsolescence()}),CheckObsolescenceTimeOut)}}else Autosave&&(document.getElementById("wfu_save_label").innerHTML="not saved",document.getElementById("wfu_save_label").className="wfu_save_label_fail",document.getElementById("wfu_save_label").style.opacity=1,wfu_fadeout_element(300)),"fail"==o&&("post_modified"==txt_value?(PageObsolete=!0,document.getElementById("wfu_update_shortcode")&&(document.getElementById("wfu_update_shortcode").disabled=!0),document.getElementById("wfu_update_rejected_message").style.display="block"):document.getElementById("wfu_update_failed_message").style.display="block")}},e.send(n)}}}function wfu_adjust_opacity(e){document.getElementById("wfu_save_label").style.opacity=e}function wfu_fadeout_element(e){for(var t=0;t<20;t++)setTimeout('wfu_adjust_opacity("'+(1-t/20).toString()+'")',t*e/20);setTimeout('wfu_adjust_opacity("0.0")',t*e/20)}function wfu_apply_value(e,t,n){if("onoff"==t)document.getElementById("wfu_attribute_"+e).className="wfu_onoff_container_"+("true"!=n?"on":"off"),wfu_admin_onoff_clicked(e);else if("text"==t||"ltext"==t||"integer"==t||"float"==t||"mtext"==t||"color"==t||"coloralpha"==t){var o=document.getElementById("wfu_attribute_"+e);if(n=(n=(n=(n=n.replace(/\%n\%/gm,"\n")).replace(/\%dq\%/gm,'"')).replace(/\%brl\%/gm,"[")).replace(/\%brr\%/gm,"]"),"color"==t)(he=colourNameToHex(n))||(he=n),jQuery("#wfu_attribute_"+e).wpColorPicker("color",he);else if("coloralpha"==t){var a=document.getElementById("wfu_attribute_"+e+"_default").value,l=colourToRgba(n);l||(l=a),jQuery("#wfu_attribute_"+e).wpColorPicker("color",l)}o.value=n,wfu_update_text_value({target:o})}else if("date"==t)(o=document.getElementById("wfu_attribute_"+e)).value=n,wfu_update_date_value({target:o});else if("placements"==t)wfu_admin_recreate_placements_panel(n),document.getElementById("wfu_attribute_value_placements").value=n,wfu_generate_shortcode();else if("radio"==t){for(var r=document.getElementsByName("wfu_radioattribute_"+e),s=0;s<r.length;s++)r[s].checked=r[s].value==n||"*"+r[s].value==n;wfu_admin_radio_clicked(e)}else if("ptext"==t){var u=(z=(n=(n=(n=(n=n.replace(/\%n\%/gm,"\n")).replace(/\%dq\%/gm,'"')).replace(/\%brl\%/gm,"[")).replace(/\%brr\%/gm,"]")).split("/")).length<1?"":z[0],d=z.length<2?u:z[1],_=document.getElementById("wfu_attribute_s_"+e);_.value=u;var i=document.getElementById("wfu_attribute_p_"+e);i.value=d,wfu_update_ptext_value({target:_}),wfu_update_ptext_value({target:i})}else if("mchecklist"==t){if("all"==(n=n.toLowerCase()))document.getElementById("wfu_attribute_"+e+"_all").checked=!0;else{document.getElementById("wfu_attribute_"+e+"_all").checked=!1;var c=n.split(",");for(s=0;s<c.length;s++)c[s]=c[s].trim();jQuery("#wfu_attribute_"+e+" input").each((function(){jQuery(this).prop("checked",c.indexOf(jQuery(this).next().html())>-1)}))}wfu_update_mchecklist_value(e)}else if("rolelist"==t){o=document.getElementById("wfu_attribute_"+e);var f=(g=document.getElementById("wfu_attribute_"+e+"_all")).className.indexOf("wfu_default_administrator")>-1,m=n.split(",");if(m.indexOf("all")>-1)for(g.checked=!0,s=0;s<o.options.length;s++)o.options[s].selected=f&&"administrator"==o.options[s].value;else{for(g.checked=!1,s=0;s<m.length;s++)m[s]=m[s].trim();for(s=0;s<o.options.length;s++)o.options[s].selected=m.indexOf(o.options[s].value)>-1}document.getElementById("wfu_attribute_"+e+"_guests").checked=m.indexOf("guests")>-1,wfu_update_rolelist_value(e)}else if("userlist"==t){o=document.getElementById("wfu_attribute_"+e);var p=(g=document.getElementById("wfu_attribute_"+e+"_all")).className.indexOf("wfu_default_0")>-1;if((I=document.getElementById("wfu_attribute_"+e+"_current"))&&"current"==n)for(I.checked=!0,g.checked=!1,document.getElementById("wfu_attribute_"+e+"_guests").checked=!1,s=0;s<o.options.length;s++)o.options[s].selected=p&&s<1;else{I&&(I.checked=!1);var w=n.split(",");if(w.indexOf("all")>-1)for(g.checked=!0,s=0;s<o.options.length;s++)o.options[s].selected=p&&s<1;else{for(g.checked=!1,s=0;s<w.length;s++)w[s]=w[s].trim();for(s=0;s<o.options.length;s++)o.options[s].selected=w.indexOf(o.options[s].value)>-1}document.getElementById("wfu_attribute_"+e+"_guests").checked=w.indexOf("guests")>-1}wfu_update_userlist_value(e)}else if("postlist"==t){var v=Array(),g=Array(),h=document.getElementById("wfu_attribute_"+e+"_postlist").value.split(",");for(s=0;s<h.length;s++)v.push(document.getElementById("wfu_attribute_"+e+"_"+h[s])),g.push(document.getElementById("wfu_attribute_"+e+"_all_"+h[s]));if((I=document.getElementById("wfu_attribute_"+e+"_current"))&&"current"==n)for(I.checked=!0,s=0;s<h.length;s++){g[s].checked=!1;for(var b=0;b<v[s].options.length;b++)v[s].options[b].selected=!1}else{I&&(I.checked=!1);var y=n.split(",");for(s=0;s<h.length;s++)for(("all"==n||y.indexOf("all"+h[s])>-1)&&(g[s].checked=!0),b=0;b<v[s].options.length;b++)v[s].options[b].selected=y.indexOf(v[s].options[b].value)>-1}wfu_update_postlist_value(e)}else if("bloglist"==t){var I;if((I=document.getElementById("wfu_attribute_"+e+"_current"))&&"current"==n)for(I.checked=!0,document.getElementById("wfu_attribute_"+e+"_all").checked=!1,o=document.getElementById("wfu_attribute_"+e),s=0;s<o.options.length;s++)o.options[s].selected=!1;else{I&&(I.checked=!1);var E=n.split(",");if("all"==n)document.getElementById("wfu_attribute_"+e+"_all").checked=!0;else{for(document.getElementById("wfu_attribute_"+e+"_all").checked=!1,s=0;s<E.length;s++)E[s]=E[s].trim();for(o=document.getElementById("wfu_attribute_"+e),s=0;s<o.options.length;s++)o.options[s].selected=E.indexOf(o.options[s].value)>-1}}wfu_update_bloglist_value(e)}else if("stringmatch"==t){var k="",B="equal to",x="",q=n.match(/^field:(.*?);\s*criterion:(.*?)\s*;\s*value:(.*)$/);q&&4==q.length&&(k=q[1],B=q[2],x=q[3]),document.getElementById("wfu_attribute_"+e+"_matchfield").value=k,document.getElementById("wfu_attribute_"+e+"_matchcriterion").value=B,document.getElementById("wfu_attribute_"+e+"_matchvalue").value=x,wfu_update_stringmatch_value(e)}else if("columns"==t){var N=document.getElementById("wfu_attribute_"+e+"_sourcelist"),L=document.getElementById("wfu_attribute_"+e);L.innerHTML="";var S=n.replace(/(:|\/).*?(,|$)/g,"$2").split(",");for(s=0;s<N.options.length;s++){var T=(z=N.options[s].value.match(/(.*?):(.*?)\/(.*)/))[1];if("wfu_columns_item_required"==N.options[s].className&&-1==S.indexOf(T)){var P="custom"==T?"+-"+(""==z[2]?"s":z[2]):""!=z[2]?"-+"+z[2]:"",D=z[3];"custom"==T&&(T="custom1"),(ye=document.createElement("OPTION")).value=T+":"+P+"/"+N.options[s].innerHTML+"/"+D,ye.innerHTML=N.options[s].innerHTML+(""!=D&&D!=N.options[s].innerHTML?" ("+D+")":""),ye.className=N.options[s].className,ye.onclick=N.options[s].onclick,L.appendChild(ye)}}var A=n.split(",");for(s=0;s<A.length;s++){var O=A[s].split("/",2),C=(T=O[0],"");O.length>1&&(C=O[1]),O=T.split(":",2);var H=(T=O[0]).replace(/custom[0-9]+$/,"custom"),M=-1;for(b=0;b<N.options.length;b++)if(N.options[b].value.replace(/:.*/,"")==H){M=b;break}var j=!1;for(b=0;b<L.options.length;b++)if(L.options[b].value.replace(/:.*/,"")==T){j=!0;break}if("custom"!=T&&M>-1&&!j){var z=N.options[M].value.match(/(.*?):(.*?)\/(.*)/),R="custom"==H||""!=z[2],V=(P=z[2],N.options[M].innerHTML),U=D=z[3];U=1==O.length?"custom"==H?"+-s":R?"-+"+P:"":"custom"==H?"+"+(""==O[1]?"-s":"+"+O[1]):R?"-"+(""==O[1]?"-":"+")+P:"",""==C&&(C=D),(ye=document.createElement("OPTION")).value=T+":"+U+"/"+V+"/"+C,ye.innerHTML=V+(D!=V?" ("+D+")":""),ye.className=N.options[M].className,ye.onclick=N.options[s].onclick,L.appendChild(ye)}}wfu_update_column_props(e),wfu_update_columns(e)}else if("dimensions"==t){var F,Q,$=n.split(","),G=document.getElementsByName("wfu_dimension_elements_"+e);for(s=0;s<G.length;s++)G[s].value="";for(s=0;s<$.length;s++)Q=(F=$[s].split(":",2)).length<1?"":F[0],ce=F.length<2?Q:F[1],(o=document.getElementById("wfu_attribute_"+e+"_"+Q.trim()))&&(o.value=ce.trim());wfu_update_dimension_value({target:o=G[0]})}else if("userfields"==t){var J,X=n.replace(/\//g,"[/]").replace(/\(.*?\)/g,(function(e){return e.replace(/\[\/\]/g,"/")})).split("[/]"),W=Array();for(s=0;s<X.length;s++)(J="*"==X[s].substr(0,1))&&(X[s]=X[s].substr(1)),""!=X[s]&&W.push({name:X[s],required:J});var K,Z=document.getElementById("wfu_attribute_"+e),Y=null,ee=Array();for(s=0;s<Z.childNodes.length;s++)1===Z.childNodes[s].nodeType&&(null==Y?Y=Z.childNodes[s]:ee.push(Z.childNodes[s]));for(s=0;s<ee.length;s++)Z.removeChild(ee[s]);wfu_userdata_edit_field(Y,"",!1);var te=Y;for(s=0;s<W.length;s++)0==s?wfu_userdata_edit_field(Y,W[s].name,W[s].required):(wfu_userdata_edit_field(K=te.cloneNode(!0),W[s].name,W[s].required),Z.insertBefore(K,te.nextSibling),te=K);for(s=0;s<Y.childNodes.length&&"INPUT"!=(o=Y.childNodes[s]).tagName;s++);wfu_update_userfield_value({target:o})}else if("formfields"==t){W=Array();var ne=window["wfu_attribute_"+e+"_typeprops"],oe=ne[0].split(","),ae={};for(s=0;s<oe.length;s++){var le=ne[oe[s]];(a={}).type=oe[s],a.label=le.label,a.labelposition=le.labelposition.substr(5),a.required="true"==le.required.substr(5),a.donotautocomplete="true"==le.donotautocomplete.substr(5),a.validate="true"==le.validate.substr(5),a.typehook="true"==le.typehook.substr(5),a.hintposition=le.hintposition.substr(5),a.default=le.default.substr(5),a.data=le.data.substr(5),a.group=le.group.substr(5),a.format=le.format.substr(5),ae[oe[s]]=a}for(X=n.replace(/\//g,"[/]").replace(/\(.*?\)/g,(function(e){return e.replace(/\[\/\]/g,"/")})).split("[/]"),s=0;s<X.length;s++){var re=X[s].trim(),se={};for(prop in ae.text)se[prop]=ae.text[prop];"*"==re.substr(0,1)&&(se.required=!0,re=re.substr(1));var ue=re.split("|");if(""!=ue[0].trim()){var de=-1,_e="";for(b=0;b<ue.length;b++){var ie=(fe=ue[b].replace(/^\s+/gm,"")).substr(0,2),ce=fe.substr(2);if("t:"==ie&&b>0&&oe.indexOf(ce)>-1){_e=ce,de=b;break}}if(""!=_e){for(prop in ae[_e])se[prop]=ae[_e][prop];ue.splice(de,1)}for(se.label=ue[0].trim(),ue.splice(0,1),b=0;b<ue.length;b++){var fe;ie=(fe=ue[b].replace(/^\s+/gm,"")).substr(0,2),ce=fe.substr(2),"s:"==ie?se.labelposition=ce:"r:"==ie?se.required="1"==ce:"a:"==ie?se.donotautocomplete="1"==ce:"v:"==ie?se.validate="1"==ce:"d:"==ie?se.default=ce:"l:"==ie?se.data=ce:"g:"==ie?se.group=ce:"f:"==ie?se.format=ce:"p:"==ie?se.hintposition=ce:"h:"==ie&&(se.typehook="1"==ce)}W.push(se)}}0==W.length&&W.push(fieldprops_default),Z=document.getElementById("wfu_attribute_"+e);var me=document.querySelectorAll("div#wfu_attribute_"+e+" .wfu_formdata_line_container");for(s=1;s<me.length;s++)Z.removeChild(me[s]);var pe=me[0];for(s=0;s<W.length;s++){var we=e+"_"+wfu_randomString(4),ve=wfu_formdata_prepare_template(e,W[s],we);s>0&&(pe=document.createElement("DIV")),pe.id="wfu_formfield_"+we+"_container",pe.className="wfu_formdata_line_container",s>0&&Z.insertBefore(pe,null),pe.innerHTML=ve,wfu_formdata_update_buttons(we)}var ge=document.querySelectorAll("div#wfu_attribute_"+e+' input[name="wfu_formfield_elements"]');for(s=0;s<ge.length;s++)wfu_attach_element_handlers(ge[s],wfu_update_formfield_value);wfu_update_formfield_value({target:me[0]})}else if("color-triplet"==t){var he,be=n.split(",");for(s=0;s<be.length;s++)be[s]=be[s].trim();2==be.length?be=[be[0],be[1],"#000000"]:1==be.length?be=[be[0],"#FFFFFF","#000000"]:be.length<3&&(be=["#000000","#FFFFFF","#000000"]),(he=colourNameToHex(be[0]))||(he=be[0]),jQuery("#wfu_attribute_"+e+"_color").wpColorPicker("color",he),(o=document.getElementById("wfu_attribute_"+e+"_color")).value=be[0],(he=colourNameToHex(be[1]))||(he=be[1]),jQuery("#wfu_attribute_"+e+"_bgcolor").wpColorPicker("color",he),document.getElementById("wfu_attribute_"+e+"_bgcolor").value=be[1],(he=colourNameToHex(be[2]))||(he=be[2]),jQuery("#wfu_attribute_"+e+"_borcolor").wpColorPicker("color",he),document.getElementById("wfu_attribute_"+e+"_borcolor").value=be[2],wfu_update_triplecolor_value({target:o})}else if("ftpinfo"==t)(o=document.getElementById("wfu_attribute_"+e)).value=n,wfu_update_text_value({target:o});else if("folderlist"==t){c=wfu_parse_folderlist_js(n);for(var ye,Ie,Ee,ke,Be,xe,qe=document.getElementById("wfu_attribute_"+e).options;qe.length>0;)qe.remove(0);for(s=0;s<c.path.length;s++){for("/"==(Ie=c.path[s]).substr(Ie.length,1)&&(Ie=Ie.substr(0,Ie.length-1)),Ee=Ie.split("/"),Ie=Ee[Ee.length-1],Be=parseInt(c.level[s]),ke="",xe="",b=0;b<Be;b++)ke+="&nbsp;&nbsp;&nbsp;",xe+="*";ke+=c.label[s],c.default[s]&&(xe+="&"),xe+=""==Ie?"{root}/"+c.label[s]:Ie+c.label[s],ye=document.createElement("option"),c.default[s]?ye.className="wfu_select_folders_option_default":ye.className="",ye.value=wfu_plugin_encode_string(xe),ye.innerHTML=ke,qe.add(ye)}(ye=document.createElement("option")).value="",ye.innerHTML="",qe.add(ye);var Ne=document.getElementById("wfu_attribute_"+e);Ne.data=wfu_decode_subfolder_list(e),wfu_subfolders_update_toolnav(e),n!==(o=Ne).oldVal&&(o.oldVal=n,document.getElementById("wfu_attribute_value_"+e).value=n,wfu_generate_shortcode())}}function wfu_decode_ftpinfo(e){var t={error:!0,data:{username:"",password:"",ftpdomain:"",port:"",sftp:!1}},n=e.replace(/\\\\:/g,"\\\\_").replace(/\\\\@/g,"\\\\_"),o=n.indexOf(":"),a=n.indexOf("@");if(o>-1&&a>-1&&a>o){t.error=!1,t.data.username=e.substr(0,o).replace(/\\\\:/g,":").replace(/\\\\@/g,"@"),t.data.password=e.substr(o+1,a-o-1).replace(/\\\\:/g,":").replace(/\\\\@/g,"@");var l=e.substr(a+1);t.data.ftpdomain=l.replace(/:.*/,""),""==t.data.ftpdomain.trim()&&(t.error=!0),"s"==(r=l.replace(/^[^:]*:?/,"")).substr(0,1)&&(t.data.sftp=!0,r=r.substr(1)),t.data.port=r}else if(a>-1){var r;t.error=!1,t.data.username=e.substr(0,a).replace(/\\\\:/g,":").replace(/\\\\@/g,"@"),l=e.substr(a+1),t.data.ftpdomain=l.replace(/:.*/,""),""==t.data.ftpdomain.trim()&&(t.error=!0),"s"==(r=l.replace(/^[^:]*:?/,"")).substr(0,1)&&(t.data.sftp=!0,r=r.substr(1)),t.data.port=r}else o>-1?(t.error=!0,t.data.username=e.substr(0,o).replace(/\\\\:/g,":").replace(/\\\\@/g,"@"),t.data.password=e.substr(o+1).replace(/\\\\:/g,":").replace(/\\\\@/g,"@")):(t.error=!0,t.data.username=e.replace(/\\\\:/g,":").replace(/\\\\@/g,"@"));return t}function wfu_ftpinfotool_toggle(){var e=document.querySelector(".ftpinfo_btn"),t=document.querySelector(".ftpinfo_tool");t.classList.contains("hidden")?(e.innerHTML="Close",t.classList.remove("hidden")):(e.innerHTML="Edit",t.classList.add("hidden"))}function wfu_parse_folderlist_js(e){var t=Object();if(t.path=Array(),t.label=Array(),t.level=Array(),t.default=Array(),"auto"==e.substr(0,4))return t;var n=e.split(",");if(0==n.length)return t;if(1==n.length&&""==n[0].trim())return t;for(var o,a,l,r,s,u,d=["root"],_=0,i=0,c=-1,f=0;f<n.length;f++){for(o=n[f].trim(),a=0,l=!1;a<o.length&&"*"==o.substr(a,1);)a++;if(a-_<=1&&(a>0||0==i)&&("&"==(o=o.substr(a,o.length-a)).substr(0,1)&&(o=o.substr(1),l=!0),subfolder_items=o.split("/"),subfolder_items.length<2&&subfolder_items.push(""),""!=subfolder_items[1]?(r=subfolder_items[0],s=subfolder_items[1]):(r=o,s=o),""!=r)){l&&-1==c?c=t.path.length:l=!1,0==a&&(i=1),d.length>a?d[a]=r:d.push(r),u="";for(var m=1;m<=a;m++)u+=d[m]+"/";t.path.push(u),t.label.push(s),t.level.push(a),t.default.push(l),_=a}}return t}function colourNameToHex(e){var t={aliceblue:"#f0f8ff",antiquewhite:"#faebd7",aqua:"#00ffff",aquamarine:"#7fffd4",azure:"#f0ffff",beige:"#f5f5dc",bisque:"#ffe4c4",black:"#000000",blanchedalmond:"#ffebcd",blue:"#0000ff",blueviolet:"#8a2be2",brown:"#a52a2a",burlywood:"#deb887",cadetblue:"#5f9ea0",chartreuse:"#7fff00",chocolate:"#d2691e",coral:"#ff7f50",cornflowerblue:"#6495ed",cornsilk:"#fff8dc",crimson:"#dc143c",cyan:"#00ffff",darkblue:"#00008b",darkcyan:"#008b8b",darkgoldenrod:"#b8860b",darkgray:"#a9a9a9",darkgreen:"#006400",darkkhaki:"#bdb76b",darkmagenta:"#8b008b",darkolivegreen:"#556b2f",darkorange:"#ff8c00",darkorchid:"#9932cc",darkred:"#8b0000",darksalmon:"#e9967a",darkseagreen:"#8fbc8f",darkslateblue:"#483d8b",darkslategray:"#2f4f4f",darkturquoise:"#00ced1",darkviolet:"#9400d3",deeppink:"#ff1493",deepskyblue:"#00bfff",dimgray:"#696969",dodgerblue:"#1e90ff",firebrick:"#b22222",floralwhite:"#fffaf0",forestgreen:"#228b22",fuchsia:"#ff00ff",gainsboro:"#dcdcdc",ghostwhite:"#f8f8ff",gold:"#ffd700",goldenrod:"#daa520",gray:"#808080",green:"#008000",greenyellow:"#adff2f",honeydew:"#f0fff0",hotpink:"#ff69b4","indianred ":"#cd5c5c","indigo ":"#4b0082",ivory:"#fffff0",khaki:"#f0e68c",lavender:"#e6e6fa",lavenderblush:"#fff0f5",lawngreen:"#7cfc00",lemonchiffon:"#fffacd",lightblue:"#add8e6",lightcoral:"#f08080",lightcyan:"#e0ffff",lightgoldenrodyellow:"#fafad2",lightgrey:"#d3d3d3",lightgreen:"#90ee90",lightpink:"#ffb6c1",lightsalmon:"#ffa07a",lightseagreen:"#20b2aa",lightskyblue:"#87cefa",lightslategray:"#778899",lightsteelblue:"#b0c4de",lightyellow:"#ffffe0",lime:"#00ff00",limegreen:"#32cd32",linen:"#faf0e6",magenta:"#ff00ff",maroon:"#800000",mediumaquamarine:"#66cdaa",mediumblue:"#0000cd",mediumorchid:"#ba55d3",mediumpurple:"#9370d8",mediumseagreen:"#3cb371",mediumslateblue:"#7b68ee",mediumspringgreen:"#00fa9a",mediumturquoise:"#48d1cc",mediumvioletred:"#c71585",midnightblue:"#191970",mintcream:"#f5fffa",mistyrose:"#ffe4e1",moccasin:"#ffe4b5",navajowhite:"#ffdead",navy:"#000080",oldlace:"#fdf5e6",olive:"#808000",olivedrab:"#6b8e23",orange:"#ffa500",orangered:"#ff4500",orchid:"#da70d6",palegoldenrod:"#eee8aa",palegreen:"#98fb98",paleturquoise:"#afeeee",palevioletred:"#d87093",papayawhip:"#ffefd5",peachpuff:"#ffdab9",peru:"#cd853f",pink:"#ffc0cb",plum:"#dda0dd",powderblue:"#b0e0e6",purple:"#800080",red:"#ff0000",rosybrown:"#bc8f8f",royalblue:"#4169e1",saddlebrown:"#8b4513",salmon:"#fa8072",sandybrown:"#f4a460",seagreen:"#2e8b57",seashell:"#fff5ee",sienna:"#a0522d",silver:"#c0c0c0",skyblue:"#87ceeb",slateblue:"#6a5acd",slategray:"#708090",snow:"#fffafa",springgreen:"#00ff7f",steelblue:"#4682b4",tan:"#d2b48c",teal:"#008080",thistle:"#d8bfd8",tomato:"#ff6347",turquoise:"#40e0d0",violet:"#ee82ee",wheat:"#f5deb3",white:"#ffffff",whitesmoke:"#f5f5f5",yellow:"#ffff00",yellowgreen:"#9acd32"};return void 0!==t[e.toLowerCase()]&&t[e.toLowerCase()]}function colourToRgba(e){var t=function(e){var t=!1,n=e.match(/^#([A-Fa-f0-9]{2})([A-Fa-f0-9]{2})([A-Fa-f0-9]{2})([A-Fa-f0-9]{2})?$/);if(n){var o=null==n[4]?1:(parseInt(n[4],16)/256).toFixed(2);t="rgba("+parseInt(n[1],16)+", "+parseInt(n[2],16)+", "+parseInt(n[3],16)+", "+o+")"}return t},n=!1;if(e.startsWith("rgba("))n=e;else if(e.startsWith("#"))n=t(e);else{var o=colourNameToHex(e);o||(o=value),o.startsWith("#")&&(n=t(o))}return n}function wfu_add_cookies(e){for(var t=0;t<e.length;t++){var n=new Date;n.setTime(n.getTime()+1e3*e[t].expires),document.cookie=e[t].name+"="+e[t].value+"; expires="+n.toUTCString()+"; path=/"}}function wfu_download_file(e,t){var n=wfu_GetHttpRequestObject();if(null!=n){var o="",a=document.getElementById("wfu_download_file_nonce");if(a&&(o=a.value),""!=o){var l=AdminParams.wfu_ajax_url;params=new Array(3),params[0]=new Array(2),params[0][0]="action",params[0][1]="wfu_ajax_action_download_file_invoker",params[1]=new Array(2),params[1][0]="file",params[1][1]=e,params[2]=new Array(2),params[2][0]="nonce",params[2][1]=o;for(var r="",s=0;s<params.length;s++)r+=(s>0?"&":"")+params[s][0]+"="+encodeURI(params[s][1]);n.open("POST",l,!0),n.setRequestHeader("Content-type","application/x-www-form-urlencoded"),n.onreadystatechange=function(){if(4==n.readyState&&200==n.status){var o=n.responseText.indexOf("wfu_ajax_action_download_file_invoker:");-1==o&&(o=n.responseText.length),n.responseText.substr(0,o);var a=n.responseText.substr(o+38,n.responseText.length-o-38);o=a.indexOf(":");var l=a.substr(0,o);if(txt_value=a.substr(o+1,a.length-o-1),"wfu_download_id;"==l.substr(0,16)){var r=l.substr(16),s=document.getElementById("wfu_file_download_container_"+t),u=wfu_decode_array_from_string(txt_value);if(u){if(s.innerHTML=u.html,""!=u.js){var d=document.createElement("SCRIPT");d.type="text/javascript",d.text=u.js,s.appendChild(d)}setTimeout("wfu_download_file_monitor('"+e+"', "+t+", '"+r+"')",100)}}}},n.send(r)}}}function wfu_download_file_monitor(e,t,n){var o=wfu_GetHttpRequestObject();if(null!=o){var a=AdminParams.wfu_ajax_url;params=new Array(3),params[0]=new Array(2),params[0][0]="action",params[0][1]="wfu_ajax_action_download_file_monitor",params[1]=new Array(2),params[1][0]="file",params[1][1]=e,params[2]=new Array(2),params[2][0]="id",params[2][1]=n;for(var l="",r=0;r<params.length;r++)l+=(r>0?"&":"")+params[r][0]+"="+encodeURI(params[r][1]);o.open("POST",a,!0),o.setRequestHeader("Content-type","application/x-www-form-urlencoded"),o.onreadystatechange=function(){if(4==o.readyState&&200==o.status){var n=o.responseText.indexOf("wfu_ajax_action_download_file_monitor:");-1==n&&(n=o.responseText.length),o.responseText.substr(0,n);var a=o.responseText.substr(n+38,o.responseText.length-n-38);n=a.indexOf(":");var l=a.substr(0,n);txt_value=a.substr(n+1,a.length-n-1),"repeat"!=l?document.getElementById("wfu_file_download_container_"+t).innerHTML="":"repeat"==l&&setTimeout("wfu_download_file_monitor('"+e+"', "+t+", '"+txt_value+"')",100)}},o.send(l)}}function wfu_filedetails_changed(e){for(var t,n=document.getElementsByName("wfu_filedetails_userdata"),o=!1,a=!1,l=0;l<n.length;l++)if(t=document.getElementById(n[l].id.replace("wfu_filedetails_userdata_value_","wfu_filedetails_userdata_default_")),document.getElementById(n[l].id.replace("wfu_filedetails_userdata_value_","wfu_filedetails_userdata_")).value=n[l].value,n[l].value!=t.value){o=!0;break}document.getElementById("wfu_filedetails_userid")&&(a=document.getElementById("wfu_filedetails_userid").value!=document.getElementById("wfu_filedetails_userid_default").value),document.getElementById("dp_filedetails_submit_fields").disabled=!o&&!a}function wfu_Attach_FileDetails_Admin_Events(){for(var e=document.getElementsByName("wfu_filedetails_userdata"),t=0;t<e.length;t++)wfu_attach_element_handlers(e[t],wfu_filedetails_changed)}function wfu_update_browserpermission_option(e,t,n){var o=document.getElementById("wfu_fbperm_users"),a=document.getElementById("wfu_fbperm_roles"),l=document.getElementById("wfu_fbperm_"+e+"_"+t+"_view"),r=document.getElementById("wfu_fbperm_"+e+"_"+t+"_dl"),s=document.getElementById("wfu_fbperm_"+e+"_"+t+"_edit"),u=document.getElementById("wfu_fbperm_"+e+"_"+t+"_del");if("role"==e){if("0"==t){r.checked=l.checked&&r.checked,s.checked=l.checked&&s.checked,u.checked=l.checked&&u.checked,r.disabled=!l.checked,s.disabled=!l.checked,u.disabled=!l.checked;for(var d=document.querySelectorAll("tr.wfu_fbperm_role_tr"),_=0;_<d.length;_++)wfu_update_browserpermission_option("role",d[_].id.substr(16,d[_].id.length-20),!1);if(n){var i=(l.checked?"v":"")+(r.checked?"d":"")+(s.checked?"e":"")+(u.checked?"l":"");a.value=a.value.replace(/^0\[\w*\]/,"0["+i+"]")}}else if("administrator"!=t){var c=document.getElementById("wfu_fbperm_role_"+t+"_row"),f=document.getElementById("wfu_fbperm_role_"+t+"_def"),m=document.getElementById("wfu_fbperm_role_0_view"),p=document.getElementById("wfu_fbperm_role_0_dl"),w=document.getElementById("wfu_fbperm_role_0_edit"),v=document.getElementById("wfu_fbperm_role_0_del");l.checked=f.checked?m.checked:l.checked,c.style.fontWeight=f.checked?"":"bold",r.checked=f.checked?p.checked:l.checked&&r.checked,s.checked=f.checked?w.checked:l.checked&&s.checked,u.checked=f.checked?v.checked:l.checked&&u.checked,l.disabled=f.checked,r.disabled=f.checked||!l.checked,s.disabled=f.checked||!l.checked,u.disabled=f.checked||!l.checked,n&&(i=f.checked?"":"D"+(l.checked?"v":"")+(r.checked?"d":"")+(s.checked?"e":"")+(u.checked?"l":""),a.value=a.value.replace(new RegExp(","+t+"\\[\\w*\\]"),","+t+"["+i+"]"))}var g=document.querySelectorAll("tr.wfu_fbperm_user_tr");for(_=0;_<g.length;_++)wfu_update_browserpermission_option("user",g[_].id.substr(16,g[_].id.length-20),!1)}else if("user"==e){var h=document.getElementById("wfu_fbperm_user_"+t+"_role");if("0"==t){for(l.checked=!h.checked&&l.checked,r.checked=!h.checked&&l.checked&&r.checked,s.checked=!h.checked&&l.checked&&s.checked,u.checked=!h.checked&&l.checked&&u.checked,l.disabled=h.checked,r.disabled=h.checked||!l.checked,s.disabled=h.checked||!l.checked,u.disabled=h.checked||!l.checked,l.indeterminate=h.checked,r.indeterminate=h.checked,s.indeterminate=h.checked,u.indeterminate=h.checked,g=document.querySelectorAll("tr.wfu_fbperm_user_tr"),_=0;_<g.length;_++)wfu_update_browserpermission_option("user",g[_].id.substr(16,g[_].id.length-20),!1);n&&(i=h.checked?"":"R"+(l.checked?"v":"")+(r.checked?"d":"")+(s.checked?"e":"")+(u.checked?"l":""),o.value=o.value.replace(/^0\[\w*\],?/,""),o.value="0["+i+"]"+(""==o.value?"":","+o.value))}else{var b=document.getElementById("wfu_fbperm_user_"+t+"_roles").value.split(",");if(1==b.length&&""==b[0]&&(b=Array()),b.indexOf("administrator")<0){c=document.getElementById("wfu_fbperm_user_"+t+"_row"),f=document.getElementById("wfu_fbperm_user_"+t+"_def");var y=document.getElementById("wfu_fbperm_user_0_role");if(m=document.getElementById("wfu_fbperm_user_0_view"),p=document.getElementById("wfu_fbperm_user_0_dl"),w=document.getElementById("wfu_fbperm_user_0_edit"),v=document.getElementById("wfu_fbperm_user_0_del"),b.length>0){var I=!1,E=!1,k=!1,B=!1;for(_=0;_<b.length;_++)E=(I=I||document.getElementById("wfu_fbperm_role_"+b[_]+"_view").checked)&&(E||document.getElementById("wfu_fbperm_role_"+b[_]+"_dl").checked),k=I&&(k||document.getElementById("wfu_fbperm_role_"+b[_]+"_edit").checked),B=I&&(B||document.getElementById("wfu_fbperm_role_"+b[_]+"_del").checked)}else I=document.getElementById("wfu_fbperm_role_0_view"),E=document.getElementById("wfu_fbperm_role_0_dl"),k=document.getElementById("wfu_fbperm_role_0_edit"),B=document.getElementById("wfu_fbperm_role_0_del");c.style.fontWeight=f.checked?"":"bold",h.checked=f.checked?y.checked:h.checked,l.checked=f.checked?y.checked?I:m.checked:h.checked?I:l.checked,r.checked=f.checked?y.checked?E:p.checked:h.checked?E:l.checked&&r.checked,s.checked=f.checked?y.checked?k:w.checked:h.checked?k:l.checked&&s.checked,u.checked=f.checked?y.checked?B:v.checked:h.checked?B:l.checked&&u.checked,h.disabled=f.checked,l.disabled=f.checked||h.checked,r.disabled=f.checked||h.checked||!l.checked,s.disabled=f.checked||h.checked||!l.checked,u.disabled=f.checked||h.checked||!l.checked,n&&(i=f.checked?"":"D"+(h.checked?"":"R"+(l.checked?"v":"")+(r.checked?"d":"")+(s.checked?"e":"")+(u.checked?"l":"")),o.value=o.value.replace(new RegExp(","+t+"\\[\\w*\\]|"+t+"\\[\\w*\\],|"+t+"\\[\\w*\\]"),""),o.value+=(""==o.value?"":",")+t+"["+i+"]")}}}}function wfu_goto_historylog_page(e,t){var n=document.getElementById("wfu_historylog_pages"),o=n.selectedIndex+1,a=o;if("next"==t?a=Math.min(o+1,n.options.length):"prev"==t?a=Math.max(o-1,1):"last"==t?a=n.options.length:"first"==t?a=1:"sel"==t&&(o=-1),a!=o){var l=wfu_GetHttpRequestObject();if(null!=l){var r=AdminParams.wfu_ajax_url;params=new Array(3),params[0]=new Array(2),params[0][0]="action",params[0][1]="wfu_ajax_action_get_historylog_page",params[1]=new Array(2),params[1][0]="token",params[1][1]=e,params[2]=new Array(2),params[2][0]="page",params[2][1]=a;for(var s="",u=0;u<params.length;u++)s+=(u>0?"&":"")+params[u][0]+"="+encodeURI(params[u][1]);document.getElementById("wfu_historylog_overlay").style.display="block",l.open("POST",r,!0),l.setRequestHeader("Content-type","application/x-www-form-urlencoded"),l.onreadystatechange=function(){if(4==l.readyState&&200==l.status){document.getElementById("wfu_historylog_overlay").style.display="none";var e=l.responseText.indexOf("wfu_historylog_page_success:");-1==e&&(e=l.responseText.length),l.responseText.substr(0,e);var t=l.responseText.substr(e+28,l.responseText.length-e-28);""!=t&&(document.getElementById("wfu_historylog_table").tBodies[0].innerHTML=wfu_plugin_decode_string(t),n.selectedIndex=a-1,document.getElementById("wfu_historylog_first_disabled").style.display=1==a?"inline":"none",document.getElementById("wfu_historylog_prev_disabled").style.display=1==a?"inline":"none",document.getElementById("wfu_historylog_first").style.display=1==a?"none":"inline",document.getElementById("wfu_historylog_prev").style.display=1==a?"none":"inline",document.getElementById("wfu_historylog_last_disabled").style.display=a==n.options.length?"inline":"none",document.getElementById("wfu_historylog_next_disabled").style.display=a==n.options.length?"inline":"none",document.getElementById("wfu_historylog_last").style.display=a==n.options.length?"none":"inline",document.getElementById("wfu_historylog_next").style.display=a==n.options.length?"none":"inline")}},l.send(s)}}}function wfu_attach_uploadedfiles_events(){function e(e){var t=e.id.replace(/^p_([0-9]+)_[0-9]+$/,"$1");document.querySelector("tr.wfu_row-"+t+" .wfu-remarks-container").innerHTML=wfu_plugin_decode_string(e.firstChild.value)}function t(e){var t=e.id.replace(/^p_([0-9]+)_[0-9]+$/,"$1");e.classList.remove("wfu-clicked"),document.querySelector("tr.wfu_row-"+t+" .wfu-remarks-container").innerHTML=""}window.wfu_last_shown_remark=null;for(var n=document.querySelectorAll(".wfu-properties:not(.wfu-dashicons-hidden)"),o=0;o<n.length;o++)void 0!==n[o].hashover&&1==n[o].hashover||(jQuery(n[o]).hover((function(){window.wfu_last_shown_remark&&t(window.wfu_last_shown_remark),e(this),window.wfu_last_shown_remark=this}),(function(){window.wfu_last_shown_remark&&t(window.wfu_last_shown_remark),t(this),window.wfu_last_shown_remark=null})),jQuery(n[o]).click((function(){window.wfu_last_shown_remark&&t(window.wfu_last_shown_remark),e(this),this.classList.add("wfu-clicked"),window.wfu_last_shown_remark=this})),this.hashover=!0)}function wfu_update_uploadedfiles_bubble(e){var t=document.querySelector("#toplevel_page_wfu_uploaded_files .update-plugins"),n=document.querySelector("#toplevel_page_wfu_uploaded_files .plugin-count");if(t&&n){t.className="update-plugins count-"+e;var o=e;e>99&&(o="99+"),n.innerHTML=o}}function wfu_goto_uploadedfiles_page(e,t){var n=document.getElementById("wfu_uploadedfiles_pages"),o=n.selectedIndex+1,a=o;if("next"==t?a=Math.min(o+1,n.options.length):"prev"==t?a=Math.max(o-1,1):"last"==t?a=n.options.length:"first"==t?a=1:"sel"==t&&(o=-1),a!=o){var l=wfu_GetHttpRequestObject();if(null!=l){var r=AdminParams.wfu_ajax_url;params=new Array(3),params[0]=new Array(2),params[0][0]="action",params[0][1]="wfu_ajax_action_get_uploadedfiles_page",params[1]=new Array(2),params[1][0]="token",params[1][1]=e,params[2]=new Array(2),params[2][0]="page",params[2][1]=a;for(var s="",u=0;u<params.length;u++)s+=(u>0?"&":"")+params[u][0]+"="+encodeURI(params[u][1]);document.getElementById("wfu_uploadedfiles_overlay").style.display="block",l.open("POST",r,!0),l.setRequestHeader("Content-type","application/x-www-form-urlencoded"),l.onreadystatechange=function(){if(4==l.readyState&&200==l.status){document.getElementById("wfu_uploadedfiles_overlay").style.display="none";var e=l.responseText.indexOf("wfu_uploadedfiles_page_success:");-1==e&&(e=l.responseText.length),l.responseText.substr(0,e);var t=l.responseText.substr(e+31,l.responseText.length-e-31);if(""!=t){var o=document.getElementById("wfu_uploadedfiles_table"),r=wfu_plugin_decode_string(t),s=0,u=r.match(/wfu_uploadedfiles_unread\[(.*?)\]/);u&&u[1]&&(s=parseInt(u[1])),isNaN(s)&&(s=0),o.tBodies[0].innerHTML=r,n.selectedIndex=a-1,document.getElementById("wfu_uploadedfiles_first_disabled").style.display=1==a?"inline":"none",document.getElementById("wfu_uploadedfiles_prev_disabled").style.display=1==a?"inline":"none",document.getElementById("wfu_uploadedfiles_first").style.display=1==a?"none":"inline",document.getElementById("wfu_uploadedfiles_prev").style.display=1==a?"none":"inline",document.getElementById("wfu_uploadedfiles_last_disabled").style.display=a==n.options.length?"inline":"none",document.getElementById("wfu_uploadedfiles_next_disabled").style.display=a==n.options.length?"inline":"none",document.getElementById("wfu_uploadedfiles_last").style.display=a==n.options.length?"none":"inline",document.getElementById("wfu_uploadedfiles_next").style.display=a==n.options.length?"none":"inline",wfu_attach_uploadedfiles_events(),wfu_update_uploadedfiles_bubble(s)}}},l.send(s)}}}function wfu_include_file(e,t){var n=wfu_GetHttpRequestObject();if(null!=n){var o="",a=document.getElementById("wfu_include_file_nonce");if(a&&(o=a.value),""!=o){var l=AdminParams.wfu_ajax_url;params=new Array(2),params[0]=new Array(3),params[0][0]="action",params[0][1]="wfu_ajax_action_include_file",params[1]=new Array(2),params[1][0]="file",params[1][1]=e,params[2]=new Array(2),params[2][0]="nonce",params[2][1]=o;for(var r="",s=0;s<params.length;s++)r+=(s>0?"&":"")+params[s][0]+"="+encodeURI(params[s][1]);document.getElementById("wfu_include_file_"+t+"_a").href="javascript: void(0)",document.getElementById("wfu_include_file_"+t+"_img").style.display="inline",n.open("POST",l,!0),n.setRequestHeader("Content-type","application/x-www-form-urlencoded"),n.onreadystatechange=function(){if(4==n.readyState&&(document.getElementById("wfu_include_file_"+t+"_img").style.display="none",200==n.status)){var e=n.responseText.indexOf("wfu_include_file:");-1==e&&(e=n.responseText.length),n.responseText.substr(0,e);var o=n.responseText.substr(e+17,n.responseText.length-e-17);e=o.indexOf(":");var a=o.substr(0,e);txt_value=o.substr(e+1,o.length-e-1),"success"==a?(document.getElementById("wfu_file_flat_"+t).style.display="none",document.getElementById("wfu_file_link_"+t).style.display="inline",document.getElementById("wfu_file_can_be_included_actions_"+t).style.display="none",document.getElementById("wfu_file_is_included_actions_"+t).style.display="block"):document.getElementById("wfu_include_file_"+t+"_a").innerHTML=document.getElementById("wfu_include_file_"+t+"_inpfail").value}},n.send(r)}}}function wfu_adminbrowser_select_all_visible_changed(){for(var e=document.getElementById("wfu_select_all_visible").checked,t=document.querySelectorAll(".wfu_selectors"),n=0;n<t.length;n++)t[n].checked=e}function wfu_adminbrowser_selector_changed(e){var t=document.querySelectorAll(".wfu_selectors").length,n=document.querySelectorAll(".wfu_selectors:checked").length,o=document.getElementById("wfu_select_all_visible");o.style.webkitAppearance="",o.style.webkitAppearance="checkbox",o.checked=n>0,o.indeterminate=n>0&&n<t}function wfu_apply_bulkaction_select(e){void 0!==window["wfu_apply_"+e+"_bulkselect"]&&window["wfu_apply_"+e+"_bulkselect"]()}function wfu_apply_adminbrowser_bulkaction(){var e=document.getElementById("wfu_adminbrowser_bulkactions");if(!(e.selectedIndex<1)){var t=e.options[e.selectedIndex].value,n=document.querySelectorAll(".wfu_selectors:checked");if(0!=n.length){for(var o=[],a=0,l=0,r=0;r<n.length;r++){var s=n[r].className.replace(/.*?wfu_selcode_/,"");if(""!=s){var u=n[r].className.indexOf("wfu_included")>-1;u?a++:l++,"delete"==t&&!u||"include"==t&&u?n[r].checked=!1:o.push(s)}}if("move"==t&&l>0?alert("Notice! Files that were not uploaded using the plugin cannot be moved and have been deselected."):"delete"==t&&l>0?alert("Notice! Files that were not uploaded using the plugin cannot be deleted and have been deselected."):"include"==t&&a>0&&alert("Notice! Files already included in the plugin have been deselected."),0!=o.length){var d=document.getElementById("wfu_adminbrowser_action_url").value,_=document.getElementById("wfu_adminbrowser_referer").value;if("move"==t||"delete"==t||"include"==t){var i=document.createElement("FORM");i.method="POST",i.action=d,i.style.display="none";var c=document.createElement("INPUT");c.type="hidden",c.name="action",c.value=t+"_file",i.appendChild(c);var f=document.createElement("INPUT");f.type="hidden",f.name="file",f.value="list:"+o.join(),i.appendChild(f);var m=document.createElement("INPUT");m.type="hidden",m.name="referer",m.value=_,i.appendChild(m),document.body.appendChild(i),i.submit()}}}}}function wfu_goto_adminbrowser_page(e,t){var n=document.getElementById("wfu_adminbrowser_pages"),o=n.selectedIndex+1,a=o;if("next"==t?a=Math.min(o+1,n.options.length):"prev"==t?a=Math.max(o-1,1):"last"==t?a=n.options.length:"first"==t?a=1:"sel"==t&&(o=-1),a!=o){var l=wfu_GetHttpRequestObject();if(null!=l){var r=AdminParams.wfu_ajax_url;params=new Array(4),params[0]=new Array(2),params[0][0]="action",params[0][1]="wfu_ajax_action_get_adminbrowser_page",params[1]=new Array(2),params[1][0]="code",params[1][1]=document.getElementById("wfu_adminbrowser_code").value,params[2]=new Array(2),params[2][0]="token",params[2][1]=e,params[3]=new Array(2),params[3][0]="page",params[3][1]=a;for(var s="",u=0;u<params.length;u++)s+=(u>0?"&":"")+params[u][0]+"="+encodeURI(params[u][1]);document.getElementById("wfu_adminbrowser_overlay").style.display="block",l.open("POST",r,!0),l.setRequestHeader("Content-type","application/x-www-form-urlencoded"),l.onreadystatechange=function(){if(4==l.readyState&&200==l.status){document.getElementById("wfu_adminbrowser_overlay").style.display="none";var e=l.responseText.indexOf("wfu_adminbrowser_page_success:");-1==e&&(e=l.responseText.length),l.responseText.substr(0,e);var t=l.responseText.substr(e+30,l.responseText.length-e-30);""!=t&&(t=wfu_plugin_decode_string(t),document.getElementById("wfu_adminbrowser_table").tBodies[0].innerHTML=t,document.getElementById("wfu_select_all_visible").checked=!1,wfu_adminbrowser_select_all_visible_changed(),n.selectedIndex=a-1,document.getElementById("wfu_adminbrowser_first_disabled").style.display=1==a?"inline":"none",document.getElementById("wfu_adminbrowser_prev_disabled").style.display=1==a?"inline":"none",document.getElementById("wfu_adminbrowser_first").style.display=1==a?"none":"inline",document.getElementById("wfu_adminbrowser_prev").style.display=1==a?"none":"inline",document.getElementById("wfu_adminbrowser_last_disabled").style.display=a==n.options.length?"inline":"none",document.getElementById("wfu_adminbrowser_next_disabled").style.display=a==n.options.length?"inline":"none",document.getElementById("wfu_adminbrowser_last").style.display=a==n.options.length?"none":"inline",document.getElementById("wfu_adminbrowser_next").style.display=a==n.options.length?"none":"inline")}},l.send(s)}}}function wfu_focus_table_on_highlighted_file(e){var t=document.querySelector("#"+e+" tr.wfu-highlighted");if(t){var n=document.getElementById("wpadminbar");n&&(n=jQuery(n).is(":visible")?n:null),jQuery("html, body").animate({scrollTop:jQuery(t).offset().top-(n?jQuery(n).height():0)+"px"},"fast")}}function wfu_apply_notifications_bulkaction(){var e=document.getElementById("wfu_notifications_bulkactions");if(!(e.selectedIndex<1)){var t=document.querySelectorAll(".wfu_selectors:checked");if(0!=t.length){for(var n=[],o=0;o<t.length;o++){var a=t[o].className.replace(/.*?wfu_selcode_/,"");""!=a&&n.push(a)}var l=document.getElementById("wfu_notifications_action_url").value,r=document.getElementById("wfu_notifications_referer").value,s=document.getElementById("wfu_notifications_nonce").value,u="";switch(e.options[e.selectedIndex].value){case"mark_read":u="mark_notifications_read";break;case"mark_unread":u="mark_notifications_unread";break;case"delete":u="delete_notifications"}if(""!=u){var d=document.createElement("FORM");d.method="POST",d.action=l,d.style.display="none";var _=document.createElement("INPUT");_.type="hidden",_.name="action",_.value=u,d.appendChild(_);var i=document.createElement("INPUT");i.type="hidden",i.name="key",i.value="list:"+n.join(),d.appendChild(i);var c=document.createElement("INPUT");c.type="hidden",c.name="referer",c.value=r,d.appendChild(c);var f=document.createElement("INPUT");f.type="hidden",f.name="nonce",f.value=s,d.appendChild(f),document.body.appendChild(d),d.submit()}}}}function wfu_apply_notifications_filter(){var e=document.querySelectorAll('.wfu-filters .subsubsub li:not(.all) input[type="checkbox"]'),t="";if(!document.querySelector('.wfu-filters .subsubsub li.all input[type="checkbox"]').checked)for(var n=0;n<e.length;n++)e[n].checked&&(t+=(""==t?"":"_")+e[n].parentElement.className);var o=document.getElementById("wfu_notifications_action_url").value,a=document.getElementById("wfu_notifications_cursort").value;o+="&action=plugin_notifications",""!=a&&(o+="&sort="+a),""!=t&&(o+="&filter="+t);var l=document.createElement("FORM");l.method="POST",l.action=o,l.style.display="none",document.body.appendChild(l),l.submit()}function wfu_goto_notifications_page(e,t){var n=document.getElementById("wfu_notifications_pages"),o=n.selectedIndex+1,a=o;if("next"==t?a=Math.min(o+1,n.options.length):"prev"==t?a=Math.max(o-1,1):"last"==t?a=n.options.length:"first"==t?a=1:"sel"==t&&(o=-1),a!=o){var l=document.getElementById("wfu_notifications_action_url").value,r=document.getElementById("wfu_notifications_cursort").value,s=document.getElementById("wfu_notifications_filter").value;l+="&action=plugin_notifications",""!=r&&(l+="&sort="+r),""!=s&&(l+="&filter="+s),l+="&pageid="+a;var u=document.createElement("FORM");u.method="POST",u.action=l,u.style.display="none",document.body.appendChild(u),u.submit()}}function wfu_cleanlog_initialize_elements(){jQuery("#wfu_cleanlog_dateold").datepicker({dateFormat:"yy-mm-dd",beforeShow:function(){wfu_cleanlog_element_handler()},onSelect:function(){wfu_cleanlog_element_handler()},onClose:function(){wfu_cleanlog_element_handler()}}),jQuery("#wfu_cleanlog_datefrom").datepicker({dateFormat:"yy-mm-dd",beforeShow:function(){wfu_cleanlog_element_handler()},onSelect:function(){wfu_cleanlog_element_handler()},onClose:function(){wfu_cleanlog_element_handler()}}),jQuery("#wfu_cleanlog_dateto").datepicker({dateFormat:"yy-mm-dd",beforeShow:function(){wfu_cleanlog_element_handler()},onSelect:function(){wfu_cleanlog_element_handler()},onClose:function(){wfu_cleanlog_element_handler()}}),wfu_attach_element_handlers(document.getElementById("wfu_cleanlog_periodold"),wfu_cleanlog_element_handler),wfu_attach_element_handlers(document.getElementById("wfu_cleanlog_periodtype"),wfu_cleanlog_element_handler)}function wfu_cleanlog_element_handler(e){document.querySelector(".wfu_cleanlog_error").classList.add("hidden")}function wfu_cleanlog_period_changed(){var e=document.getElementById("wfu_cleanlog_period");0==e.selectedIndex?(document.querySelector(".wfu_selectdate_container").style.display="block",document.querySelector(".wfu_selectperiod_container").style.display="none",document.querySelector(".wfu_selectdates_container").style.display="none",document.getElementById("wfu_cleanlog_dateold").value="",document.querySelector(".wfu_cleanlog_proceed").classList.remove("disabled")):1==e.selectedIndex?(document.querySelector(".wfu_selectdate_container").style.display="none",document.querySelector(".wfu_selectperiod_container").style.display="block",document.querySelector(".wfu_selectdates_container").style.display="none",document.getElementById("wfu_cleanlog_periodold").value="1",document.getElementById("wfu_cleanlog_periodtype").selectedIndex=1,document.querySelector(".wfu_cleanlog_proceed").classList.remove("disabled")):2==e.selectedIndex?(document.querySelector(".wfu_selectdate_container").style.display="none",document.querySelector(".wfu_selectperiod_container").style.display="none",document.querySelector(".wfu_selectdates_container").style.display="block",document.getElementById("wfu_cleanlog_datefrom").value="",document.getElementById("wfu_cleanlog_dateto").value="",document.querySelector(".wfu_cleanlog_proceed").classList.remove("disabled")):3==e.selectedIndex?(document.querySelector(".wfu_selectdate_container").style.display="none",document.querySelector(".wfu_selectperiod_container").style.display="none",document.querySelector(".wfu_selectdates_container").style.display="none",document.querySelector(".wfu_cleanlog_proceed").classList.remove("disabled")):(document.querySelector(".wfu_selectdate_container").style.display="none",document.querySelector(".wfu_selectperiod_container").style.display="none",document.querySelector(".wfu_selectdates_container").style.display="none",document.querySelector(".wfu_cleanlog_proceed").classList.add("disabled")),document.querySelector(".wfu_cleanlog_error").classList.add("hidden")}function wfu_cleanlog_selector_toggle(e){e?(document.getElementById("wfu_includefiles").checked=!1,document.getElementById("wfu_cleanlog_period").selectedIndex=-1,wfu_cleanlog_period_changed(),document.querySelector(".wfu_cleanlog_tr").style.display="table-row"):document.querySelector(".wfu_cleanlog_tr").style.display="none"}function wfu_cleanlog_selector_validate(){var e={error:"",param:""},t=document.getElementById("wfu_includefiles").checked?"1":"0",n=document.getElementById("wfu_cleanlog_period");if(-1==n.selectedIndex)e.error="Invalid clean-up period selected";else if(0==n.selectedIndex){var o=jQuery("#wfu_cleanlog_dateold").datepicker("getDate");if(null==o)e.error="Invalid or empty date";else if(o>new Date)e.error="Date must be older than today";else{var a=jQuery.datepicker.formatDate("yymmdd",o);e.param="0"+t+":"+a.toString()}}else if(1==n.selectedIndex){var l=document.getElementById("wfu_cleanlog_periodold"),r=document.getElementById("wfu_cleanlog_periodtype");parseInt(l.value)<=0?e.error="Invalid period":r.selectedIndex<0||r.selectedIndex>2?e.error="Invalid period interval":e.param="1"+t+":"+l.value.toString()+":"+r.value.substr(0,1)}else if(2==n.selectedIndex){var s=jQuery("#wfu_cleanlog_datefrom").datepicker("getDate"),u=jQuery("#wfu_cleanlog_dateto").datepicker("getDate");if(null==s)e.error="Invalid or empty starting date";else if(null==u)e.error="Invalid or empty ending date";else if(s>new Date)e.error="Starting date must be older than today";else if(u>s)e.error="Ending date must be older or equal to starting date";else{var d=jQuery.datepicker.formatDate("yymmdd",s),_=jQuery.datepicker.formatDate("yymmdd",u);e.param="2"+t+":"+d.toString()+":"+_.toString()}}else 3==n.selectedIndex&&(e.param="3"+t);return e}function wfu_cleanlog_selector_checkproceed(){var e=wfu_cleanlog_selector_validate();return""!=e.error?(document.querySelector(".wfu_cleanlog_error").innerHTML=e.error,document.querySelector(".wfu_cleanlog_error").classList.remove("hidden"),!1):(document.querySelector(".wfu_cleanlog_error").classList.add("hidden"),document.querySelector(".wfu_cleanlog_proceed").href=document.getElementById("wfu_cleanlog_href").value+"&data="+e.param,!0)}function wfu_initialize_consent_policy(e){wfu_PD_bank.params=e,wfu_adjust_pdops_levels(),wfu_adjust_permissions_levels(),wfu_adjust_logactions_levels(),wfu_attach_pdheaders_events(),wfu_attach_pdops_events(),wfu_attach_conops_events(),wfu_pdops_update(!0),wfu_allops_freeze_events=!0,wfu_conops_update(),wfu_consent_question_optable_recreate(),wfu_update_consent_questions(),wfu_consent_question_operations_reassign(),wfu_update_consent_question_itemprops(0,-1),wfu_permissions_update(!0),wfu_logactions_update(!0),wfu_pdusers_update(),wfu_allops_freeze_events=!1}function wfu_get_consent_policy(){var e=wfu_plugin_decode_string(document.getElementById("wfu_consent_policy").value),t=null;try{t=JSON.parse(e)}catch(e){}return t}function wfu_get_permissions_policy(){var e=wfu_plugin_decode_string(document.getElementById("wfu_permissions_policy").value),t=null;try{t=JSON.parse(e)}catch(e){}return t}function wfu_get_logactions_policy(){var e=wfu_plugin_decode_string(document.getElementById("wfu_logactions_policy").value),t=null;try{t=JSON.parse(e)}catch(e){}return t}function wfu_get_pd_users(){var e=wfu_plugin_decode_string(document.getElementById("wfu_assigned_users").value),t=null;try{t=JSON.parse(e)}catch(e){}return t}function wfu_set_consent_policy(e){var t=JSON.stringify(e);document.getElementById("wfu_consent_policy").value=wfu_plugin_encode_string(t)}function wfu_set_logactions_policy(e){var t=JSON.stringify(e);document.getElementById("wfu_logactions_policy").value=wfu_plugin_encode_string(t)}function wfu_set_permissions_policy(e){var t=JSON.stringify(e);document.getElementById("wfu_permissions_policy").value=wfu_plugin_encode_string(t)}function wfu_adjust_pdops_levels(){function e(t){var o=t.ID;if(t.children.length>0)for(var a=0;a<t.children.length;a++)e(t.children[a]);else n.operations[o].Allowed=!0}function t(n,a){if(n.children.length>0)for(var l=0;l<n.children.length;l++)t(n.children[l],a+1);var r=n.ID;0==wfu_PD_bank.allowedstatus[r]&&a==wfu_PD_bank.params.oplevels&&(e(n),wfu_PD_bank.allowedstatus[r]=1,o=!0)}wfu_pdops_update(!1);var n=wfu_get_consent_policy();if(n){console.log(n);for(var o=!1,a=0;a<n.structure.length;a++)t(n.structure[a],1);o&&wfu_set_consent_policy(n)}}function wfu_attach_pdheaders_events(){var e,t=document.querySelectorAll(".wfu_pdheader_button");for(e=0;e<t.length;e++)t[e].addEventListener("click",(function(){this.classList.toggle("expanded");var e=null;this.classList.contains("wfu_pdop_header_button")?e=document.querySelector(".wfu_plugin_operations"):this.classList.contains("wfu_conop_header_button")?e=document.querySelector(".wfu_consent_operations"):this.classList.contains("wfu_conquestion_header_button")?e=document.querySelector(".wfu_consent_questions"):this.classList.contains("wfu_permissions_header_button")?e=document.querySelector(".wfu_consent_permissions"):this.classList.contains("wfu_logactions_header_button")?e=document.querySelector(".wfu_consent_logactions"):this.classList.contains("wfu_pdusers_header_button")&&(e=document.querySelector(".wfu_consent_users")),e&&(this.classList.contains("expanded")?e.style.display="block":e.style.display="none")}))}function wfu_attach_pdops_events(){var e,t=document.querySelectorAll(".wfu_pdop_button");for(e=0;e<t.length;e++)t[e].addEventListener("click",(function(){this.classList.toggle("expanded");var e=this.parentElement.nextElementSibling;this.classList.contains("expanded")?e.style.display="block":e.style.display="none"}))}function wfu_attach_conops_events(){var e,t=document.querySelectorAll(".wfu_conop_button");for(e=0;e<t.length;e++)t[e].addEventListener("click",(function(){this.classList.toggle("expanded");var e=this.parentElement.nextElementSibling;this.classList.contains("expanded")?e.style.display="block":e.style.display="none"}))}function wfu_pdop_toggle(e){if(!wfu_allops_freeze_events&&-1!=e.id.indexOf("wfu_pdop_")){var t=e.id.replace("wfu_pdop_",""),n=wfu_get_consent_policy();if(n){if(void 0===n.operations[t])return;var o=e.classList.contains("indeterminate")?0:e.checked?-1:1,a=!!e.classList.contains("indeterminate")||e.checked;if(e.indeterminate||e.classList.remove("indeterminate"),n.children_index[t].length>0){for(var l=1,r=t;(r=n.operations[r].Parent)>0;)l++;if((wfu_PD_bank.params.oplevels<1||l<wfu_PD_bank.params.oplevels)&&!confirm("This will set all children operations to "+(a?"allowed":"not allowed")+". Continue?"))return wfu_allops_freeze_events=!0,wfu_set_checkbox_status(e,o),void(wfu_allops_freeze_events=!1);for(var s=0;s<n.children_index[t].length;s++){var u=n.children_index[t][s];0==n.children_index[u].length&&(n.operations[u].Allowed=a)}}else n.operations[t].Allowed=a;wfu_set_consent_policy(n),wfu_allops_freeze_events=!0,wfu_pdops_update(!0),wfu_conops_update(),wfu_update_consent_question_itemprops(0,-1),wfu_consent_question_optable_recreate(),wfu_consent_question_operations_reassign(),wfu_consent_question_optable_update(0,0),wfu_allops_freeze_events=!1}}}function wfu_conop_toggle(e){if(!wfu_allops_freeze_events&&-1!=e.id.indexOf("wfu_conop_")){var t=e.id.replace("wfu_conop_",""),n=wfu_get_consent_policy();if(n){if(void 0===n.operations[t])return;var o=e.classList.contains("indeterminate")?0:e.checked?-1:1,a=!!e.classList.contains("indeterminate")||e.checked;if(e.indeterminate||check.classList.remove("indeterminate"),n.children_index[t].length>0){for(var l=1,r=t;(r=n.operations[r].Parent)>0;)l++;if((wfu_PD_bank.params.oplevels<1||l<wfu_PD_bank.params.oplevels)&&!confirm("This will make all children operations "+(a?"require":"not require")+" consent. Continue?"))return wfu_allops_freeze_events=!0,wfu_set_checkbox_status(e,o),void(wfu_allops_freeze_events=!1);for(var s=0;s<n.children_index[t].length;s++){var u=n.children_index[t][s];0==n.children_index[u].length&&(n.operations[u].NeedsConsent=a)}}else n.operations[t].NeedsConsent=a;wfu_set_consent_policy(n),wfu_allops_freeze_events=!0,wfu_conops_update(),wfu_update_consent_question_itemprops(0,-1),wfu_consent_question_optable_recreate(),wfu_consent_question_operations_reassign(),wfu_consent_question_optable_update(0,0),wfu_allops_freeze_events=!1}}}function wfu_pdops_update(e){function t(o,a){var l=o.ID;if(o.children.length>0){n.operations[l].allowedstatus={},n.operations[l].pdvisible=!1;for(var r=0;r<o.children.length;r++){t(o.children[r],a+1);var s=o.children[r].ID;if(n.operations[s].pdvisible){for(var u in n.operations[s].Allowed,n.operations[s].allowedstatus)if(n.operations[s].allowedstatus.hasOwnProperty(u)){var d=n.operations[s].allowedstatus[u];void 0===n.operations[l].allowedstatus[u]?n.operations[l].allowedstatus[u]=d:n.operations[l].allowedstatus[u]*d<1&&(n.operations[l].allowedstatus[u]=0)}n.operations[l].pdvisible||(n.operations[l].pdvisible=n.operations[s].pdvisible)}}}else!function(e){var t=n.operations[e].Allowed;n.operations[e].allowedstatus={};for(var o=0;o<n.operations[e].Datatypes.length;o++){var a=n.operations[e].Datatypes[o];n.operations[e].allowedstatus[a]=t?1:-1}var l=n.operations[e].Condition;if(""==l)n.operations[e].pdvisible=!0;else{var r=!1;"!"==l.substr(0,1)&&(r=!0,l=l.replace("!",""));var s=n.operations[parseInt(l)].allowedstatus,u=!1;for(var a in s)if(s.hasOwnProperty(a)&&s[a]>-1){u=!0;break}n.operations[e].pdvisible=r?!u:u}}(l);var _=-2;for(var u in n.operations[l].allowedstatus)if(n.operations[l].allowedstatus.hasOwnProperty(u))if(d=n.operations[l].allowedstatus[u],-2==_)_=d;else if(_*d<1){_=0;break}if(void 0===wfu_PD_bank.allowedstatus&&(wfu_PD_bank.allowedstatus={}),wfu_PD_bank.allowedstatus[l]=_,void 0===wfu_PD_bank.level&&(wfu_PD_bank.level={}),wfu_PD_bank.level[l]=a,e){wfu_set_checkbox_status(document.getElementById("wfu_pdop_"+l),_);var i=document.getElementById("wfu_pdop_container_"+l);i&&(i.style.display=n.operations[l].pdvisible&&(wfu_PD_bank.params.oplevels<1||a<=wfu_PD_bank.params.oplevels)?"block":"none")}}var n=wfu_get_consent_policy();if(n){wfu_allops_freeze_events=!0;for(var o=0;o<n.structure.length;o++)t(n.structure[o],1);wfu_allops_freeze_events=!1}}function wfu_conops_update(){function e(n,o){var a=n.ID;if(n.children.length>0){t.operations[a].needsconsentstatus=-2,t.operations[a].convisible=!1;for(var l=0;l<n.children.length;l++){e(n.children[l],o+1);var r=n.children[l].ID;if(t.operations[r].convisible){var s=t.operations[r].needsconsentstatus;-2==t.operations[a].needsconsentstatus?t.operations[a].needsconsentstatus=s:t.operations[a].needsconsentstatus*s<1&&(t.operations[a].needsconsentstatus=0),t.operations[a].convisible||(t.operations[a].convisible=t.operations[r].convisible)}}}else!function(e){t.operations[e].needsconsentstatus=t.operations[e].Allowed&&t.operations[e].NeedsConsent?1:-1;var n=t.operations[e].Condition;if(""==n)t.operations[e].convisible=!0;else{var o=!1;"!"==n.substr(0,1)&&(o=!0,n=n.replace("!",""));var a=wfu_PD_bank.allowedstatus[parseInt(n)]>-1;t.operations[e].convisible=o?!a:a}t.operations[e].convisible=t.operations[e].convisible&&t.operations[e].Allowed}(a);void 0===wfu_PD_bank.visible&&(wfu_PD_bank.visible={}),wfu_PD_bank.visible[a]=t.operations[a].convisible,void 0===wfu_PD_bank.needsconsentstatus&&(wfu_PD_bank.needsconsentstatus={}),wfu_PD_bank.needsconsentstatus[a]=t.operations[a].needsconsentstatus,wfu_set_checkbox_status(document.getElementById("wfu_conop_"+a),t.operations[a].needsconsentstatus);var u=document.getElementById("wfu_conop_container_"+a);u&&(u.style.display=t.operations[a].convisible&&(wfu_PD_bank.params.oplevels<1||o<=wfu_PD_bank.params.oplevels)?"block":"none")}var t=wfu_get_consent_policy();if(t){wfu_allops_freeze_events=!0;for(var n=0;n<t.structure.length;n++)e(t.structure[n],1);wfu_allops_freeze_events=!1}}function wfu_update_consent_questions(){var e=wfu_get_consent_policy();if(e){var t=document.getElementById("wfu_conquestions_container");wfu_allops_freeze_events=!0;for(var n=0;n<e.questions.length;n++){var o=wfu_render_consent_question(n);o&&(t.appendChild(o),wfu_update_consent_question(n,!0))}wfu_update_conquestion_header(),wfu_allops_freeze_events=!1}}function wfu_render_consent_question(e){var t=wfu_get_consent_policy();if(!t)return null;var n=t.questions[e],o=e+1,a=document.createElement("DIV");a.className="wfu_conquestion_container",a.id="wfu_conquestion_container_"+o;var l=document.createElement("DIV");l.className="wfu_conquestion_header";var r=document.createElement("LABEL");r.className="wfu_conquestion_headerlabel",r.innerHTML="Question "+o,l.appendChild(r);var s=document.createElement("DIV");s.className="wfu_conquestion_tools";var u=document.getElementById("wfu_conquestion_add").cloneNode(!0);u.removeAttribute("id"),wfu_addEventHandler(u,"click",wfu_conquestion_tools_handler);var d=document.getElementById("wfu_conquestion_remove").cloneNode(!0);d.removeAttribute("id"),wfu_addEventHandler(d,"click",wfu_conquestion_tools_handler);var _=document.getElementById("wfu_conquestion_up").cloneNode(!0);_.removeAttribute("id"),wfu_addEventHandler(_,"click",wfu_conquestion_tools_handler);var i=document.getElementById("wfu_conquestion_down").cloneNode(!0);i.removeAttribute("id"),wfu_addEventHandler(i,"click",wfu_conquestion_tools_handler),s.appendChild(u),s.appendChild(d),s.appendChild(_),s.appendChild(i),l.appendChild(s);var c=document.createElement("DIV");c.className="wfu_conquestion_subcontainer";var f=document.createElement("DIV");f.className="wfu_conquestion_mainprops";var m=document.createElement("LABEL");m.className="wfu_conquestion_mainpropstitle",m.innerHTML="Main Properties";var p=document.createElement("LABEL");p.className="wfu_conquestion_titlelabel",p.innerHTML="Title";var w=document.createElement("INPUT");w.className="wfu_conquestion_titletext",w.value=n.title,wfu_attach_element_handlers(w,wfu_conquestion_mainprops_handler);var v=document.createElement("LABEL");v.className="wfu_conquestion_titlelocationlabel",v.innerHTML="Title Location";var g=document.createElement("SELECT");g.className="wfu_conquestion_titlelocationlist",(M=document.createElement("OPTION")).value="top",M.innerHTML="Top",M.selected="top"==n.location,g.add(M),(M=document.createElement("OPTION")).value="bottom",M.innerHTML="Bottom",M.selected="bottom"==n.location,g.add(M),wfu_addEventHandler(g,"change",wfu_conquestion_mainprops_handler);var h=document.createElement("LABEL");h.className="wfu_conquestion_matrixlabel",h.innerHTML="Number of Items";var b=document.createElement("INPUT");b.className="wfu_conquestion_matrix_x",b.type="number",b.min=1;var y=parseInt(n.x);y<=0&&(y=1),n.x=y,b.value=y,wfu_attach_element_handlers(b,wfu_conquestion_mainprops_handler);var I=document.createElement("LABEL");I.className="wfu_conquestion_matrixsep",I.innerHTML="x";var E=document.createElement("INPUT");E.className="wfu_conquestion_matrix_y",E.type="number",E.min=1;var k=parseInt(n.y);k<=0&&(k=1),n.y=k,E.value=k,wfu_attach_element_handlers(E,wfu_conquestion_mainprops_handler);var B=document.createElement("LABEL");B.className="wfu_conquestion_groupedlabel",B.innerHTML="Grouped";var x=document.createElement("INPUT");x.className="wfu_conquestion_groupedbox",x.type="checkbox",x.checked=1==n.grouped,wfu_addEventHandler(x,"change",wfu_conquestion_mainprops_handler);var q=document.createElement("LABEL");q.className="wfu_conquestion_typelabel",q.innerHTML="Type";var N=document.createElement("SELECT");N.className="wfu_conquestion_typelist",(M=document.createElement("OPTION")).value="checkbox",M.innerHTML="Checkbox",M.selected="checkbox"==n.type,N.add(M),(M=document.createElement("OPTION")).value="radio",M.innerHTML="Radio",M.selected="radio"==n.type,N.add(M),(M=document.createElement("OPTION")).value="prompt",M.innerHTML="Prompt",M.selected="prompt"==n.type,N.add(M),wfu_addEventHandler(N,"change",wfu_conquestion_mainprops_handler),f.appendChild(m),f.appendChild(h),f.appendChild(b),f.appendChild(I),f.appendChild(E),f.appendChild(p),f.appendChild(w),f.appendChild(v),f.appendChild(g),f.appendChild(B),f.appendChild(x),f.appendChild(q),f.appendChild(N);var L=document.createElement("DIV");L.className="wfu_conquestion_itemspreview";var S=document.createElement("LABEL");S.className="wfu_conquestion_itemspreviewtitle",S.innerHTML="Items";var T=document.createElement("LABEL");T.className="wfu_conquestion_displayedtitle",T.innerHTML=n.title;var P=document.createElement("TABLE");P.className="wfu_conquestion_itemtable",L.appendChild(S),"bottom"!=n.location&&L.appendChild(T),L.appendChild(P),"bottom"==n.location&&L.appendChild(T),wfu_addEventHandler(L,"click",wfu_conquestion_itempreviewer_handler);var D=document.createElement("DIV");D.className="wfu_conquestion_itemprops";var A=document.createElement("LABEL");A.className="wfu_conquestion_itempropstitle",A.innerHTML="Item Properties";var O=document.createElement("LABEL");O.className="wfu_conquestion_labellabel",O.innerHTML="Label";var C=document.createElement("INPUT");C.className="wfu_conquestion_labeltext",C.value="",wfu_attach_element_handlers(C,wfu_conquestion_mainprops_handler);var H=document.createElement("LABEL");H.className="wfu_conquestion_labellocationlabel",H.innerHTML="Label Location";var M,j=document.createElement("SELECT");j.className="wfu_conquestion_labellocationlist",(M=document.createElement("OPTION")).value="top",M.innerHTML="Top",M.selected=!1,j.add(M),(M=document.createElement("OPTION")).value="left",M.innerHTML="Left",M.selected=!1,j.add(M),(M=document.createElement("OPTION")).value="right",M.innerHTML="Right",M.selected=!0,j.add(M),(M=document.createElement("OPTION")).value="bottom",M.innerHTML="Bottom",M.selected=!1,j.add(M),wfu_addEventHandler(j,"change",wfu_conquestion_mainprops_handler);var z=document.createElement("LABEL");z.className="wfu_conquestion_preselectedlabel",z.innerHTML="Preselected";var R=document.createElement("INPUT");R.className="wfu_conquestion_preselectedbox",R.type="checkbox",R.checked=!1,wfu_addEventHandler(R,"change",wfu_conquestion_mainprops_handler);var V=document.createElement("LABEL");V.className="wfu_conquestion_visiblelabel",V.innerHTML="Visible";var U=document.createElement("INPUT");return U.className="wfu_conquestion_visiblebox",U.type="checkbox",U.checked=!0,wfu_addEventHandler(U,"change",wfu_conquestion_mainprops_handler),D.appendChild(A),D.appendChild(O),D.appendChild(C),D.appendChild(H),D.appendChild(j),D.appendChild(z),D.appendChild(R),D.appendChild(V),D.appendChild(U),c.appendChild(f),c.appendChild(L),c.appendChild(D),a.appendChild(l),a.appendChild(c),a}function wfu_consent_question_action(e,t){var n=wfu_get_consent_policy();if(n){var o=document.getElementById("wfu_conquestions_container"),a=document.querySelectorAll(".wfu_conquestion_container").length;if("add"==e){n.questions.splice(t+1,0,{title:"",location:"top",x:1,y:1,grouped:0,type:"checkbox",items:[{index:1,label:"I agree to allow the plugin to use my personal data",location:"right",preselect:0,visible:!0,operations:{}}]}),wfu_set_consent_policy(n);var l=wfu_render_consent_question(t+1);if(l){for(var r=t+2;r<=a;r++)document.getElementById("wfu_conquestion_container_"+r).id="wfu_conquestion_container_"+(r+1);o.insertBefore(l,document.getElementById("wfu_conquestion_container_"+(t+3))),wfu_update_consent_question(t+1,!0),wfu_update_consent_question_itemprops(t+1,-1)}}else if("remove"==e){if(a<=1)return;for(n.questions.splice(t,1),wfu_set_consent_policy(n),o.removeChild(document.getElementById("wfu_conquestion_container_"+(t+1))),r=t+2;r<=a;r++)document.getElementById("wfu_conquestion_container_"+r).id="wfu_conquestion_container_"+(r-1)}else if("up"==e){if(t<=0)return;var s=n.questions[t];n.questions[t]=n.questions[t-1],n.questions[t-1]=s,wfu_set_consent_policy(n);var u=document.getElementById("wfu_conquestion_container_"+(t+1)),d=document.getElementById("wfu_conquestion_container_"+t);u.id="wfu_conquestion_container_"+t+"_temp",d.id="wfu_conquestion_container_"+(t+1),u.id="wfu_conquestion_container_"+t,o.insertBefore(u,d)}else if("down"==e){if(t>=a-1)return;s=n.questions[t],n.questions[t]=n.questions[t+1],n.questions[t+1]=s,wfu_set_consent_policy(n),u=document.getElementById("wfu_conquestion_container_"+(t+2)),d=document.getElementById("wfu_conquestion_container_"+(t+1)),u.id="wfu_conquestion_container_"+(t+1)+"_temp",d.id="wfu_conquestion_container_"+(t+2),u.id="wfu_conquestion_container_"+(t+1),o.insertBefore(u,d)}}}function wfu_update_consent_question(e,t){var n=wfu_get_consent_policy();if(n){var o=n.questions[e],a=e+1,l=document.querySelector("#wfu_conquestion_container_"+a+" .wfu_conquestion_itemspreview"),r=document.querySelector("#wfu_conquestion_container_"+a+" .wfu_conquestion_itemtable"),s=document.querySelector("#wfu_conquestion_container_"+a+" .wfu_conquestion_displayedtitle");if(l){if(t){var u=document.querySelector("#wfu_conquestion_container_"+a+" .wfu_conquestion_matrix_x"),d=document.querySelector("#wfu_conquestion_container_"+a+" .wfu_conquestion_matrix_y"),_=document.querySelector("#wfu_conquestion_container_"+a+" .wfu_conquestion_titletext"),i=document.querySelector("#wfu_conquestion_container_"+a+" .wfu_conquestion_titlelocationlist"),c=document.querySelector("#wfu_conquestion_container_"+a+" .wfu_conquestion_groupedbox");for(u.value=o.x,d.value=o.y,_.value=o.title,i.value=o.location,c.checked=1==o.grouped,u.disabled="prompt"==o.type,d.disabled="prompt"==o.type,_.disabled="prompt"==o.type,i.disabled="prompt"==o.type,c.disabled="prompt"==o.type,s.style.display="prompt"==o.type?"none":"block";r.rows.length>0;)r.deleteRow(0)}for(var f=o.x*o.y,m=[],p=0;p<f;p++)m.push({label:"",location:"right",preselect:!1,visible:!0,operations:{}});for(p=0;p<o.items.length;p++)void 0===o.items[p].visible&&(o.items[p].visible=1);for(p=0;p<o.items.length;p++){var w=o.items[p].index-1;w>=0&&w<f&&(m[w].label=o.items[p].label,m[w].location=o.items[p].location,m[w].preselect=1==o.items[p].preselect,m[w].visible=void 0===o.items[p].visible||1==o.items[p].visible,m[w].operations=o.items[p].operations)}p=0;for(var v=0;v<o.x;v++){var g;g=t?r.insertRow(v):r.rows[v];for(var h=0;h<o.y;h++){var b;for(t?(b=g.insertCell(h)).classList.add("wfu_conquestion_itemcontainer"):b=g.cells[h];b.childNodes.length>0;)b.removeChild(b.childNodes[0]);m[p].visible?b.classList.add("wfu_item_visible"):b.classList.remove("wfu_item_visible");var y=document.createElement("LABEL");if(y.className="wfu_conquestion_itemlabel",""==m[p].label?(y.classList.add("wfu_empty_label"),y.innerHTML="{no label}"):(y.classList.remove("wfu_empty_label"),y.innerHTML=m[p].label),"prompt"==o.type)b.appendChild(y);else{var I=document.createElement("INPUT");I.className="wfu_conquestion_itembox wfu_frozen",I.type=o.type,I.checked=m[p].preselect,"top"==m[p].location?(b.appendChild(y),b.appendChild(document.createElement("BR")),b.appendChild(I)):"left"==m[p].location?(b.appendChild(y),b.appendChild(I)):"bottom"==m[p].location?(b.appendChild(I),b.appendChild(document.createElement("BR")),b.appendChild(y)):(b.appendChild(I),b.appendChild(y))}p++}}""==o.title?(s.classList.add("wfu_empty_label"),s.innerHTML="{no title}"):(s.classList.remove("wfu_empty_label"),s.innerHTML=o.title),"bottom"!=o.location?l.insertBefore(s,r):l.insertBefore(s,null)}}}function wfu_conquestion_mainprops_handler(e){if(!wfu_allops_freeze_events){var t=wfu_get_consent_policy();if(t){e=e||window.event;for(var n=par=e.target;(par=par.parentElement)&&!par.classList.contains("wfu_conquestion_container"););var o=parseInt(par.id.replace("wfu_conquestion_container_","")),a=o-1,l=t.questions[a],r=!0,s=!0,u=!1;if(n.classList.contains("wfu_conquestion_titletext"))l.title=n.value;else if(n.classList.contains("wfu_conquestion_matrix_x"))l.x=n.value;else if(n.classList.contains("wfu_conquestion_matrix_y"))l.y=n.value;else if(n.classList.contains("wfu_conquestion_titlelocationlist"))l.location=n.value;else if(n.classList.contains("wfu_conquestion_groupedbox")){if(l.grouped=n.checked?1:0,1==l.grouped)for(var d=0,_=0;_<l.items.length;_++)1==d?l.items[_].preselect=0:1==l.items[_].preselect&&d++}else if(n.classList.contains("wfu_conquestion_typelist"))l.type=n.value,"prompt"==l.type&&(l.x=1,l.y=1,l.title="",l.location="top",l.grouped=0);else{var i=document.querySelectorAll("#wfu_conquestion_container_"+o+" .wfu_conquestion_itemcontainer.wfu_item_selected");if(0==i.length)return;var c=i[0].parentNode.rowIndex*i[0].parentNode.cells.length+i[0].cellIndex+1,f=null,m=l.items.length;for(_=0;_<l.items.length;_++){if(l.items[_].index==c){f=l.items[_];break}if(l.items[_].index>c){m=_;break}}if(f||(f={index:c,label:"",location:"right",preselect:!1,visible:1,operations:{}},l.items.splice(m,0,f)),n.classList.contains("wfu_conquestion_labeltext"))f.label=n.value;else if(n.classList.contains("wfu_conquestion_labellocationlist"))f.location=n.value;else if(n.classList.contains("wfu_conquestion_preselectedbox")){if(n.checked&&1==l.grouped)for(_=0;_<l.items.length;_++)l.items[_].preselect=0;f.preselect=n.checked?1:0}else n.classList.contains("wfu_conquestion_visiblebox")&&(f.visible=n.checked?1:0,u=!0);r=!1,s=!1}wfu_set_consent_policy(t),wfu_allops_freeze_events=!0,wfu_update_consent_question(a,r),s&&(wfu_update_consent_question_itemprops(a,-1),wfu_consent_question_operations_reassign()),u&&(wfu_consent_question_operations_reassign(),wfu_consent_question_optable_update(o,c)),wfu_allops_freeze_events=!1}}}function wfu_conquestion_itempreviewer_handler(e){if(!wfu_allops_freeze_events){e=e||window.event;for(var t=par=e.target,n=document.querySelectorAll(".wfu_conquestion_container").length;(par=par.parentElement)&&!par.classList.contains("wfu_conquestion_container"););var o=parseInt(par.id.replace("wfu_conquestion_container_",""))-1;t.classList.contains("wfu_conquestion_itemcontainer")||(t=t.parentNode);var a=-1;t.classList.contains("wfu_conquestion_itemcontainer")&&(a=t.parentNode.rowIndex*t.parentNode.cells.length+t.cellIndex+1),wfu_allops_freeze_events=!0;for(var l=0;l<n;l++)wfu_update_consent_question_itemprops(l,-1);wfu_update_consent_question_itemprops(o,a),wfu_allops_freeze_events=!1}}function wfu_update_consent_question_itemprops(e,t){var n=wfu_get_consent_policy();if(n){for(var o=n.questions[e],a=e+1,l=document.querySelectorAll("#wfu_conquestions_container .wfu_conquestion_itemcontainer"),r=null,s=0,u=1,d=0;d<l.length;d++){l[d].classList.remove("wfu_item_selected");for(var _=l[d];(_=_.parentElement)&&!_.classList.contains("wfu_conquestion_container"););parseInt(_.id.replace("wfu_conquestion_container_",""))>s&&(s++,u=1),s==a&&u==t&&(r=l[d]),u++}r&&r.classList.add("wfu_item_selected");var i=document.querySelector("#wfu_conquestion_container_"+a+" .wfu_conquestion_labeltext"),c=document.querySelector("#wfu_conquestion_container_"+a+" .wfu_conquestion_labellocationlist"),f=document.querySelector("#wfu_conquestion_container_"+a+" .wfu_conquestion_preselectedbox"),m=document.querySelector("#wfu_conquestion_container_"+a+" .wfu_conquestion_visiblebox"),p=-1;for(d=0;d<o.items.length;d++)if(o.items[d].index==t){p=d;break}p<0?(i.value="",i.disabled=t<1,c.value="right",c.disabled=t<1,f.checked=!1,f.disabled=t<1,m.checked=!0,m.disabled=t<1):(i.disabled=!1,i.value=o.items[p].label,c.disabled="prompt"==o.type,c.value="prompt"==o.type?"":o.items[p].location,f.disabled="prompt"==o.type,f.checked="prompt"!=o.type&&1==o.items[p].preselect,m.disabled="prompt"==o.type||0==e&&1==t,m.checked="prompt"==o.type||void 0===o.items[p].visible||1==o.items[p].visible),wfu_consent_question_optable_update(a,t)}}function wfu_consent_question_optable_recreate(){var e=wfu_get_consent_policy();if(e){if(void 0!==wfu_PD_bank.conops)for(var t in wfu_PD_bank.conops)wfu_PD_bank.conops.hasOwnProperty(t)&&(wfu_PD_bank.conops[t].active=!1);for(var n=document.getElementById("wfu_conquestions_optable"),o=n.tBodies[0];o.rows.length>0;)n.rows[0].remove();var a=0;for(var t in wfu_PD_bank.allowedstatus)if(wfu_PD_bank.allowedstatus.hasOwnProperty(t)){var l=!0;if(l=(l=(l=l&&(0==e.children_index[t].length&&(wfu_PD_bank.params.oplevels<1||wfu_PD_bank.level[t]<=wfu_PD_bank.params.oplevels)||e.children_index[t].length>0&&wfu_PD_bank.level[t]==wfu_PD_bank.params.oplevels))&&1==wfu_PD_bank.needsconsentstatus[t])&&wfu_PD_bank.visible[t]){void 0===wfu_PD_bank.conops&&(wfu_PD_bank.conops={}),wfu_PD_bank.conops[t]={active:!0,qindex:[1],itemindex:[1],inverse:[!1],unassigned:!0,nonevisible:!1};var r=o.insertRow(a);r.id="wfu_conquestions_oprow_"+t;for(var s=r.insertCell(0),u=e.operations[t].Name,d=t;(d=e.operations[d].Parent)>0;)u=e.operations[d].Name+"/"+u;s.innerHTML=u,s=r.insertCell(1);var _=document.createElement("INPUT");_.type="radio",_.className="wfu_conquestions_opsel wfu_frozen",wfu_addEventHandler(_,"click",wfu_conquestion_optable_handler),s.appendChild(_),s=r.insertCell(2);var i=document.createElement("INPUT");i.type="checkbox",i.className="wfu_conquestions_opinv wfu_frozen",i.disabled=!0,wfu_addEventHandler(i,"change",wfu_conquestion_optable_handler),s.appendChild(i),a++}}}}function wfu_consent_question_operations_reassign(){var e=wfu_get_consent_policy();if(e){for(var t in wfu_PD_bank.conops)wfu_PD_bank.conops.hasOwnProperty(t)&&(wfu_PD_bank.conops[t].qindex=[],wfu_PD_bank.conops[t].itemindex=[],wfu_PD_bank.conops[t].inverse=[],wfu_PD_bank.conops[t].unassigned=!0,wfu_PD_bank.conops[t].nonevisible=!0);for(var n=0;n<e.questions.length;n++)for(var o=e.questions[n],a=0;a<o.items.length;a++){var l=o.items[a];for(var t in l.operations)l.operations.hasOwnProperty(t)&&void 0!==wfu_PD_bank.conops[t]&&(wfu_PD_bank.params.multi_op_assignments||0==wfu_PD_bank.conops[t].qindex.length?(wfu_PD_bank.conops[t].qindex.push(n+1),wfu_PD_bank.conops[t].itemindex.push(a+1),wfu_PD_bank.conops[t].inverse.push(-1==l.operations[t]),wfu_PD_bank.conops[t].unassigned=!1):delete l.operations[t])}for(var t in wfu_PD_bank.conops)if(wfu_PD_bank.conops.hasOwnProperty(t)){for(a=0;a<wfu_PD_bank.conops[t].qindex.length;){var r=wfu_PD_bank.conops[t].qindex[a],s=wfu_PD_bank.conops[t].itemindex[a],u=!1;if(r<1||r>e.questions.length)u=!0;else{var d=(o=e.questions[r-1]).x*o.y;(s<1||s>d)&&(u=!0)}u?(wfu_PD_bank.conops[t].qindex.splice(a,1),wfu_PD_bank.conops[t].itemindex.splice(a,1),wfu_PD_bank.conops[t].inverse.splice(a,1)):((void 0===(l=e.questions[r-1].items[s-1]).visible||l.visible)&&(wfu_PD_bank.conops[t].nonevisible=!1),a++)}wfu_PD_bank.conops[t].nonevisible&&(wfu_PD_bank.conops[t].unassigned=0==wfu_PD_bank.conops[t].qindex.length,wfu_PD_bank.conops[t].qindex.splice(0,0,1),wfu_PD_bank.conops[t].itemindex.splice(0,0,1),wfu_PD_bank.conops[t].inverse.splice(0,0,!1))}wfu_set_consent_policy(e),wfu_update_consent_question_item_assignments()}}function wfu_update_consent_question_item_assignments(){for(var e=document.querySelectorAll("#wfu_conquestions_container .wfu_conquestion_itemcontainer"),t=0;t<e.length;t++)e[t].classList.remove("wfu_item_assigned");for(var n in wfu_PD_bank.conops)if(wfu_PD_bank.conops.hasOwnProperty(n)&&wfu_PD_bank.conops[n].active)for(var o=0;o<wfu_PD_bank.conops[n].qindex.length;o++){var a=wfu_PD_bank.conops[n].qindex[o],l=wfu_PD_bank.conops[n].itemindex[o],r=document.querySelector("#wfu_conquestion_container_"+a+" .wfu_conquestion_itemtable"),s=r.rows[0].cells.length,u=Math.floor((l-1)/s),d=(l-1)%s;r.rows[u].cells[d].classList.add("wfu_item_assigned")}}function wfu_conquestion_conop_bankpos(e,t,n){for(var o=-1,a=0;a<wfu_PD_bank.conops[e].qindex.length;a++)if(wfu_PD_bank.conops[e].qindex[a]==t&&wfu_PD_bank.conops[e].itemindex[a]==n){o=a;break}return o}function wfu_consent_question_optable_update(e,t){var n=e<1||t<1;for(var o in wfu_PD_bank.conops)if(wfu_PD_bank.conops.hasOwnProperty(o)&&wfu_PD_bank.conops[o].active){var a=document.getElementById("wfu_conquestions_oprow_"+o),l=document.querySelector("#wfu_conquestions_oprow_"+o+" .wfu_conquestions_opsel"),r=document.querySelector("#wfu_conquestions_oprow_"+o+" .wfu_conquestions_opinv");wfu_PD_bank.conops[o].unassigned||wfu_PD_bank.conops[o].nonevisible?a.classList.add("wfu_op_unassigned"):a.classList.remove("wfu_op_unassigned");var s=wfu_conquestion_conop_bankpos(o,e,t);l.checked=!n&&s>-1,!n&&s>-1&&(wfu_PD_bank.conops[o].unassigned||wfu_PD_bank.conops[o].nonevisible)&&1==e&&1==t?l.classList.add("wfu_forced_selection"):l.classList.remove("wfu_forced_selection"),r.checked=!n&&s>-1&&wfu_PD_bank.conops[o].inverse[s],r.disabled=!(!n&&s>-1),n?(l.classList.add("wfu_frozen"),r.classList.add("wfu_frozen")):(l.classList.remove("wfu_frozen"),r.classList.remove("wfu_frozen"))}}function wfu_conquestion_optable_handler(e){if(!wfu_allops_freeze_events){var t=(e=e||window.event).target,n=document.querySelector("#wfu_conquestions_container .wfu_conquestion_itemcontainer.wfu_item_selected");if(n){for(var o=n;(o=o.parentElement)&&!o.classList.contains("wfu_conquestion_container"););for(var a=parseInt(o.id.replace("wfu_conquestion_container_","")),l=document.querySelectorAll("#wfu_conquestion_container_"+a+" .wfu_conquestion_itemcontainer"),r=-1,s=0;s<l.length;s++)if(l[s]==n){r=s+1;break}var u=wfu_get_consent_policy();if(u&&(t.classList.contains("wfu_conquestions_opsel")||t.classList.contains("wfu_conquestions_opinv"))){var d=parseInt(t.parentNode.parentNode.id.replace("wfu_conquestions_oprow_","")),_=wfu_PD_bank.conops[d],i=wfu_conquestion_conop_bankpos(d,a,r);if(i<0||_.unassigned){if(!wfu_PD_bank.params.multi_op_assignments||_.unassigned){var c=u.questions[_.qindex[0]-1];for(s=0;s<c.items.length;s++)if(c.items[s].index==_.itemindex[0]){void 0!==c.items[s].operations[d]&&delete c.items[s].operations[d];break}_.qindex.splice(0,1),_.itemindex.splice(0,1),_.inverse.splice(0,1)}_.qindex.push(a),_.itemindex.push(r),_.inverse.push(document.querySelector("#wfu_conquestions_oprow_"+d+" .wfu_conquestions_opinv").checked),_.unassigned=!1,i=_.qindex.length-1;var f=null,m=(c=u.questions[_.qindex[i]-1]).items.length;for(s=0;s<c.items.length;s++){if(c.items[s].index==_.itemindex[i]){(f=c.items[s]).operations[d]=_.inverse[i]?-1:1;break}if(c.items[s].index>r){m=s;break}}f||((f={index:_.itemindex[i],label:"",location:"right",preselect:!1,operations:{}}).operations[d]=_.inverse[i]?-1:1,c.items.splice(m,0,f)),wfu_set_consent_policy(u),wfu_allops_freeze_events=!0,wfu_consent_question_operations_reassign(),wfu_consent_question_optable_update(a,r),wfu_update_consent_question_item_assignments(),wfu_allops_freeze_events=!1}else if(t.classList.contains("wfu_conquestions_opsel")&&i>=0){for(c=u.questions[_.qindex[i]-1],s=0;s<c.items.length;s++)if(c.items[s].index==_.itemindex[i]){void 0!==c.items[s].operations[d]&&delete c.items[s].operations[d];break}_.qindex.splice(i,1),_.itemindex.splice(i,1),_.inverse.splice(i,1),wfu_set_consent_policy(u),wfu_allops_freeze_events=!0,t.checked=!1,wfu_consent_question_operations_reassign(),wfu_consent_question_optable_update(a,r),wfu_update_consent_question_item_assignments(),wfu_allops_freeze_events=!1}else if(t.classList.contains("wfu_conquestions_opinv")){for(_.inverse[i]=t.checked,c=u.questions[_.qindex[i]-1],s=0;s<c.items.length;s++)if(c.items[s].index==_.itemindex[i]){c.items[s].operations[d]=_.inverse[i]?-1:1;break}wfu_set_consent_policy(u)}}}}}function wfu_conquestion_tools_handler(e){if(!wfu_allops_freeze_events){for(var t=(e=e||window.event).target,n=document.querySelectorAll(".wfu_conquestion_container").length,o=t;(o=o.parentElement)&&!o.classList.contains("wfu_conquestion_container"););var a=parseInt(o.id.replace("wfu_conquestion_container_",""))-1;wfu_allops_freeze_events=!0;var l="";t.classList.contains("wfu_conquestion_add")?l="add":t.classList.contains("wfu_conquestion_remove")&&n>1?l="remove":t.classList.contains("wfu_conquestion_up")&&a>0?l="up":t.classList.contains("wfu_conquestion_down")&&a<n-1&&(l="down"),""!=l&&(wfu_update_consent_question_itemprops(0,-1),wfu_consent_question_action(l,a),wfu_consent_question_operations_reassign(),wfu_consent_question_optable_update(0,0),wfu_update_conquestion_header()),wfu_allops_freeze_events=!1}}function wfu_update_conquestion_header(){for(var e=document.querySelectorAll(".wfu_conquestion_headerlabel"),t=(document.querySelectorAll(".wfu_conquestion_tools .wfu_conquestion_btn.wfu_conquestion_add"),document.querySelectorAll(".wfu_conquestion_tools .wfu_conquestion_btn.wfu_conquestion_remove")),n=document.querySelectorAll(".wfu_conquestion_tools .wfu_conquestion_btn.wfu_conquestion_up"),o=document.querySelectorAll(".wfu_conquestion_tools .wfu_conquestion_btn.wfu_conquestion_down"),a=0;a<e.length;a++)e[a].innerHTML="Question "+(a+1),e.length>1?t[a].classList.remove("wfu_tool_disabled"):t[a].classList.add("wfu_tool_disabled"),a>0?n[a].classList.remove("wfu_tool_disabled"):n[a].classList.add("wfu_tool_disabled"),a<e.length-1?o[a].classList.remove("wfu_tool_disabled"):o[a].classList.add("wfu_tool_disabled")}function wfu_permissions_update(e){function t(o,a){var l=o.ID;if(o.children.length>0){n.permissions[l].allowedstatus={};for(var r=0;r<o.children.length;r++){t(o.children[r],a+1);var s=o.children[r].ID;for(var u in n.permissions[s].allowedstatus)if(n.permissions[s].allowedstatus.hasOwnProperty(u)){var d=n.permissions[s].allowedstatus[u];void 0===n.permissions[l].allowedstatus[u]?n.permissions[l].allowedstatus[u]=d:n.permissions[l].allowedstatus[u]*d<1&&(n.permissions[l].allowedstatus[u]=0)}}}else{var _=n.permissions[l].Allowed;n.permissions[l].allowedstatus={};for(var i=0;i<n.permissions[l].Locations.length;i++)u=n.permissions[l].Locations[i],n.permissions[l].allowedstatus[u]=_.indexOf(u)>-1?1:-1}if(void 0===wfu_PD_bank.perallowedstatus&&(wfu_PD_bank.perallowedstatus={}),wfu_PD_bank.perallowedstatus[l]=n.permissions[l].allowedstatus,e)for(var u in document.getElementById("wfu_perm_row_"+l),n.permissions[l].allowedstatus)n.permissions[l].allowedstatus.hasOwnProperty(u)&&wfu_set_checkbox_status(document.querySelector("#wfu_perm_row_"+l+" .wfu_location_cell:nth-child("+(parseInt(u)+1)+") input"),n.permissions[l].allowedstatus[u])}var n=wfu_get_permissions_policy();if(n){console.log(n),wfu_allops_freeze_events=!0;for(var o=0;o<n.structure.length;o++)t(n.structure[o],1);wfu_allops_freeze_events=!1}}function wfu_adjust_permissions_levels(){function e(t,o){var a=t.ID;if(t.children.length>0)for(var l=0;l<t.children.length;l++)e(t.children[l],o);else-1==n.permissions[a].Allowed.indexOf(o)&&n.permissions[a].Locations.indexOf(o)>-1&&n.permissions[a].Allowed.push(o)}function t(n,a){if(n.children.length>0)for(var l=0;l<n.children.length;l++)t(n.children[l],a+1);var r=n.ID;for(var s in wfu_PD_bank.perallowedstatus[r])wfu_PD_bank.perallowedstatus[r].hasOwnProperty(s)&&0==wfu_PD_bank.perallowedstatus[r][s]&&a==wfu_PD_bank.params.perlevels&&(e(n,parseInt(s)),wfu_PD_bank.perallowedstatus[r][s]=1,o=!0)}wfu_permissions_update(!1);var n=wfu_get_permissions_policy();if(n){for(var o=!1,a=0;a<n.structure.length;a++)t(n.structure[a],1);o&&wfu_set_permissions_policy(n)}}function wfu_perm_toggle(e){if(!wfu_allops_freeze_events&&e.classList.contains("wfu_location_selector")){var t=e.parentNode.parentNode.id.replace("wfu_perm_row_",""),n=e.parentNode.cellIndex,o=wfu_get_permissions_policy();if(o){if(void 0===o.permissions[t])return;var a=e.classList.contains("indeterminate")?0:e.checked?-1:1,l=!!e.classList.contains("indeterminate")||e.checked;if(e.indeterminate||e.classList.remove("indeterminate"),o.children_index[t].length>0){for(var r=1,s=t;(s=o.permissions[s].Parent)>0;)r++;if((wfu_PD_bank.params.perlevels<1||r<wfu_PD_bank.params.perlevels)&&!confirm("This will make all children permissions "+(l?"allowed":"not allowed")+". Continue?"))return wfu_allops_freeze_events=!0,wfu_set_checkbox_status(e,a),void(wfu_allops_freeze_events=!1);for(var u=0;u<o.children_index[t].length;u++){var d=o.children_index[t][u];if(0==o.children_index[d].length){var _=o.permissions[d].Allowed.indexOf(n);l&&-1==_&&o.permissions[d].Locations.indexOf(n)>-1?o.permissions[d].Allowed.push(n):!l&&_>-1&&o.permissions[d].Allowed.splice(_,1)}}}else{var i=o.permissions[t].Allowed.indexOf(n);l&&-1==i&&o.permissions[t].Locations.indexOf(n)>-1?o.permissions[t].Allowed.push(n):!l&&i>-1&&o.permissions[t].Allowed.splice(i,1)}wfu_set_permissions_policy(o),wfu_allops_freeze_events=!0,wfu_permissions_update(!0),wfu_allops_freeze_events=!1}}}function wfu_perm_button_action(e){if(!wfu_allops_freeze_events&&e.classList.contains("wfu_perm_button")){var t=wfu_get_permissions_policy();if(t){for(var n=e;(n=n.parentElement)&&!n.classList.contains("wfu_perm_row"););var o=parseInt(n.id.replace("wfu_perm_row_",""));e.classList.toggle("expanded");for(var a=0;a<t.children_index[o].length;a++){for(var l=t.children_index[o][a],r=l,s=!0;(r=t.permissions[r].Parent)>0;)s=s&&document.querySelector("#wfu_perm_row_"+r+" .wfu_perm_button")&&document.querySelector("#wfu_perm_row_"+r+" .wfu_perm_button").classList.contains("expanded");document.getElementById("wfu_perm_row_"+l).style.display=s?"table-row":"none"}}}}function wfu_logactions_update(e){function t(o,a){var l=o.ID;if(o.children.length>0){n.logactions[l].allowedstatus={};for(var r=0;r<o.children.length;r++){t(o.children[r],a+1);var s=o.children[r].ID;for(var u in n.logactions[s].allowedstatus)if(n.logactions[s].allowedstatus.hasOwnProperty(u)){var d=n.logactions[s].allowedstatus[u];void 0===n.logactions[l].allowedstatus[u]?n.logactions[l].allowedstatus[u]=d:n.logactions[l].allowedstatus[u]*d<1&&(n.logactions[l].allowedstatus[u]=0)}}}else{var _=n.logactions[l].Allowed;n.logactions[l].allowedstatus={};for(var i=0;i<n.logactions[l].Entities.length;i++)u=n.logactions[l].Entities[i],n.logactions[l].allowedstatus[u]=_.indexOf(u)>-1?1:-1}if(void 0===wfu_PD_bank.logallowedstatus&&(wfu_PD_bank.logallowedstatus={}),wfu_PD_bank.logallowedstatus[l]=n.logactions[l].allowedstatus,e)for(var u in document.getElementById("wfu_log_row_"+l),n.logactions[l].allowedstatus)n.logactions[l].allowedstatus.hasOwnProperty(u)&&wfu_set_checkbox_status(document.querySelector("#wfu_log_row_"+l+" .wfu_entity_cell:nth-child("+(parseInt(u)+1)+") input"),n.logactions[l].allowedstatus[u])}var n=wfu_get_logactions_policy();if(n){console.log(n),wfu_allops_freeze_events=!0;for(var o=0;o<n.structure.length;o++)t(n.structure[o],1);wfu_allops_freeze_events=!1}}function wfu_adjust_logactions_levels(){function e(t,o){var a=t.ID;if(t.children.length>0)for(var l=0;l<t.children.length;l++)e(t.children[l],o);else-1==n.logactions[a].Allowed.indexOf(o)&&n.logactions[a].Entities.indexOf(o)>-1&&n.logactions[a].Allowed.push(o)}function t(n,a){if(n.children.length>0)for(var l=0;l<n.children.length;l++)t(n.children[l],a+1);var r=n.ID;for(var s in wfu_PD_bank.logallowedstatus[r])wfu_PD_bank.logallowedstatus[r].hasOwnProperty(s)&&0==wfu_PD_bank.logallowedstatus[r][s]&&a==wfu_PD_bank.params.loglevels&&(e(n,parseInt(s)),wfu_PD_bank.logallowedstatus[r][s]=1,o=!0)}wfu_logactions_update(!1);var n=wfu_get_logactions_policy();if(n){for(var o=!1,a=0;a<n.structure.length;a++)t(n.structure[a],1);o&&wfu_set_logactions_policy(n)}}function wfu_log_toggle(e){if(!wfu_allops_freeze_events&&e.classList.contains("wfu_entity_selector")){var t=e.parentNode.parentNode.id.replace("wfu_log_row_",""),n=e.parentNode.cellIndex,o=wfu_get_logactions_policy();if(o){if(void 0===o.logactions[t])return;var a=e.classList.contains("indeterminate")?0:e.checked?-1:1,l=!!e.classList.contains("indeterminate")||e.checked;if(e.indeterminate||e.classList.remove("indeterminate"),o.children_index[t].length>0){for(var r=1,s=t;(s=o.logactions[s].Parent)>0;)r++;if((wfu_PD_bank.params.loglevels<1||r<wfu_PD_bank.params.loglevels)&&!confirm("This will make all children log actions "+(l?"allowed":"not allowed")+". Continue?"))return wfu_allops_freeze_events=!0,wfu_set_checkbox_status(e,a),void(wfu_allops_freeze_events=!1);for(var u=0;u<o.children_index[t].length;u++){var d=o.children_index[t][u];if(0==o.children_index[d].length){var _=o.logactions[d].Allowed.indexOf(n);l&&-1==_&&o.logactions[d].Entities.indexOf(n)>-1?o.logactions[d].Allowed.push(n):!l&&_>-1&&o.logactions[d].Allowed.splice(_,1)}}}else{var i=o.logactions[t].Allowed.indexOf(n);l&&-1==i&&o.logactions[t].Entities.indexOf(n)>-1?o.logactions[t].Allowed.push(n):!l&&i>-1&&o.logactions[t].Allowed.splice(i,1)}wfu_set_logactions_policy(o),wfu_allops_freeze_events=!0,wfu_logactions_update(!0),wfu_allops_freeze_events=!1}}}function wfu_log_button_action(e){if(!wfu_allops_freeze_events&&e.classList.contains("wfu_log_button")){var t=wfu_get_logactions_policy();if(t){for(var n=e;(n=n.parentElement)&&!n.classList.contains("wfu_log_row"););var o=parseInt(n.id.replace("wfu_log_row_",""));e.classList.toggle("expanded");for(var a=0;a<t.children_index[o].length;a++){for(var l=t.children_index[o][a],r=l,s=!0;(r=t.logactions[r].Parent)>0;)s=s&&document.querySelector("#wfu_log_row_"+r+" .wfu_log_button")&&document.querySelector("#wfu_log_row_"+r+" .wfu_log_button").classList.contains("expanded");document.getElementById("wfu_log_row_"+l).style.display=s?"table-row":"none"}}}}function wfu_pdusers_addrole_handler(e){if(!wfu_allops_freeze_events&&e.classList.contains("wfu_pdusers_roles_add")){for(var t=e;(t=t.parentElement)&&!t.classList.contains("wfu_pdusers_roles_container"););for(var n=t.id.replace(/^wfu_pdusers_roles_(in|out)_container$/,"$1"),o=document.querySelector("#wfu_pdusers_roles_"+n+"_container .wfu_pdusers_roles_list"),a=[],l=0;l<o.options.length;l++)o.options[l].selected&&a.push(o.options[l].value);wfu_allops_freeze_events=!0,wfu_pdusers_add_roles(n,a),wfu_allops_freeze_events=!1}}function wfu_pdusers_add_roles(e,t){for(var n=document.querySelector("#wfu_pdusers_roles_"+e+"_container .wfu_pdusers_roles_show"),o=document.querySelector("#wfu_pdusers_roles_"+e+"_container .wfu_pdusers_roles_list"),a=document.querySelectorAll("#wfu_pdusers_roles_"+e+"_container .wfu_pdusers_roles_rightpanel .wfu_pdusers_roles_role"),l=document.querySelector('#wfu_pdusers_roles_in_container input[type="radio"]').checked?"in":"out",r="in"==e?"included":"excluded",s=a.length,u=0;u<t.length;u++){var d="";if("all"==t[u])d="All";else for(var _=0;_<o.options.length;_++)if(o.options[_].value==t[u]){d=o.options[_].innerHTML;break}if(""!=d){var i=!1;for(_=0;_<a.length;_++)if(a[_].roleName==t[u]){i=!0;break}if(!i){-1==wfu_PD_bank.pdusers.rolestates[l][r].indexOf(t[u])&&wfu_PD_bank.pdusers.rolestates[l][r].push(t[u]),s>0&&n.appendChild(document.createElement("BR"));var c=document.createElement("DIV");if(c.classList.add("wfu_pdusers_roles_role"),c.roleName=t[u],c.innerHTML=d,"all"==t[u])c.classList.add("wfu_pdusers_roles_all");else{var f=document.createElement("SPAN");wfu_addEventHandler(f,"click",wfu_pdusers_removerole_handler),c.appendChild(f)}n.appendChild(c),s++}}}}function wfu_pdusers_clear_roles(e){for(var t=document.querySelector("#wfu_pdusers_roles_"+e+"_container .wfu_pdusers_roles_show"),n=document.querySelectorAll("#wfu_pdusers_roles_"+e+"_container .wfu_pdusers_roles_rightpanel .wfu_pdusers_roles_role"),o=document.querySelectorAll("#wfu_pdusers_roles_"+e+"_container .wfu_pdusers_roles_rightpanel br"),a=0;a<n.length;a++)t.removeChild(n[a]);for(a=0;a<o.length;a++)t.removeChild(o[a])}function wfu_pdusers_removerole_handler(e){if(!wfu_allops_freeze_events){var t=(e=e||window.event).target;if(t.parentNode.classList.contains("wfu_pdusers_roles_role")){for(var n=t.parentNode.roleName,o=t;(o=o.parentElement)&&!o.classList.contains("wfu_pdusers_roles_container"););var a=o.id.replace(/^wfu_pdusers_roles_(in|out)_container$/,"$1"),l=document.querySelector('#wfu_pdusers_roles_in_container input[type="radio"]').checked?"in":"out",r="in"==a?"included":"excluded",s=wfu_PD_bank.pdusers.rolestates[l][r].indexOf(n);s>-1&&wfu_PD_bank.pdusers.rolestates[l][r].splice(s,1);var u=t.parentNode.previousSibling,d=t.parentNode.nextSibling,_=document.querySelector("#"+o.id+" .wfu_pdusers_roles_show");wfu_allops_freeze_events=!0,_.removeChild(t.parentNode),u&&u.tagName&&"BR"==u.tagName?_.removeChild(u):d&&d.tagName&&"BR"==d.tagName&&_.removeChild(d),wfu_allops_freeze_events=!1}}}function wfu_pdusers_update(){var e=wfu_get_pd_users();if(e){console.log(e),wfu_PD_bank.pdusers={rolestates:{in:{included:[],excluded:[]},out:{included:["all"],excluded:[]}}},wfu_attach_element_handlers(document.querySelector('#wfu_pdusers_users_in_container .wfu_pdusers_users_leftpanel input[type="text"]'),wfu_pdusers_get_users),wfu_attach_element_handlers(document.querySelector('#wfu_pdusers_users_out_container .wfu_pdusers_users_leftpanel input[type="text"]'),wfu_pdusers_get_users),wfu_PD_bank.pdusers.userinput={in:{prev_value:""},out:{prev_value:""},xhr:null};var t=document.querySelector('#wfu_pdusers_roles_in_container input[type="radio"]'),n=document.querySelector("#wfu_pdusers_roles_in_container .wfu_pdusers_roles_list"),o=document.querySelector("#wfu_pdusers_roles_in_container .wfu_pdusers_roles_back"),a=document.querySelector('#wfu_pdusers_roles_out_container input[type="radio"]'),l=document.querySelector("#wfu_pdusers_roles_out_container .wfu_pdusers_roles_list"),r=document.querySelector("#wfu_pdusers_roles_out_container .wfu_pdusers_roles_back");e.roles_included.length>0&&"all"!=e.roles_included[0]||1==e.roles_excluded.length&&"all"==e.roles_excluded[0]||0==e.roles_included.length&&0==e.roles_excluded.length?(wfu_PD_bank.pdusers.rolestates.in.included=e.roles_included,n.disabled=!1,o.classList.add("active"),l.disabled=!0,r.classList.remove("active"),t.checked=!0,wfu_pdusers_add_roles("in",e.roles_included),wfu_pdusers_add_roles("out",[])):(wfu_PD_bank.pdusers.rolestates.out.excluded=e.roles_excluded,n.disabled=!0,o.classList.remove("active"),l.disabled=!1,r.classList.add("active"),a.checked=!0,wfu_pdusers_add_roles("in",["all"]),wfu_pdusers_add_roles("out",e.roles_excluded))}}function wfu_pdusers_roletype_handler(e){if(!wfu_allops_freeze_events&&"wfu_pdusers_roletypes"==e.name){var t=document.querySelector('#wfu_pdusers_roles_in_container input[type="radio"]'),n=document.querySelector("#wfu_pdusers_roles_in_container .wfu_pdusers_roles_list"),o=document.querySelector("#wfu_pdusers_roles_in_container .wfu_pdusers_roles_back"),a=document.querySelector('#wfu_pdusers_roles_out_container input[type="radio"]'),l=document.querySelector("#wfu_pdusers_roles_out_container .wfu_pdusers_roles_list"),r=document.querySelector("#wfu_pdusers_roles_out_container .wfu_pdusers_roles_back");wfu_allops_freeze_events=!0,wfu_pdusers_clear_roles("in"),wfu_pdusers_clear_roles("out"),"include"==e.value?(n.disabled=!1,o.classList.add("active"),l.disabled=!0,r.classList.remove("active"),t.checked=!0,wfu_pdusers_add_roles("in",wfu_PD_bank.pdusers.rolestates.in.included),wfu_pdusers_add_roles("out",wfu_PD_bank.pdusers.rolestates.in.excluded)):(n.disabled=!0,o.classList.remove("active"),l.disabled=!1,r.classList.add("active"),a.checked=!0,wfu_pdusers_add_roles("in",wfu_PD_bank.pdusers.rolestates.out.included),wfu_pdusers_add_roles("out",wfu_PD_bank.pdusers.rolestates.out.excluded)),wfu_allops_freeze_events=!1}}function wfu_pdusers_adduser_handler(e){if(!wfu_allops_freeze_events&&e.classList.contains("wfu_pdusers_users_add")){for(var t=e;(t=t.parentElement)&&!t.classList.contains("wfu_pdusers_users_container"););for(var n=t.id.replace(/^wfu_pdusers_users_(in|out)_container$/,"$1"),o=document.querySelector("#wfu_pdusers_users_"+n+"_container .wfu_pdusers_users_list"),a=[],l=0;l<o.options.length;l++)o.options[l].selected&&a.push(o.options[l].value);wfu_allops_freeze_events=!0,wfu_pdusers_add_users(n,a),wfu_allops_freeze_events=!1}}function wfu_pdusers_add_users(e,t){for(var n=document.querySelector("#wfu_pdusers_users_"+e+"_container .wfu_pdusers_users_show"),o=document.querySelector("#wfu_pdusers_users_"+e+"_container .wfu_pdusers_users_list"),a=document.querySelectorAll("#wfu_pdusers_users_"+e+"_container .wfu_pdusers_users_rightpanel .wfu_pdusers_users_user"),l=document.querySelectorAll("#wfu_pdusers_users_"+("in"==e?"out":"in")+"_container .wfu_pdusers_users_rightpanel .wfu_pdusers_users_user"),r=a.length,s=0;s<t.length;s++){for(var u="",d=0;d<o.options.length;d++)if(o.options[d].value==t[s]){u=o.options[d].innerHTML;break}if(""!=u){var _=!1;for(d=0;d<a.length;d++)if(a[d].userName==t[s]){_=!0;break}if(!_){for(r>0&&n.appendChild(document.createElement("BR")),d=0;d<l.length;d++)if(l[d].userName==t[s]){var i=wfu_allops_freeze_events;wfu_allops_freeze_events=!1,wfu_pdusers_removeuser_handler({target:l[d].children[0]}),wfu_allops_freeze_events=i;break}var c=document.createElement("DIV");c.classList.add("wfu_pdusers_users_user"),c.userName=t[s],c.innerHTML=u;var f=document.createElement("SPAN");wfu_addEventHandler(f,"click",wfu_pdusers_removeuser_handler),c.appendChild(f),n.appendChild(c),r++}}}}function wfu_pdusers_removeuser_handler(e){if(!wfu_allops_freeze_events){var t=(e=e||window.event).target;if(t.parentNode.classList.contains("wfu_pdusers_users_user")){t.parentNode.userName;for(var n=t;(n=n.parentElement)&&!n.classList.contains("wfu_pdusers_users_container"););n.id.replace(/^wfu_pdusers_users_(in|out)_container$/,"$1");var o=t.parentNode.previousSibling,a=t.parentNode.nextSibling,l=document.querySelector("#"+n.id+" .wfu_pdusers_users_show");wfu_allops_freeze_events=!0,l.removeChild(t.parentNode),o&&o.tagName&&"BR"==o.tagName?l.removeChild(o):a&&a.tagName&&"BR"==a.tagName&&l.removeChild(a),wfu_allops_freeze_events=!1}}}function wfu_pdusers_get_users(e){if(!wfu_allops_freeze_events){var t=(e=e||window.event).target;if(t.parentNode.classList.contains("wfu_pdusers_users_leftpanel")){for(var n=t;(n=n.parentElement)&&!n.classList.contains("wfu_pdusers_users_container"););var o=n.id.replace(/^wfu_pdusers_users_(in|out)_container$/,"$1");if(t.value!=wfu_PD_bank.pdusers.userinput[o].prev_value){wfu_PD_bank.pdusers.userinput[o].prev_value=t.value,null!=wfu_PD_bank.pdusers.xhr&&(wfu_PD_bank.pdusers.xhr.abort(),wfu_PD_bank.pdusers.xhr=null);var a=document.querySelector("#wfu_pdusers_users_"+o+"_container .wfu_pdusers_users_list");if(""!=t.value){var l=wfu_GetHttpRequestObject();if(null!=l){var r=AdminParams.wfu_ajax_url;params=new Array(3),params[0]=new Array(2),params[0][0]="action",params[0][1]="wfu_ajax_action_pdusers_get_users",params[1]=new Array(2),params[1][0]="nonce",params[1][1]=document.getElementById("_wpnonce").value,params[2]=new Array(2),params[2][0]="query",params[2][1]=t.value;for(var s="",u=0;u<params.length;u++)s+=(u>0?"&":"")+params[u][0]+"="+encodeURI(params[u][1]);l.open("POST",r,!0),l.setRequestHeader("Content-type","application/x-www-form-urlencoded"),l.onreadystatechange=function(){if(4==l.readyState&&200==l.status){var e=l.responseText.indexOf("pdusers_get_users:");-1==e&&(e=l.responseText.length),l.responseText.substr(0,e);var t=wfu_plugin_decode_string(l.responseText.substr(e+18,l.responseText.length-e-18)),n=null;try{n=JSON.parse(t)}catch(e){}var o=a.options.length;for(u=0;u<o;u++)a.options[u]=null;for(u=0;u<n.length;u++){var r=document.createElement("OPTION");r.value=n[u].user_login,r.innerHTML=n[u].display_name+" ("+n[u].user_login+")",a.options.add(r)}}},wfu_PD_bank.pdusers.xhr=l,l.send(s)}}else{var d=a.options.length;for(u=0;u<d;u++)a.options[0]=null}}}}}function wfu_initialize_consent_policy_basic(){wfu_PD_bank.userinput={prev_value:"",xhr:null,prev_select:-1},wfu_attach_element_handlers(document.getElementById("wfu_pd_user_box0"),wfu_pd_get_users_basic)}function wfu_pd_get_users_basic(e){var t=(e=e||window.event).target;if(t.classList.contains("wfu_pd_user_box0")&&t.value!=wfu_PD_bank.userinput){var n=document.getElementById("wfu_pd_user_select0");if(wfu_PD_bank.userinput=t.value,null!=wfu_PD_bank.userinput.xhr&&(wfu_PD_bank.userinput.xhr.abort(),wfu_PD_bank.userinput.xhr=null),""!=t.value){var o=wfu_GetHttpRequestObject();if(null!=o){var a=AdminParams.wfu_ajax_url;params=new Array(3),params[0]=new Array(2),params[0][0]="action",params[0][1]="wfu_ajax_action_pdusers_get_users",params[1]=new Array(2),params[1][0]="nonce",params[1][1]=document.getElementById("_wpnonce").value,params[2]=new Array(2),params[2][0]="query",params[2][1]=t.value;for(var l="",r=0;r<params.length;r++)l+=(r>0?"&":"")+params[r][0]+"="+encodeURI(params[r][1]);o.open("POST",a,!0),o.setRequestHeader("Content-type","application/x-www-form-urlencoded"),o.onreadystatechange=function(){if(4==o.readyState&&200==o.status){var e=o.responseText.indexOf("pdusers_get_users:");-1==e&&(e=o.responseText.length),o.responseText.substr(0,e);var t=wfu_plugin_decode_string(o.responseText.substr(e+18,o.responseText.length-e-18)),a=null;try{a=JSON.parse(t)}catch(e){}var l=n.options.length;for(r=0;r<l;r++)n.options[0]=null;for(r=0;r<a.length;r++){var s=document.createElement("OPTION");s.value=a[r].user_login,s.innerHTML=a[r].display_name+" ("+a[r].user_login+")",n.options.add(s)}}},wfu_PD_bank.userinput.xhr=o,o.send(l)}}else{var s=n.options.length;for(r=0;r<s;r++)n.options[0]=null}}}function wfu_export_user_data(){var e=document.getElementById("wfu_pd_user_select0");if(e.selectedIndex<0)alert("No user has been selected!");else{var t={username:e.options[e.selectedIndex].value};wfu_download_file("exportdata:"+JSON.stringify(t),1)}}function wfu_erase_user_data_check(){var e=document.getElementById("wfu_pd_user_select0"),t=document.getElementById("wfu_erase_userdata0");return e.selectedIndex<0?(alert("No user has been selected!"),!1):(t.href=t.href.replace(/action=erase_userdata_ask.*$/,"action=erase_userdata_ask&username="+e.options[e.selectedIndex].value),!0)}function wfu_pd_pre_save_actions(){var e=JSON.stringify(wfu_PD_bank);document.getElementById("wfu_PD_bank").value=wfu_plugin_encode_string(e)}jQuery(document).ready((function(e){e(".wfu_color_field").wpColorPicker({change:function(e,t){console.log(t),window.aaa=t,e.target.value=t.color.to_s(),"wfu_text_elements"==e.target.name?wfu_update_text_value(e):"wfu_triplecolor_elements"==e.target.name&&wfu_update_triplecolor_value(e)}})}));
